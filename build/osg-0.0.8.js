function getStackTrace(e){var t=[],n=arguments;try{throw arguments.length==1?e:new Error}catch(e){e.stack&&(t=(e.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n"),t.shift())}for(var r=0;r<t.length;++r)t[r]===""&&(t.splice(r,1),--r);return t}var osg={};osg.version="0.8.0",osg.copyright="Cedric Pinson - cedric.pinson@plopbyte.com",osg.log=function(e){window.console!==undefined&&window.console.log(e,getStackTrace())},osg.info=function(e){window.console!==undefined&&window.console.info(e,getStackTrace())},osg.warn=function(e){window.console!==undefined&&window.console.warn(e,getStackTrace())},osg.debug=function(e){window.console!==undefined&&window.console.debug(e,getStackTrace())},osg.DEBUG=0,osg.INFO=1,osg.NOTICE=2,osg.WARN=3,osg.setNotifyLevel=function(e){var t=function(e){window.console!==undefined&&window.console.log(e,getStackTrace())},n=function(e){window.console!==undefined&&window.console.info(e,getStackTrace())},r=function(e){window.console!==undefined&&window.console.warn(e,getStackTrace())},i=function(e){window.console!==undefined&&window.console.debug(e,getStackTrace())},s=function(){};osg.debug=s,osg.info=s,osg.log=s,osg.warn=s,e<=osg.DEBUG&&(osg.debug=i),e<=osg.INFO&&(osg.info=n),e<=osg.NOTICE&&(osg.log=t),e<=osg.WARN&&(osg.warn=r)},osg.reportWebGLError=!1,osg.memoryPools={},osg.init=function(){osg.setNotifyLevel(osg.NOTICE),osg.memoryPools.stateGraph=(new OsgObjectMemoryPool(osg.StateGraph)).grow(50)},osg.isArray=function(e){return toString.call(e)==="[object Array]"},osg.extend=function(){var e=Object.prototype.toString,t=Object.prototype.hasOwnProperty,n=function(t){return e.call(t)==="[object Function]"},r=osg.isArray,i=function(n){if(!n||e.call(n)!=="[object Object]"||n.nodeType||n.setInterval)return!1;if(n.constructor&&!t.call(n,"constructor")&&!t.call(n.constructor.prototype,"isPrototypeOf"))return!1;var r;for(r in n);return r===undefined||t.call(n,r)},s=arguments[0]||{},o=1,u=arguments.length,a=!1,f,l,c,h;typeof s=="boolean"&&(a=s,s=arguments[1]||{},o=2),typeof s!="object"&&!n(s)&&(s={}),u===o&&(s=this,--o);for(;o<u;o++)if((f=arguments[o])!==null)for(l in f){c=s[l],h=f[l];if(s===h)continue;if(a&&h&&(i(h)||r(h))){var p=c&&(i(c)||r(c))?c:r(h)?[]:{};s[l]=osg.extend(a,p,h)}else h!==undefined&&(s[l]=h)}return s},osg.objectInehrit=osg.objectInherit=function(e,t){function n(){}n.prototype=e;var r=new n;return t&&osg.objectMix(r,t,!1),r},osg.objectMix=function(e,t,n){for(var r in t)if(!n||!e[r])e[r]=t[r];return e},osg.objectLibraryClass=function(e,t,n){e.className=function(){return n},e.libraryName=function(){return t};var r=t+"::"+n;return e.libraryClassName=function(){return r},e},osg.objectType={},osg.objectType.type=0,osg.objectType.generate=function(e){var t=osg.objectType.type;return osg.objectType[t]=e,osg.objectType[e]=t,osg.objectType.type+=1,t},osg.Float32Array=Float32Array,osg.Int32Array=Int32Array,osg.Uint16Array=Uint16Array,osg.Vec2={copy:function(e,t){return t[0]=e[0],t[1]=e[1],t},valid:function(e){return isNaN(e[0])?!1:isNaN(e[1])?!1:!0},mult:function(e,t,n){return n[0]=e[0]*t,n[1]=e[1]*t,n},length2:function(e){return e[0]*e[0]+e[1]*e[1]},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},distance:function(e,t){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)},normalize:function(e,t){var n=this.length2(e);if(n>0){var r=1/Math.sqrt(n);t[0]=e[0]*r,t[1]=e[1]*r}else t[0]=e[0],t[1]=e[1];return t},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},sub:function(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n},add:function(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n},neg:function(e,t){return t[0]=-e[0],t[1]=-e[1],t},lerp:function(e,t,n,r){var i=1-e;return r[0]=t[0]*i+e*n[0],r[1]=t[1]*i+e*n[1],r}},osg.Vec3={init:function(e){return e[0]=0,e[1]=0,e[2]=0,e},copy:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},cross:function(e,t,n){var r=e[1]*t[2]-e[2]*t[1],i=e[2]*t[0]-e[0]*t[2],s=e[0]*t[1]-e[1]*t[0];return n[0]=r,n[1]=i,n[2]=s,n},valid:function(e){return isNaN(e[0])?!1:isNaN(e[1])?!1:isNaN(e[2])?!1:!0},mult:function(e,t,n){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n},length2:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},distance:function(e,t){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)},normalize:function(e,t){var n=this.length2(e);if(n>0){var r=1/Math.sqrt(n);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}else t[0]=e[0],t[1]=e[1],t[2]=e[2];return t},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},sub:function(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n},add:function(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n},neg:function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},lerp:function(e,t,n,r){return r[0]=t[0]+(n[0]-t[0])*e,r[1]=t[1]+(n[1]-t[1])*e,r[2]=t[2]+(n[2]-t[2])*e,r}},osg.Vec4={dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},copy:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},sub:function(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n},mult:function(e,t,n){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r},add:function(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n},neg:function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},lerp:function(e,t,n,r){var i=1-e;return r[0]=t[0]*i+e*n[0],r[1]=t[1]*i+e*n[1],r[2]=t[2]*i+e*n[2],r[3]=t[3]*i+e*n[3],r}},osg.Object=function(){this._name=undefined,this._userdata=undefined},osg.Object.prototype=osg.objectLibraryClass({setName:function(e){this._name=e},getName:function(){return this._name},setUserData:function(e){this._userdata=e},getUserData:function(){return this._userdata}},"osg","Object"),osg.Matrix={_tmp0:[],_tmp1:[],valid:function(e){for(var t=0;t<16;t++)if(isNaN(e[t]))return!1;return!0},setRow:function(e,t,n,r,i,s){var o=t*4;e[o+0]=n,e[o+1]=r,e[o+2]=i,e[o+3]=s},innerProduct:function(e,t,n,r){var i=n*4;return e[i+0]*t[0+r]+e[i+1]*t[4+r]+e[i+2]*t[8+r]+e[i+3]*t[12+r]},set:function(e,t,n,r){return e[t*4+n]=r,r},get:function(e,t,n){return e[t*4+n]},makeIdentity:function(e){return e===undefined&&(e=[],osg.log("osg.Matrix.makeIdentity without matrix destination is deprecated")),osg.Matrix.setRow(e,0,1,0,0,0),osg.Matrix.setRow(e,1,0,1,0,0),osg.Matrix.setRow(e,2,0,0,1,0),osg.Matrix.setRow(e,3,0,0,0,1),e},makeTranslate:function(e,t,n,r){return r===undefined&&(r=[]),osg.Matrix.setRow(r,0,1,0,0,0),osg.Matrix.setRow(r,1,0,1,0,0),osg.Matrix.setRow(r,2,0,0,1,0),osg.Matrix.setRow(r,3,e,t,n,1),r},setTrans:function(e,t,n,r){return e[12]=t,e[13]=n,e[14]=r,e},getTrans:function(e,t){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},preMult:function(e,t){var n,r,i,s;return n=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],r=t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],i=t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],s=t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],e[0]=n,e[4]=r,e[8]=i,e[12]=s,n=t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],r=t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],i=t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],s=t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],e[1]=n,e[5]=r,e[9]=i,e[13]=s,n=t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],r=t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],i=t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],s=t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],e[2]=n,e[6]=r,e[10]=i,e[14]=s,n=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],r=t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],i=t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],s=t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15],e[3]=n,e[7]=r,e[11]=i,e[15]=s,e},postMult:function(e,t){return btmp0=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],btmp1=t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],btmp2=t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],btmp3=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],t[0]=btmp0,t[1]=btmp1,t[2]=btmp2,t[3]=btmp3,btmp0=t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],btmp1=t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],btmp2=t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],btmp3=t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],t[4]=btmp0,t[5]=btmp1,t[6]=btmp2,t[7]=btmp3,btmp0=t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],btmp1=t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],btmp2=t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],btmp3=t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],t[8]=btmp0,t[9]=btmp1,t[10]=btmp2,t[11]=btmp3,btmp0=t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],btmp1=t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],btmp2=t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],btmp3=t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15],t[12]=btmp0,t[13]=btmp1,t[14]=btmp2,t[15]=btmp3,t},multa:function(e,t,n){return n===e?this.preMult(e,t):n===t?this.postMult(e,t):(n===undefined&&(n=[]),n[0]=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],n[1]=t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],n[2]=t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],n[3]=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],n[4]=t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],n[5]=t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],n[6]=t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],n[7]=t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],n[8]=t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],n[9]=t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],n[10]=t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],n[11]=t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],n[12]=t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],n[13]=t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],n[14]=t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],n[15]=t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15],n)},mult:function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15],b=e[0],w=e[1],E=e[2],S=e[3],x=e[4],T=e[5],N=e[6],C=e[7],k=e[8],L=e[9],A=e[10],O=e[11],M=e[12],_=e[13],D=e[14],P=e[15];return n[0]=r*b+i*x+s*k+o*M,n[1]=r*w+i*T+s*L+o*_,n[2]=r*E+i*N+s*A+o*D,n[3]=r*S+i*C+s*O+o*P,n[4]=u*b+a*x+f*k+l*M,n[5]=u*w+a*T+f*L+l*_,n[6]=u*E+a*N+f*A+l*D,n[7]=u*S+a*C+f*O+l*P,n[8]=c*b+h*x+p*k+d*M,n[9]=c*w+h*T+p*L+d*_,n[10]=c*E+h*N+p*A+d*D,n[11]=c*S+h*C+p*O+d*P,n[12]=v*b+m*x+g*k+y*M,n[13]=v*w+m*T+g*L+y*_,n[14]=v*E+m*N+g*A+y*D,n[15]=v*S+m*C+g*O+y*P,n},multOrig:function(e,t,n){var r;if(n===e){r=[];for(var i=0;i<4;i++)r[0]=osg.Matrix.innerProduct(t,e,0,i),r[1]=osg.Matrix.innerProduct(t,e,1,i),r[2]=osg.Matrix.innerProduct(t,e,2,i),r[3]=osg.Matrix.innerProduct(t,e,3,i),e[0+i]=r[0],e[4+i]=r[1],e[8+i]=r[2],e[12+i]=r[3];return e}if(n===t){r=[];for(var s=0;s<4;s++)r[0]=osg.Matrix.innerProduct(t,e,s,0),r[1]=osg.Matrix.innerProduct(t,e,s,1),r[2]=osg.Matrix.innerProduct(t,e,s,2),r[3]=osg.Matrix.innerProduct(t,e,s,3),this.setRow(t,s,r[0],r[1],r[2],r[3]);return t}n===undefined&&(n=[]);var o=t[0],u=t[1],a=t[2],f=t[3],l=t[4],c=t[5],h=t[6],p=t[7],d=t[8],v=t[9],m=t[10],g=t[11],y=t[12],b=t[13],w=t[14],E=t[15],S=e[0],x=e[1],T=e[2],N=e[3],C=e[4],k=e[5],L=e[6],A=e[7],O=e[8],M=e[9],_=e[10],D=e[11],P=e[12],H=e[13],B=e[14],j=e[15];return n[0]=o*S+u*C+a*O+f*P,n[1]=o*x+u*k+a*M+f*H,n[2]=o*T+u*L+a*_+f*B,n[3]=o*N+u*A+a*D+f*j,n[4]=l*S+c*C+h*O+p*P,n[5]=l*x+c*k+h*M+p*H,n[6]=l*T+c*L+h*_+p*B,n[7]=l*N+c*A+h*D+p*j,n[8]=d*S+v*C+m*O+g*P,n[9]=d*x+v*k+m*M+g*H,n[10]=d*T+v*L+m*_+g*B,n[11]=d*N+v*A+m*D+g*j,n[12]=y*S+b*C+w*O+E*P,n[13]=y*x+b*k+w*M+E*H,n[14]=y*T+b*L+w*_+E*B,n[15]=y*N+b*A+w*D+E*j,n},makeLookAt:function(e,t,n,r){r===undefined&&(r=[]);var i=osg.Vec3.sub(t,e,[]);osg.Vec3.normalize(i,i);var s=osg.Vec3.cross(i,n,[]);osg.Vec3.normalize(s,s);var o=osg.Vec3.cross(s,i,[]);return osg.Vec3.normalize(o,o),r[0]=s[0],r[1]=o[0],r[2]=-i[0],r[3]=0,r[4]=s[1],r[5]=o[1],r[6]=-i[1],r[7]=0,r[8]=s[2],r[9]=o[2],r[10]=-i[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,osg.Matrix.multTranslate(r,osg.Vec3.neg(e,[]),r),r},makeOrtho:function(e,t,n,r,i,s,o){o===undefined&&(o=[]);var u=-(t+e)/(t-e),a=-(r+n)/(r-n),f=-(s+i)/(s-i),l=osg.Matrix.setRow;return l(o,0,2/(t-e),0,0,0),l(o,1,0,2/(r-n),0,0),l(o,2,0,0,-2/(s-i),0),l(o,3,u,a,f,1),o},getLookAt:function(e,t,n,r,i){i===undefined&&(i=1);var s=[],o=osg.Matrix.inverse(e,s);o||osg.Matrix.makeIdentity(s),osg.Matrix.transformVec3(s,[0,0,0],t),osg.Matrix.transform3x3(e,[0,1,0],r),osg.Matrix.transform3x3(e,[0,0,-1],n),osg.Vec3.normalize(n,n),osg.Vec3.add(osg.Vec3.mult(n,i,[]),t,n)},getRotate:function(e,t){t===undefined&&(t=[]);var n,r=[],i,s,o=e[0],u=e[5],a=e[10];r[0]=1+o+u+a,r[1]=1+o-u-a,r[2]=1-o+u-a,r[3]=1-o-u+a,s=0;for(i=1;i<4;i++)r[i]>r[s]?s=i:s=s;return s===0?(t[3]=r[0],t[0]=e[6]-e[9],t[1]=e[8]-e[2],t[2]=e[1]-e[4]):s==1?(t[3]=e[6]-e[9],t[0]=r[1],t[1]=e[1]+e[4],t[2]=e[8]+e[2]):s==2?(t[3]=e[8]-e[2],t[0]=e[1]+e[4],t[1]=r[2],t[2]=e[6]+e[9]):(t[3]=e[1]-e[4],t[0]=e[8]+e[2],t[1]=e[6]+e[9],t[2]=r[3]),n=Math.sqrt(.25/r[s]),t[3]*=n,t[0]*=n,t[1]*=n,t[2]*=n,t},preMultTranslate:function(e,t){return t[0]!==0&&(val=t[0],e[12]+=val*e[0],e[13]+=val*e[1],e[14]+=val*e[2],e[15]+=val*e[3]),t[1]!==0&&(val=t[1],e[12]+=val*e[4],e[13]+=val*e[5],e[14]+=val*e[6],e[15]+=val*e[7]),t[2]!==0&&(val=t[2],e[12]+=val*e[8],e[13]+=val*e[9],e[14]+=val*e[10],e[15]+=val*e[11]),e},multTranslate:function(e,t,n){n===undefined&&(n=[]),n!==e&&osg.Matrix.copy(e,n);var r;return t[0]!==0&&(r=t[0],n[12]+=r*e[0],n[13]+=r*e[1],n[14]+=r*e[2],n[15]+=r*e[3]),t[1]!==0&&(r=t[1],n[12]+=r*e[4],n[13]+=r*e[5],n[14]+=r*e[6],n[15]+=r*e[7]),t[2]!==0&&(r=t[2],n[12]+=r*e[8],n[13]+=r*e[9],n[14]+=r*e[10],n[15]+=r*e[11]),n},makeRotate:function(e,t,n,r,i){i===undefined&&(osg.log("osg.makeRotate without given matrix destination is deprecated"),i=[]);var s=Math.sqrt(t*t+n*n+r*r),o=Math.sin(e),u=Math.cos(e);if(s>0){var a,f,l,c,h,p,d,v,m,g,y;return s=1/s,t*=s,n*=s,r*=s,a=t*t,f=n*n,l=r*r,c=t*n,h=n*r,p=r*t,d=t*o,v=n*o,m=r*o,g=1-u,i[0]=g*a+u,i[1]=g*c-m,i[2]=g*p+v,i[3]=0,i[4]=g*c+m,i[5]=g*f+u,i[6]=g*h-d,i[7]=0,i[8]=g*p-v,i[9]=g*h+d,i[10]=g*l+u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}return osg.Matrix.makeIdentity(i);return i},transform3x3:function(e,t,n){return n===undefined&&(n=[]),n[0]=e[0]*t[0]+e[1]*t[1]+e[2]*t[2],n[1]=e[4]*t[0]+e[5]*t[1]+e[6]*t[2],n[2]=e[8]*t[0]+e[9]*t[1]+e[10]*t[2],n},transformVec3:function(e,t,n){var r=1/(e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]);n===undefined&&(osg.warn("deprecated, osg.Matrix.transformVec3 needs a third parameter as result"),n=[]);var i;return n===t?i=[]:i=n,i[0]=(e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12])*r,i[1]=(e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13])*r,i[2]=(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14])*r,n===t&&osg.Vec3.copy(i,n),n},transformVec4:function(e,t,n){n===undefined&&(n=[]);var r;return n===t?r=[]:r=n,r[0]=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],r[1]=e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],r[2]=e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],r[3]=e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3],n===t&&osg.Vec4.copy(r,n),n},copy:function(e,t){return t===undefined&&(t=[]),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},inverse:function(e,t){return t===e&&(osg.Matrix.copy(e,osg.Matrix._tmp1),e=osg.Matrix._tmp1),e[3]===0&&e[7]===0&&e[11]===0&&e[15]===1?this.inverse4x3(e,t):this.inverse4x4(e,t)},inverse4x4:function(e,t){var n=e[10]*e[15],r=e[14]*e[11],i=e[6]*e[15],s=e[14]*e[7],o=e[6]*e[11],u=e[10]*e[7],a=e[2]*e[15],f=e[14]*e[3],l=e[2]*e[11],c=e[10]*e[3],h=e[2]*e[7],p=e[6]*e[3],d=e[8]*e[13],v=e[12]*e[9],m=e[4]*e[13],g=e[12]*e[5],y=e[4]*e[9],b=e[8]*e[5],w=e[0]*e[13],E=e[12]*e[1],S=e[0]*e[9],x=e[8]*e[1],T=e[0]*e[5],N=e[4]*e[1],C=n*e[5]+s*e[9]+o*e[13]-(r*e[5]+i*e[9]+u*e[13]),k=r*e[1]+a*e[9]+c*e[13]-(n*e[1]+f*e[9]+l*e[13]),L=i*e[1]+f*e[5]+h*e[13]-(s*e[1]+a*e[5]+p*e[13]),A=u*e[1]+l*e[5]+p*e[9]-(o*e[1]+c*e[5]+h*e[9]),O=e[0]*C+e[4]*k+e[8]*L+e[12]*A;if(Math.abs(O)<1e-5)return osg.log("Warning can't inverse matrix "+e),!1;var M=1/O,_=M*C,D=M*k,P=M*L,H=M*A,B=M*(r*e[4]+i*e[8]+u*e[12]-(n*e[4]+s*e[8]+o*e[12])),j=M*(n*e[0]+f*e[8]+l*e[12]-(r*e[0]+a*e[8]+c*e[12])),F=M*(s*e[0]+a*e[4]+p*e[12]-(i*e[0]+f*e[4]+h*e[12])),I=M*(o*e[0]+c*e[4]+h*e[8]-(u*e[0]+l*e[4]+p*e[8])),q=M*(d*e[7]+g*e[11]+y*e[15]-(v*e[7]+m*e[11]+b*e[15])),R=M*(v*e[3]+w*e[11]+x*e[15]-(d*e[3]+E*e[11]+S*e[15])),U=M*(m*e[3]+E*e[7]+T*e[15]-(g*e[3]+w*e[7]+N*e[15])),z=M*(b*e[3]+S*e[7]+N*e[11]-(y*e[3]+x*e[7]+T*e[11])),W=M*(m*e[10]+b*e[14]+v*e[6]-(y*e[14]+d*e[6]+g*e[10])),X=M*(S*e[14]+d*e[2]+E*e[10]-(w*e[10]+x*e[14]+v*e[2])),V=M*(w*e[6]+N*e[14]+g*e[2]-(T*e[14]+m*e[2]+E*e[6])),$=M*(T*e[10]+y*e[2]+x*e[6]-(S*e[6]+N*e[10]+b*e[2]));return t[0]=_,t[1]=D,t[2]=P,t[3]=H,t[4]=B,t[5]=j,t[6]=F,t[7]=I,t[8]=q,t[9]=R,t[10]=U,t[11]=z,t[12]=W,t[13]=X,t[14]=V,t[15]=$,!0},inverse4x3:function(e,t){var n=e[0],r=e[1],i=e[2],s=e[4],o=e[5],u=e[6],a=e[8],f=e[9],l=e[10];t[0]=o*l-u*f,t[1]=i*f-r*l,t[2]=r*u-i*o;var c=1/(n*t[0]+s*t[1]+a*t[2]);n*=c,s*=c,a*=c,t[0]*=c,t[1]*=c,t[2]*=c,t[3]=0,t[4]=u*a-s*l,t[5]=n*l-i*a,t[6]=i*s-n*u,t[7]=0,t[8]=s*f-o*a,t[9]=r*a-n*f,t[10]=n*o-r*s,t[11]=0,t[15]=1;var h,p,d,v=e[15],m=v-1;if(m*m>1e-6){var g=osg.Matrix._tmp0;t[12]=t[13]=t[14]=0;var y=e[3],b=e[7],w=e[11],E=t[0]*y+t[1]*b+t[2]*w,S=t[4]*y+t[5]*b+t[6]*w,x=t[8]*y+t[9]*b+t[10]*w;h=e[12],p=e[13],d=e[14];var T=1/(v-(h*E+p*S+d*x));h*=T,p*=T,d*=T,g[0]=h*E+1,g[1]=p*E,g[2]=d*E,g[3]=-E*T,g[4]=h*S,g[5]=p*S+1,g[6]=d*S,g[7]=-S*T,g[8]=h*x,g[9]=p*x,g[10]=d*x+1,g[11]=-x*T,g[12]=-h,g[13]=-p,g[14]=-d,g[15]=T,osg.Matrix.preMult(t,g)}else h=e[12],p=e[13],d=e[14],t[12]=-(h*t[0]+p*t[4]+d*t[8]),t[13]=-(h*t[1]+p*t[5]+d*t[9]),t[14]=-(h*t[2]+p*t[6]+d*t[10]);return!0},transpose:function(e,t){if(e===t){var n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],u=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=n,e[6]=e[9],e[7]=e[13],e[8]=r,e[9]=s,e[11]=e[14],e[12]=i,e[13]=o,e[14]=u,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},makePerspective:function(e,t,n,r,i){i===undefined&&(i=[]);var s=n*Math.tan(e*Math.PI/360),o=-s,u=o*t,a=s*t;return osg.Matrix.makeFrustum(u,a,o,s,n,r,i)},makeScale:function(e,t,n,r){return r===undefined&&(r=[]),this.setRow(r,0,e,0,0,0),this.setRow(r,1,0,t,0,0),this.setRow(r,2,0,0,n,0),this.setRow(r,3,0,0,0,1),r},computeFrustrumCornersVectors:function(e,t){var n=e[14]/(e[10]-1),r=e[14]/(e[10]+1),i=1/e[0],s=1/e[5];return t[0]=[-i,s,1],t[1]=[-i,-s,1],t[2]=[i,-s,1],t[3]=[i,s,1],t},makeFrustum:function(e,t,n,r,i,s,o){o===undefined&&(o=[]);var u=2*i/(t-e),a=2*i/(r-n),f=(t+e)/(t-e),l=(r+n)/(r-n),c=-(s+i)/(s-i),h=-2*s*i/(s-i);return this.setRow(o,0,u,0,0,0),this.setRow(o,1,0,a,0,0),this.setRow(o,2,f,l,c,-1),this.setRow(o,3,0,0,h,0),o},makeRotateFromQuat:function(e,t){return this.makeIdentity(t),this.setRotateFromQuat(t,e)},setRotateFromQuat:function(e,t){var n=osg.Quat.length2(t);if(Math.abs(n)<=Number.MIN_VALUE)e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[8]=0,e[9]=0,e[10]=0;else{var r;n!==1?r=2/n:r=2;var i,s,o,u,a,f,l,c,h,p,d,v;p=r*t[0],d=r*t[1],v=r*t[2],u=t[0]*p,l=t[0]*d,c=t[0]*v,a=t[1]*d,f=t[1]*v,h=t[2]*v,i=t[3]*p,s=t[3]*d,o=t[3]*v,e[0]=1-(a+h),e[4]=l-o,e[8]=c+s,e[1]=l+o,e[5]=1-(u+h),e[9]=f-i,e[2]=c-s,e[6]=f+i,e[10]=1-(u+a)}return e}},osg.ShaderGeneratorType={VertexInit:0,VertexFunction:1,VertexMain:2,VertexEnd:3,FragmentInit:5,FragmentFunction:6,FragmentMain:7,FragmentEnd:8},osg.Shader=function(e,t){this.type=e,this.setText(t)},osg.Shader.VERTEX_SHADER=35633,osg.Shader.FRAGMENT_SHADER=35632,osg.Shader.prototype={setText:function(e){this.text=e},getText:function(){return this.text},compile:function(){this.shader=gl.createShader(this.type),gl.shaderSource(this.shader,this.text),gl.compileShader(this.shader);if(!gl.getShaderParameter(this.shader,gl.COMPILE_STATUS)&&!gl.isContextLost()){osg.log("can't compile shader:\n"+this.text+"\n");var e="\n"+this.text,t=e.split("\n"),n="\n";for(var r=0,i=t.length;r<i;++r)n+=r+" "+t[r]+"\n";osg.log(n),osg.log(gl.getShaderInfoLog(this.shader))}}},osg.Shader.create=function(e,t){return osg.log("osg.Shader.create is deprecated, use new osg.Shader with the same arguments instead"),new osg.Shader(e,t)},osg.StateAttribute=function(){osg.Object.call(this),this._dirty=!0},osg.StateAttribute.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.Object.prototype,{isDirty:function(){return this._dirty},dirty:function(){this._dirty=!0},setDirty:function(e){this._dirty=e}}),"osg","StateAttribute"),osg.StateAttribute.OFF=0,osg.StateAttribute.ON=1,osg.StateAttribute.OVERRIDE=2,osg.StateAttribute.PROTECTED=4,osg.StateAttribute.INHERIT=8,osg.Uniform=function(){this.transpose=!1,this._dirty=!0,this.name="",this.type=undefined},osg.Uniform.isUniform=function(e){return e.prototype===osg.Uniform.prototype?!0:!1},osg.Uniform.prototype={getName:function(){return this.name},getType:function(){return this.type},get:function(){return this.data},set:function(e){this.data=e,this.dirty()},dirty:function(){this._dirty=!0},apply:function(e){this._dirty&&(this.update.call(this.glData,this.data),this._dirty=!1),this.glCall(e,this.glData)},applyMatrix:function(e){this._dirty&&(this.update.call(this.glData,this.data),this._dirty=!1),this.glCall(e,this.transpose,this.glData)},update:function(e){for(var t=0,n=e.length;t<n;++t)this[t]=e[t]},_updateArray:function(e){for(var t=0,n=e.length;t<n;++t)this[t]=e[t]},_updateFloat1:function(e){this[0]=e[0]},_updateFloat2:function(e){this[0]=e[0],this[1]=e[1]},_updateFloat3:function(e){this[0]=e[0],this[1]=e[1],this[2]=e[2]},_updateFloat4:function(e){this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3]},_updateFloat9:function(e){this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8]},_updateFloat16:function(e){this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15]}},osg.Uniform.createFloat1=function(e,t){var n=e,r=t;r===undefined&&(r=n,n=[0]);var i=new osg.Uniform;return i.data=[n],i.glCall=function(e,t){gl.uniform1fv(e,t)},i.glData=new osg.Float32Array(i.data),i.update=osg.Uniform.prototype._updateFloat1,i.set=function(e){typeof e=="number"?this.data[0]=e:this.data=e,this.dirty()},i.name=r,i.type="float",i},osg.Uniform.createFloat=osg.Uniform.createFloat1,osg.Uniform.float=osg.Uniform.createFloat1,osg.Uniform.createFloatArray=function(e,t){var n=osg.Uniform.createFloat.call(this,e,t);return n.update=osg.Uniform.prototype._updateArray,n},osg.Uniform.createFloat2=function(e,t){var n=e,r=t;r===undefined&&(r=n,n=[0,0]);var i=new osg.Uniform;return i.data=n,i.glCall=function(e,t){gl.uniform2fv(e,t)},i.glData=new osg.Float32Array(i.data),i.update=osg.Uniform.prototype._updateFloat2,i.name=r,i.type="vec2",i},osg.Uniform.vec2=osg.Uniform.createFloat2,osg.Uniform.createFloat2Array=function(e,t){var n=osg.Uniform.createFloat2.call(this,e,t);return n.update=osg.Uniform.prototype._updateArray,n},osg.Uniform.createFloat3=function(e,t){var n=e,r=t;r===undefined&&(r=n,n=[0,0,0]);var i=new osg.Uniform;return i.data=n,i.glCall=function(e,t){gl.uniform3fv(e,t)},i.glData=new osg.Float32Array(i.data),i.update=osg.Uniform.prototype._updateFloat3,i.name=r,i.type="vec3",i},osg.Uniform.vec3=osg.Uniform.createFloat3,osg.Uniform.createFloat3Array=function(e,t){var n=osg.Uniform.createFloat3.call(this,e,t);return n.update=osg.Uniform.prototype._updateArray,n},osg.Uniform.createFloat4=function(e,t){var n=e,r=t;r===undefined&&(r=n,n=[0,0,0,0]);var i=new osg.Uniform;return i.data=n,i.glCall=function(e,t){gl.uniform4fv(e,t)},i.glData=new osg.Float32Array(i.data),i.update=osg.Uniform.prototype._updateFloat4,i.name=r,i.type="vec4",i},osg.Uniform.vec4=osg.Uniform.createFloat4,osg.Uniform.createFloat4Array=function(e,t){var n=osg.Uniform.createFloat4.call(this,e,t);return n.update=osg.Uniform.prototype._updateArray,n},osg.Uniform.createInt1=function(e,t){var n=e,r=t;r===undefined&&(r=n,n=[0]);var i=new osg.Uniform;return i.data=[n],i.glCall=function(e,t){gl.uniform1iv(e,t)},i.set=function(e){typeof e=="number"?this.data[0]=e:this.data=e,this.dirty()},i.glData=new osg.Int32Array(i.data),i.name=r,i.type="int",i},osg.Uniform.int=osg.Uniform.createInt1,osg.Uniform.createInt=osg.Uniform.createInt1,osg.Uniform.createIntArray=function(e,t){var n=osg.Uniform.createInt.call(this,e,t);return n.update=osg.Uniform.prototype._updateArray,n},osg.Uniform.createInt2=function(e,t){var n=e,r=t;r===undefined&&(r=n,n=[0,0]);var i=new osg.Uniform;return i.data=n,i.glCall=function(e,t){gl.uniform2iv(e,t)},i.glData=new osg.Int32Array(i.data),i.name=r,i.type="vec2i",i},osg.Uniform.vec2i=osg.Uniform.createInt2,osg.Uniform.createInt2Array=function(e,t){var n=osg.Uniform.createInt2.call(this,e,t);return n.update=osg.Uniform.prototype._updateArray,n},osg.Uniform.createInt3=function(e,t){var n=e,r=t;r===undefined&&(r=n,n=[0,0,0]);var i=new osg.Uniform;return i.data=n,i.glCall=function(e,t){gl.uniform3iv(e,t)},i.glData=new osg.Int32Array(i.data),i.name=r,i.type="vec3i",i},osg.Uniform.vec3i=osg.Uniform.createInt3,osg.Uniform.createInt3Array=function(e,t){var n=osg.Uniform.createInt3.call(this,e,t);return n.update=osg.Uniform.prototype._updateArray,n},osg.Uniform.createInt4=function(e,t){var n=e,r=t;r===undefined&&(r=n,n=[0,0,0,0]);var i=new osg.Uniform;return i.data=n,i.glCall=function(e,t){gl.uniform4iv(e,t)},i.glData=new osg.Int32Array(i.data),i.name=r,i.type="vec4i",i},osg.Uniform.vec4i=osg.Uniform.createInt4,osg.Uniform.createInt4Array=function(e,t){var n=osg.Uniform.createInt4.call(this,e,t);return n.update=osg.Uniform.prototype._updateArray,n},osg.Uniform.createMatrix2=function(e,t){var n=e,r=t;r===undefined&&(r=n,n=[1,0,0,1]);var i=new osg.Uniform;return i.data=n,i.glCall=function(e,t,n){gl.uniformMatrix2fv(e,t,n)},i.apply=i.applyMatrix,i.transpose=!1,i.glData=new osg.Float32Array(i.data),i.update=osg.Uniform.prototype._updateFloat4,i.name=r,i.type="mat2",i},osg.Uniform.createMat2=osg.Uniform.createMatrix2,osg.Uniform.mat2=osg.Uniform.createMat2,osg.Uniform.createMatrix3=function(e,t){var n=e,r=t;r===undefined&&(r=n,n=[1,0,0,0,1,0,0,0,1]);var i=new osg.Uniform;return i.data=n,i.glCall=function(e,t,n){gl.uniformMatrix3fv(e,t,n)},i.apply=i.applyMatrix,i.transpose=!1,i.glData=new osg.Float32Array(i.data),i.update=osg.Uniform.prototype._updateFloat9,i.name=r,i.type="mat3",i},osg.Uniform.createMat3=osg.Uniform.createMatrix3,osg.Uniform.mat3=osg.Uniform.createMatrix3,osg.Uniform.createMatrix4=function(e,t){var n=e,r=t;r===undefined&&(r=n,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);var i=new osg.Uniform;return i.data=n,i.glCall=function(e,t,n){gl.uniformMatrix4fv(e,t,n)},i.apply=i.applyMatrix,i.transpose=!1,i.glData=new osg.Float32Array(i.data),i.update=osg.Uniform.prototype._updateFloat16,i.name=r,i.type="mat4",i},osg.Uniform.createMat4=osg.Uniform.createMatrix4,osg.Uniform.mat4=osg.Uniform.createMatrix4,osg.Node=function(){osg.Object.call(this),this.children=[],this.parents=[],this.nodeMask=-1,this.boundingSphere=new osg.BoundingSphere,this.boundingSphereComputed=!1,this._updateCallbacks=[],this._cullCallback=undefined},osg.Node.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.Object.prototype,{getOrCreateStateSet:function(){return this.stateset===undefined&&(this.stateset=new osg.StateSet),this.stateset},getStateSet:function(){return this.stateset},accept:function(e){e.validNodeMask(this)&&(e.pushOntoNodePath(this),e.apply(this),e.popFromNodePath())},dirtyBound:function(){if(this.boundingSphereComputed===!0){this.boundingSphereComputed=!1;for(var e=0,t=this.parents.length;e<t;e++)this.parents[e].dirtyBound()}},setNodeMask:function(e){this.nodeMask=e},getNodeMask:function(e){return this.nodeMask},setStateSet:function(e){this.stateset=e},setUpdateCallback:function(e){this._updateCallbacks[0]=e},getUpdateCallback:function(){return this._updateCallbacks[0]},addUpdateCallback:function(e){this._updateCallbacks.push(e)},removeUpdateCallback:function(e){var t=this._updateCallbacks.indexOf(e);t!==-1&&this._updateCallbacks.splice(t,1)},getUpdateCallbackList:function(){return this._updateCallbacks},setCullCallback:function(e){this._cullCallback=e},getCullCallback:function(){return this._cullCallback},hasChild:function(e){for(var t=0,n=this.children.length;t<n;t++)if(this.children[t]===e)return!0;return!1},addChild:function(e){var t=this.children.push(e);return e.addParent(this),this.dirtyBound(),t},getChildren:function(){return this.children},getParents:function(){return this.parents},addParent:function(e){this.parents.push(e)},removeParent:function(e){for(var t=0,n=this.parents.length,r=this.parents;t<n;t++)if(r[t]===e){r.splice(t,1);return}},removeChildren:function(){var e=this.children;if(e.length!==0){for(var t=0,n=e.length;t<n;t++)e[t].removeParent(this);this.children.splice(0,this.children.length),this.dirtyBound()}},removeChild:function(e){for(var t=0,n=this.children.length;t<n;t++)this.children[t]===e&&(e.removeParent(this),this.children.splice(t,1),this.dirtyBound())},traverse:function(e){for(var t=0,n=this.children.length;t<n;t++){var r=this.children[t];r.accept(e)}},ascend:function(e){for(var t=0,n=this.parents.length;t<n;t++){var r=this.parents[t];r.accept(e)}},getBound:function(){return this.boundingSphereComputed||(this.computeBound(this.boundingSphere),this.boundingSphereComputed=!0),this.boundingSphere},computeBound:function(e){var t=new osg.BoundingBox;t.init(),e.init();for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];(i.referenceFrame===undefined||i.referenceFrame===osg.Transform.RELATIVE_RF)&&t.expandBySphere(i.getBound())}if(!t.valid())return e;e._center=t.center(),e._radius=0;for(var s=0,o=this.children.length;s<o;s++){var u=this.children[s];(u.referenceFrame===undefined||u.referenceFrame===osg.Transform.RELATIVE_RF)&&e.expandRadiusBySphere(u.getBound())}return e},getWorldMatrices:function(e){var t=function(e){this.nodePaths=[],this.halt=e,osg.NodeVisitor.call(this,osg.NodeVisitor.TRAVERSE_PARENTS)};t.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{apply:function(e){e.parents.length===0||e===this.halt?this.nodePaths.push(this.nodePath.slice(0)):this.traverse(e)}});var n=new t(e);this.accept(n);var r=[];for(var i=0,s=n.nodePaths.length;i<s;i++){var o=n.nodePaths[i];o.length===0?r.push(osg.Matrix.makeIdentity([])):r.push(osg.computeLocalToWorld(o))}return r}}),"osg","Node"),osg.Node.prototype.objectType=osg.objectType.generate("Node"),osg.NodeVisitor=function(e){this.traversalMask=-1,this.nodeMaskOverride=0,this.traversalMode=e,e===undefined&&(this.traversalMode=osg.NodeVisitor.TRAVERSE_ALL_CHILDREN),this.nodePath=[]},osg.NodeVisitor.TRAVERSE_PARENTS=1,osg.NodeVisitor.TRAVERSE_ALL_CHILDREN=2,osg.NodeVisitor._traversalFunctions={},osg.NodeVisitor._traversalFunctions[osg.NodeVisitor.TRAVERSE_PARENTS]=function(e){e.ascend(this)},osg.NodeVisitor._traversalFunctions[osg.NodeVisitor.TRAVERSE_ALL_CHILDREN]=function(e){e.traverse(this)},osg.NodeVisitor._pushOntoNodePath={},osg.NodeVisitor._pushOntoNodePath[osg.NodeVisitor.TRAVERSE_PARENTS]=function(e){this.nodePath.unshift(e)},osg.NodeVisitor._pushOntoNodePath[osg.NodeVisitor.TRAVERSE_ALL_CHILDREN]=function(e){this.nodePath.push(e)},osg.NodeVisitor._popFromNodePath={},osg.NodeVisitor._popFromNodePath[osg.NodeVisitor.TRAVERSE_PARENTS]=function(){return this.nodePath.shift()},osg.NodeVisitor._popFromNodePath[osg.NodeVisitor.TRAVERSE_ALL_CHILDREN]=function(){this.nodePath.pop()},osg.NodeVisitor.prototype={setNodeMaskOverride:function(e){this.nodeMaskOverride=e},getNodeMaskOverride:function(){return this.nodeMaskOverride},setTraversalMask:function(e){this.traversalMask=e},getTraversalMask:function(){return this.traversalMask},pushOntoNodePath:function(e){osg.NodeVisitor._pushOntoNodePath[this.traversalMode].call(this,e)},popFromNodePath:function(){osg.NodeVisitor._popFromNodePath[this.traversalMode].call(this)},validNodeMask:function(e){var t=e.getNodeMask();return(this.traversalMask&(this.nodeMaskOverride|t))!==0},apply:function(e){this.traverse(e)},traverse:function(e){osg.NodeVisitor._traversalFunctions[this.traversalMode].call(this,e)}},osg.Transform=function(){osg.Node.call(this),this.referenceFrame=osg.Transform.RELATIVE_RF},osg.Transform.RELATIVE_RF=0,osg.Transform.ABSOLUTE_RF=1,osg.Transform.prototype=osg.objectInehrit(osg.Node.prototype,{setReferenceFrame:function(e){this.referenceFrame=e},getReferenceFrame:function(){return this.referenceFrame},computeBound:function(e){osg.Node.prototype.computeBound.call(this,e);if(!e.valid())return e;var t=osg.Matrix.makeIdentity([]);this.computeLocalToWorldMatrix(t);var n=osg.Vec3.copy(e._center,[]);n[0]+=e._radius,osg.Matrix.transformVec3(t,n,n);var r=osg.Vec3.copy(e._center,[]);r[1]+=e._radius,osg.Matrix.transformVec3(t,r,r);var i=osg.Vec3.copy(e._center,[]);i[2]+=e._radius,osg.Matrix.transformVec3(t,i,i),osg.Matrix.transformVec3(t,e._center,e._center),osg.Vec3.sub(n,e._center,n);var s=osg.Vec3.length(n);osg.Vec3.sub(r,e._center,r);var o=osg.Vec3.length(r);osg.Vec3.sub(i,e._center,i);var u=osg.Vec3.length(i);return e._radius=s,e._radius<o&&(e._radius=o),e._radius<u&&(e._radius=u),e}}),osg.computeLocalToWorld=function(e,t){var n=t;n===undefined&&(n=!0);var r=osg.Matrix.makeIdentity([]),i=0;if(n)for(i=e.length-1;i>0;i--){var s=e[i];if(s.objectType===osg.Camera.prototype.objectType&&(s.getReferenceFrame!==osg.Transform.RELATIVE_RF||s.getParents().length===0))break}for(var o=i,u=e.length;o<u;o++){var a=e[o];a.computeLocalToWorldMatrix&&a.computeLocalToWorldMatrix(r)}return r},osg.BlendFunc=function(e,t,n,r){osg.StateAttribute.call(this),this._sourceFactor=osg.BlendFunc.ONE,this._destinationFactor=osg.BlendFunc.ZERO,this._sourceFactorAlpha=this._sourceFactor,this._destinationFactorAlpha=this._destinationFactor,this._separate=!1,e!==undefined&&this.setSource(e),t!==undefined&&this.setDestination(t),n!==undefined&&this.setSourceAlpha(n),r!==undefined&&this.setDestinationAlpha(r)},osg.BlendFunc.ZERO=0,osg.BlendFunc.ONE=1,osg.BlendFunc.SRC_COLOR=768,osg.BlendFunc.ONE_MINUS_SRC_COLOR=769,osg.BlendFunc.SRC_ALPHA=770,osg.BlendFunc.ONE_MINUS_SRC_ALPHA=771,osg.BlendFunc.DST_ALPHA=772,osg.BlendFunc.ONE_MINUS_DST_ALPHA=773,osg.BlendFunc.DST_COLOR=774,osg.BlendFunc.ONE_MINUS_DST_COLOR=775,osg.BlendFunc.SRC_ALPHA_SATURATE=776,osg.BlendFunc.BLEND_DST_RGB=32968,osg.BlendFunc.BLEND_SRC_RGB=32969,osg.BlendFunc.BLEND_DST_ALPHA=32970,osg.BlendFunc.BLEND_SRC_ALPHA=32971,osg.BlendFunc.CONSTANT_COLOR=32769,osg.BlendFunc.ONE_MINUS_CONSTANT_COLOR=32770,osg.BlendFunc.CONSTANT_ALPHA=32771,osg.BlendFunc.ONE_MINUS_CONSTANT_ALPHA=32772,osg.BlendFunc.BLEND_COLOR=32773,osg.BlendFunc.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"BlendFunc",cloneType:function(){return new osg.BlendFunc},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setSource:function(e){this.setSourceRGB(e),this.setSourceAlpha(e)},setDestination:function(e){this.setDestinationRGB(e),this.setDestinationAlpha(e)},checkSeparate:function(){return this._sourceFactor!==this._sourceFactorAlpha||this._destinationFactor!==this._destinationFactorAlpha},setSourceRGB:function(e){typeof e=="string"?this._sourceFactor=osg.BlendFunc[e]:this._sourceFactor=e,this._separate=this.checkSeparate()},setSourceAlpha:function(e){typeof e=="string"?this._sourceFactorAlpha=osg.BlendFunc[e]:this._sourceFactorAlpha=e,this._separate=this.checkSeparate()},setDestinationRGB:function(e){typeof e=="string"?this._destinationFactor=osg.BlendFunc[e]:this._destinationFactor=e,this._separate=this.checkSeparate()},setDestinationAlpha:function(e){typeof e=="string"?this._destinationFactorAlpha=osg.BlendFunc[e]:this._destinationFactorAlpha=e,this._separate=this.checkSeparate()},apply:function(e){var t=e.getGraphicContext();t.enable(t.BLEND),this._separate?t.blendFuncSeparate(this._sourceFactor,this._destinationFactor,this._sourceFactorAlpha,this._destinationFactorAlpha):t.blendFunc(this._sourceFactor,this._destinationFactor)}}),"osg","BlendFunc"),osg.BlendColor=function(e){osg.StateAttribute.call(this),this._constantColor=new Array(4),this._constantColor[0]=this._constantColor[1]=this._constantColor[2]=this._constantColor[3]=1,e!==undefined&&this.setConstantColor(e)},osg.BlendColor.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"BlendColor",cloneType:function(){return new osg.BlendColor},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setConstantColor:function(e){osg.Vec4.copy(e,this._constantColor)},getConstantColor:function(){return this._constantColor},apply:function(e){var t=e.getGraphicContext();t.blendColor(this._constantColor[0],this._constantColor[1],this._constantColor[2],this._constantColor[3]),this._dirty=!1}}),"osg","BlendColor"),osg.BoundingBox=function(){this.init()},osg.BoundingBox.prototype=osg.objectLibraryClass({_cache_radius2_tmp:[0,0,0],init:function(){this._min=[Infinity,Infinity,Infinity],this._max=[-Infinity,-Infinity,-Infinity]},valid:function(){return this._max[0]>=this._min[0]&&this._max[1]>=this._min[1]&&this._max[2]>=this._min[2]},expandBySphere:function(e){if(!e.valid())return;var t=this._max,n=this._min;n[0]=Math.min(n[0],e._center[0]-e._radius),n[1]=Math.min(n[1],e._center[1]-e._radius),n[2]=Math.min(n[2],e._center[2]-e._radius),t[0]=Math.max(t[0],e._center[0]+e._radius),t[1]=Math.max(t[1],e._center[1]+e._radius),t[2]=Math.max(t[2],e._center[2]+e._radius)},expandByVec3:function(e){var t=this._min,n=this._max;t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),n[0]=Math.max(n[0],e[0]),n[1]=Math.max(n[1],e[1]),n[2]=Math.max(n[2],e[2])},center:function(){var e=this._min,t=this._max;return[(e[0]+t[0])*.5,(e[1]+t[1])*.5,(e[2]+t[2])*.5]},radius:function(){return Math.sqrt(this.radius2())},radius2:function(){var e=this._min,t=this._max,n=this._cache_radius2_tmp;return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],.25*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])},corner:function(e){return ret=[0,0,0],e&1?ret[0]=this._max[0]:ret[0]=this._min[0],e&2?ret[1]=this._max[1]:ret[1]=this._min[1],e&4?ret[2]=this._max[2]:ret[2]=this._min[2],ret}},"osg","BoundingBox"),osg.BoundingSphere=function(){this._center=[0,0,0],this._radius=-1},osg.BoundingSphere.prototype={init:function(){this._center=[0,0,0],this._radius=-1},valid:function(){return this._radius>=0},set:function(e,t){this._center=e,this._radius=t},center:function(){return this._center},radius:function(){return this._radius},radius2:function(){return this._radius*this._radius},expandByBox:function(e){if(e.valid()){var t;if(this.valid()){var n=new osg.BoundingBox;n._min[0]=e._min[0],n._min[1]=e._min[1],n._min[2]=e._min[2],n._max[0]=e._max[0],n._max[1]=e._max[1],n._max[2]=e._max[2];for(var r=0;r<8;r++){var i=osg.Vec3.sub(e.corner(t),this._center,[]);osg.Vec3.normalize(i,i),nv[0]*=-this._radius,nv[1]*=-this._radius,nv[2]*=-this._radius,nv[0]+=this._center[0],nv[1]+=this._center[1],nv[2]+=this._center[2],n.expandBy(nv)}t=n.center(),this._center[0]=t[0],this._center[1]=t[1],this._center[2]=t[2],this._radius=n.radius()}else t=e.center(),this._center[0]=t[0],this._center[1]=t[1],this._center[2]=t[2],this._radius=e.radius()}},expandByVec3:function(e){if(this.valid()){var t=osg.Vec3.sub(e,this.center(),[]);r=osg.Vec3.length(t),r>this.radius()&&(dr=(r-this.radius())*.5,this._center[0]+=t[0]*(dr/r),this._center[1]+=t[1]*(dr/r),this._center[2]+=t[2]*(dr/r),this._radius+=dr)}else this._center[0]=e[0],this._center[1]=e[1],this._center[2]=e[2],this._radius=0},expandRadiusBySphere:function(e){if(e.valid())if(this.valid()){var t=osg.Vec3.sub,n=osg.Vec3.length,r=n(t(e._center,this._center,[]))+e._radius;r>this._radius&&(this._radius=r)}else this._center=osg.Vec3.copy(e._center,[]),this._radius=e._radius},expandBy:function(e){if(!e.valid())return;if(!this.valid()){this._center[0]=e._center[0],this._center[1]=e._center[1],this._center[2]=e._center[2],this._radius=e.radius();return}var t=osg.Vec3.sub(this.center(),e.center(),[]);d=osg.Vec3.length(t);if(d+e.radius()<=this.radius())return;if(d+this.radius()<=e.radius()){this._center[0]=e._center[0],this._center[1]=e._center[1],this._center[2]=e._center[2],this._radius=e._radius;return}new_radius=(this.radius()+d+e.radius())*.5,ratio=(new_radius-this.radius())/d,this._center[0]+=(e._center[0]-this._center[0])*ratio,this._center[1]+=(e._center[1]-this._center[1])*ratio,this._center[2]+=(e._center[2]-this._center[2])*ratio,this._radius=new_radius},contains:function(e){var t=osg.Vec3.sub(e,this.center(),[]);return valid()&&osg.Vec3.length2(t)<=radius2()},intersects:function(e){var t=osg.Vec3.length2(osg.Vec3.sub(this.center(),e.center(),[]));return valid()&&e.valid()&&t<=(this.radius()+e.radius())*(this.radius()+e.radius())}},osg.BufferArray=function(e,t,n){osg.BufferArray.instanceID===undefined&&(osg.BufferArray.instanceID=0),this.instanceID=osg.BufferArray.instanceID,osg.BufferArray.instanceID+=1,this.dirty(),this._itemSize=n,typeof e=="string"&&(e=osg.BufferArray[e]),this._type=e,t!==undefined&&(this._type===osg.BufferArray.ELEMENT_ARRAY_BUFFER?this._elements=new osg.Uint16Array(t):this._elements=new osg.Float32Array(t))},osg.BufferArray.ELEMENT_ARRAY_BUFFER=34963,osg.BufferArray.ARRAY_BUFFER=34962,osg.BufferArray.prototype={setItemSize:function(e){this._itemSize=e},isValid:function(){return this._buffer!==undefined||this._elements!==undefined?!0:!1},releaseGLObjects:function(e){this._buffer!==undefined&&this._buffer!==null&&e.deleteBuffer(this._buffer),this._buffer=undefined},bind:function(e){var t=this._type,n=this._buffer;if(n){e.bindBuffer(t,n);return}!n&&this._elements.length>0&&(this._buffer=e.createBuffer(),this._numItems=this._elements.length/this._itemSize,e.bindBuffer(t,this._buffer))},getItemSize:function(){return this._itemSize},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},compile:function(e){this._dirty&&(e.bufferData(this._type,this._elements,e.STATIC_DRAW),this._dirty=!1)},getElements:function(){return this._elements},setElements:function(e){this._elements=e,this._dirty=!0}},osg.BufferArray.create=function(e,t,n){return osg.log("osg.BufferArray.create is deprecated, use new osg.BufferArray with same arguments instead"),new osg.BufferArray(e,t,n)},osg.CullFace=function(e){osg.StateAttribute.call(this),e===undefined&&(e=osg.CullFace.BACK),this.setMode(e)},osg.CullFace.DISABLE=0,osg.CullFace.FRONT=1028,osg.CullFace.BACK=1029,osg.CullFace.FRONT_AND_BACK=1032,osg.CullFace.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"CullFace",cloneType:function(){return new osg.CullFace},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setMode:function(e){typeof e=="string"&&(e=osg.CullFace[e]),this._mode=e},getMode:function(){return this._mode},apply:function(e){var t=e.getGraphicContext();this._mode===osg.CullFace.DISABLE?t.disable(t.CULL_FACE):(t.enable(t.CULL_FACE),t.cullFace(this._mode)),this._dirty=!1}}),"osg","CullFace"),osg.CullSettings=function(){this._computeNearFar=!0,this._nearFarRatio=.005;var e=[0,0,-1];this.bbCornerFar=(e[0]>=0?1:0)|(e[1]>=0?2:0)|(e[2]>=0?4:0),this.bbCornerNear=~this.bbCornerFar&7},osg.CullSettings.prototype={setCullSettings:function(e){this._computeNearFar=e._computeNearFar,this._nearFarRatio=e._nearFarRatio},setNearFarRatio:function(e){this._nearFarRatio=e},getNearFarRatio:function(){return this._nearFarRatio},setComputeNearFar:function(e){this._computeNearFar=e},getComputeNearFar:function(){return this._computeNearFar}},osg.Camera=function(){osg.Transform.call(this),osg.CullSettings.call(this),this.viewport=undefined,this.setClearColor([0,0,0,1]),this.setClearDepth(1),this.setClearMask(osg.Camera.COLOR_BUFFER_BIT|osg.Camera.DEPTH_BUFFER_BIT),this.setViewMatrix(osg.Matrix.makeIdentity([])),this.setProjectionMatrix(osg.Matrix.makeIdentity([])),this.renderOrder=osg.Camera.NESTED_RENDER,this.renderOrderNum=0},osg.Camera.PRE_RENDER=0,osg.Camera.NESTED_RENDER=1,osg.Camera.POST_RENDER=2,osg.Camera.COLOR_BUFFER_BIT=16384,osg.Camera.DEPTH_BUFFER_BIT=256,osg.Camera.STENCIL_BUFFER_BIT=1024,osg.Camera.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.CullSettings.prototype,osg.objectInehrit(osg.Transform.prototype,{setClearDepth:function(e){this.clearDepth=e},getClearDepth:function(){return this.clearDepth},setClearMask:function(e){this.clearMask=e},getClearMask:function(){return this.clearMask},setClearColor:function(e){this.clearColor=e},getClearColor:function(){return this.clearColor},setViewport:function(e){this.viewport=e,this.getOrCreateStateSet().setAttributeAndMode(e)},getViewport:function(){return this.viewport},setViewMatrix:function(e){this.modelviewMatrix=e},setProjectionMatrix:function(e){this.projectionMatrix=e},setProjectionMatrixAsOrtho:function(e,t,n,r,i,s){osg.Matrix.makeOrtho(e,t,n,r,i,s,this.getProjectionMatrix())},getViewMatrix:function(){return this.modelviewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getRenderOrder:function(){return this.renderOrder},setRenderOrder:function(e,t){this.renderOrder=e,this.renderOrderNum=t},attachTexture:function(e,t,n){this.frameBufferObject&&this.frameBufferObject.dirty(),n===undefined&&(n=0),this.attachments===undefined&&(this.attachments={}),this.attachments[e]={texture:t,level:n}},attachRenderBuffer:function(e,t){this.frameBufferObject&&this.frameBufferObject.dirty(),this.attachments===undefined&&(this.attachments={}),this.attachments[e]={format:t}},computeLocalToWorldMatrix:function(e,t){return this.referenceFrame===osg.Transform.RELATIVE_RF?osg.Matrix.preMult(e,this.modelviewMatrix):e=this.modelviewMatrix,!0},computeWorldToLocalMatrix:function(e,t){var n=[];return osg.Matrix.inverse(this.modelviewMatrix,n),this.referenceFrame===osg.Transform.RELATIVE_RF?osg.Matrix.postMult(n,e):e=n,!0}})),"osg","Camera"),osg.Camera.prototype.objectType=osg.objectType.generate("Camera"),osg.Depth=function(e,t,n,r){osg.StateAttribute.call(this),this._func=osg.Depth.LESS,this._near=0,this._far=1,this._writeMask=!0,e!==undefined&&(typeof e=="string"?this._func=osg.Depth[e]:this._func=e),t!==undefined&&(this._near=t),n!==undefined&&(this._far=n),r!==undefined&&(this._writeMask=r)},osg.Depth.DISABLE=0,osg.Depth.NEVER=512,osg.Depth.LESS=513,osg.Depth.EQUAL=514,osg.Depth.LEQUAL=515,osg.Depth.GREATE=516,osg.Depth.NOTEQU=517,osg.Depth.GEQUAL=518,osg.Depth.ALWAYS=519,osg.Depth.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"Depth",cloneType:function(){return new osg.Depth},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setRange:function(e,t){this._near=e,this._far=t},setWriteMask:function(e){this._writeMask=e},apply:function(e){var t=e.getGraphicContext();this._func===0?t.disable(t.DEPTH_TEST):(t.enable(t.DEPTH_TEST),t.depthFunc(this._func),t.depthMask(this._writeMask),t.depthRange(this._near,this._far))}}),"osg","Depth"),osg.WGS_84_RADIUS_EQUATOR=6378137,osg.WGS_84_RADIUS_POLAR=6356752.3142,osg.EllipsoidModel=function(){this._radiusEquator=osg.WGS_84_RADIUS_EQUATOR,this._radiusPolar=osg.WGS_84_RADIUS_POLAR,this.computeCoefficients()},osg.EllipsoidModel.prototype={setRadiusEquator:function(e){this._radiusEquator=radius,this.computeCoefficients()},getRadiusEquator:function(){return this._radiusEquator},setRadiusPolar:function(e){this._radiusPolar=e,this.computeCoefficients()},getRadiusPolar:function(){return this._radiusPolar},convertLatLongHeightToXYZ:function(e,t,n,r){r===undefined&&(osg.warn("deprecated, use this signature convertLatLongHeightToXYZ( latitude, longitude, height, result )"),r=[]);var i=Math.sin(e),s=Math.cos(e),o=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*i*i),u=(o+n)*s*Math.cos(t),a=(o+n)*s*Math.sin(t),f=(o*(1-this._eccentricitySquared)+n)*i;return r[0]=u,r[1]=a,r[2]=f,r},convertXYZToLatLongHeight:function(e,t,n,r){r===undefined&&(osg.warn("deprecated, use this signature convertXYZToLatLongHeight( X,  Y,  Z , result)"),r=[]);var i=Math.sqrt(e*e+t*t),s=Math.atan2(n*this._radiusEquator,i*this._radiusPolar),o=(this._radiusEquator*this._radiusEquator-this._radiusPolar*this._radiusPolar)/(this._radiusPolar*this._radiusPolar),u=Math.sin(s),a=Math.cos(s);latitude=Math.atan((n+o*this._radiusPolar*u*u*u)/(i-this._eccentricitySquared*this._radiusEquator*a*a*a)),longitude=Math.atan2(t,e);var f=Math.sin(latitude),l=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*f*f);return height=i/Math.cos(latitude)-l,r[0]=latitude,r[1]=longitude,r[2]=height,r},computeLocalUpVector:function(e,t,n){var r,i,s,o=this.convertXYZToLatLongHeight(e,t,n,r,i,s);return r=o[0],i=o[1],s=o[2],[Math.cos(i)*Math.cos(r),Math.sin(i)*Math.cos(r),Math.sin(r)]},isWGS84:function(){return this._radiusEquator==osg.WGS_84_RADIUS_EQUATOR&&this._radiusPolar==osg.WGS_84_RADIUS_POLAR},computeCoefficients:function(){var e=(this._radiusEquator-this._radiusPolar)/this._radiusEquator;this._eccentricitySquared=2*e-e*e},computeLocalToWorldTransformFromLatLongHeight:function(e,t,n,r){r===undefined&&(osg.warn("deprecated, use this signature computeLocalToWorldTransformFromLatLongHeight(latitude, longitude, height, result)"),r=new Array(16));var i=this.convertLatLongHeightToXYZ(e,t,n,r),s=osg.Matrix.makeTranslate(i[0],i[1],i[2],r);return this.computeCoordinateFrame(e,t,r),r},computeLocalToWorldTransformFromXYZ:function(e,t,n){var r=this.convertXYZToLatLongHeight(e,t,n),i=osg.Matrix.makeTranslate(e,t,n);return this.computeCoordinateFrame(r[0],r[1],i),i},computeCoordinateFrame:function(e,t,n){var r=[Math.cos(t)*Math.cos(e),Math.sin(t)*Math.cos(e),Math.sin(e)],i=[-Math.sin(t),Math.cos(t),0],s=osg.Vec3.cross(r,i,[]);osg.Matrix.set(n,0,0,i[0]),osg.Matrix.set(n,0,1,i[1]),osg.Matrix.set(n,0,2,i[2]),osg.Matrix.set(n,1,0,s[0]),osg.Matrix.set(n,1,1,s[1]),osg.Matrix.set(n,1,2,s[2]),osg.Matrix.set(n,2,0,r[0]),osg.Matrix.set(n,2,1,r[1]),osg.Matrix.set(n,2,2,r[2])}},osg.FrameBufferObject=function(){osg.StateAttribute.call(this),this.fbo=undefined,this.attachments=[],this.dirty()},osg.FrameBufferObject.COLOR_ATTACHMENT0=36064,osg.FrameBufferObject.DEPTH_ATTACHMENT=36096,osg.FrameBufferObject.DEPTH_COMPONENT16=33189,osg.FrameBufferObject.prototype=osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"FrameBufferObject",cloneType:function(){return new osg.FrameBufferObject},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setAttachment:function(e){this.attachments.push(e)},_reportFrameBufferError:function(e){switch(e){case 36054:osg.debug("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case 36055:osg.debug("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case 36057:osg.debug("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case 36061:osg.debug("FRAMEBUFFER_UNSUPPORTED");break;default:osg.debug("FRAMEBUFFER unknown error "+e.toString(16))}},apply:function(e){var t=e.getGraphicContext(),n;if(this.attachments.length>0)if(this.isDirty()){this.fbo||(this.fbo=t.createFramebuffer()),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo);var r=!1;for(var i=0,s=this.attachments.length;i<s;++i)if(this.attachments[i].texture===undefined){var o=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,o),t.renderbufferStorage(t.RENDERBUFFER,this.attachments[i].format,this.attachments[i].width,this.attachments[i].height),t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachments[i].attachment,t.RENDERBUFFER,o),r=!0}else{var u=this.attachments[i].texture;e.applyTextureAttribute(0,u),t.framebufferTexture2D(t.FRAMEBUFFER,this.attachments[i].attachment,u.getTextureTarget(),u.getTextureObject(),this.attachments[i].level)}n=t.checkFramebufferStatus(t.FRAMEBUFFER),n!==36053&&this._reportFrameBufferError(n),r&&t.bindRenderbuffer(t.RENDERBUFFER,null),this.setDirty(!1)}else t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),osg.reportWebGLError===!0&&(n=t.checkFramebufferStatus(t.FRAMEBUFFER),n!==36053&&this._reportFrameBufferError(n));else t.bindFramebuffer(t.FRAMEBUFFER,null)}}),osg.FrameStamp=function(){var e=0,t=0,n=0;this.setReferenceTime=function(e){t=e},this.setSimulationTime=function(e){n=e},this.getReferenceTime=function(){return t},this.getSimulationTime=function(){return n},this.setFrameNumber=function(t){e=t},this.getFrameNumber=function(){return e}},osg.Geometry=function(){osg.Node.call(this),this.primitives=[],this.attributes={},this.boundingBox=new osg.BoundingBox,this.boundingBoxComputed=!1,this.cacheAttributeList={}},osg.Geometry.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.Node.prototype,{releaseGLObjects:function(e){var t;for(t in this.attributes)this.attributes[t].releaseGLObjects(e);for(var n=0,r=this.primitives.length;n<r;n++){var i=this.primitives[n];i.getIndices!==undefined&&i.getIndices()!==undefined&&i.getIndices()!==null&&i.indices.releaseGLObjects(e)}},dirtyBound:function(){this.boundingBoxComputed===!0&&(this.boundingBoxComputed=!1),osg.Node.dirtyBound.call(this)},dirty:function(){this.cacheAttributeList={}},getPrimitives:function(){return this.primitives},getAttributes:function(){return this.attributes},getVertexAttributeList:function(){return this.attributes},getPrimitiveSetList:function(){return this.primitives},drawImplementation:function(e){var t=e.getLastProgramApplied(),n=t.instanceID;if(this.cacheAttributeList[n]===undefined){var r,i=t.attributesCache,s=[],o="//generated by Geometry::implementation\n";o+="state.lazyDisablingOfVertexAttributes();\n",o+="var attr;\n";for(var u=0,a=i.attributeKeys.length;u<a;u++){var f=i.attributeKeys[u];r=i[f];var l=this.attributes[f];if(l===undefined)continue;s.push(r),o+='attr = this.attributes["'+f+'"];\n',o+="if (!attr.isValid()) { return; }\n",o+="state.setVertexAttribArray("+r+", attr, false);\n"}o+="state.applyDisablingOfVertexAttributes();\n";var c=this.primitives;o+="var primitives = this.primitives;\n";for(var h=0,p=c.length;h<p;++h)o+="primitives["+h+"].draw(state);\n";this.cacheAttributeList[n]=new Function("state",o)}this.cacheAttributeList[n].call(this,e)},drawImplementationDummy:function(e){var t=e.getLastProgramApplied(),n,r=[],i=t.attributesCache,s=this.primitives;for(var o=0,u=s.length;o<u;++o);},getBoundingBox:function(){return this.boundingBoxComputed||(this.computeBoundingBox(this.boundingBox),this.boundingBoxComputed=!0),this.boundingBox},computeBoundingBox:function(e){var t=this.getAttributes().Vertex;if(t!==undefined&&t.getElements()!==undefined&&t.getItemSize()>2){var n=[0,0,0];vertexes=t.getElements();for(var r=0,i=vertexes.length;r<i;r+=3)n[0]=vertexes[r],n[1]=vertexes[r+1],n[2]=vertexes[r+2],e.expandByVec3(n)}return e},computeBound:function(e){e.init();var t=this.getBoundingBox();return e.expandByBox(t),e}}),"osg","Geometry"),osg.Geometry.prototype.objectType=osg.objectType.generate("Geometry"),osg.Light=function(e){osg.StateAttribute.call(this),e===undefined&&(e=0),this._ambient=[.2,.2,.2,1],this._diffuse=[.8,.8,.8,1],this._specular=[.2,.2,.2,1],this._position=[0,0,1,0],this._direction=[0,0,-1],this._spotCutoff=180,this._spotBlend=.01,this._constantAttenuation=1,this._linearAttenuation=0,this._quadraticAttenuation=0,this._lightUnit=e,this._enabled=0,this.dirty()},osg.Light.uniforms={},osg.Light.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"Light",cloneType:function(){return new osg.Light(this._lightUnit)},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType+this._lightUnit},getOrCreateUniforms:function(){var e=osg.Light.uniforms,t=this.getTypeMember();if(e[t]===undefined){var n=osg.Uniform;e[t]={ambient:n.createFloat4([.2,.2,.2,1],this.getUniformName("ambient")),diffuse:n.createFloat4([.8,.8,.8,1],this.getUniformName("diffuse")),specular:n.createFloat4([.2,.2,.2,1],this.getUniformName("specular")),position:n.createFloat4([0,0,1,0],this.getUniformName("position")),direction:n.createFloat3([0,0,1],this.getUniformName("direction")),spotCutoff:n.createFloat1(180,this.getUniformName("spotCutoff")),spotBlend:n.createFloat1(.01,this.getUniformName("spotBlend")),constantAttenuation:n.createFloat1(0,this.getUniformName("constantAttenuation")),linearAttenuation:n.createFloat1(0,this.getUniformName("linearAttenuation")),quadraticAttenuation:n.createFloat1(0,this.getUniformName("quadraticAttenuation")),enable:n.createInt1(0,this.getUniformName("enable")),matrix:n.createMatrix4(osg.Matrix.makeIdentity([]),this.getUniformName("matrix")),invMatrix:n.createMatrix4(osg.Matrix.makeIdentity([]),this.getUniformName("invMatrix"))},e[t].uniformKeys=Object.keys(e[t])}return e[t]},setPosition:function(e){osg.Vec4.copy(e,this._position)},getPosition:function(){return this._position},setAmbient:function(e){this._ambient=e,this.dirty()},setSpecular:function(e){this._specular=e,this.dirty()},setDiffuse:function(e){this._diffuse=e,this.dirty()},setSpotCutoff:function(e){this._spotCutoff=e,this.dirty()},getSpotCutoff:function(){return this._spotCutoff},setSpotBlend:function(e){this._spotBlend=e,this.dirty()},getSpotBlend:function(){return this._spotBlend},setConstantAttenuation:function(e){this._constantAttenuation=e,this.dirty()},setLinearAttenuation:function(e){this._linearAttenuation=e,this.dirty()},setQuadraticAttenuation:function(e){this._quadraticAttenuation=e,this.dirty()},setDirection:function(e){this._direction=e,this.dirty()},getDirection:function(){return this._direction},setLightNumber:function(e){this._lightUnit=e,this.dirty()},getLightNumber:function(){return this._lightUnit},getPrefix:function(){return this.getType()+this._lightUnit},getParameterName:function(e){return this.getPrefix()+"_"+e},getUniformName:function(e){return this.getPrefix()+"_uniform_"+e},applyPositionedUniform:function(e,t){var n=this.getOrCreateUniforms();osg.Matrix.copy(e,n.matrix.get()),n.matrix.dirty(),osg.Matrix.copy(e,n.invMatrix.get()),n.invMatrix.get()[12]=0,n.invMatrix.get()[13]=0,n.invMatrix.get()[14]=0,osg.Matrix.inverse(n.invMatrix.get(),n.invMatrix.get()),osg.Matrix.transpose(n.invMatrix.get(),n.invMatrix.get()),n.invMatrix.dirty()},apply:function(e){var t=this.getOrCreateUniforms();t.ambient.set(this._ambient),t.diffuse.set(this._diffuse),t.specular.set(this._specular),t.position.set(this._position),t.direction.set(this._direction);var n=Math.cos(this._spotCutoff*Math.PI/180);t.spotCutoff.get()[0]=n,t.spotCutoff.dirty(),t.spotBlend.get()[0]=(1-n)*this._spotBlend,t.spotBlend.dirty(),t.constantAttenuation.get()[0]=this._constantAttenuation,t.constantAttenuation.dirty(),t.linearAttenuation.get()[0]=this._linearAttenuation,t.linearAttenuation.dirty(),t.quadraticAttenuation.get()[0]=this._quadraticAttenuation,t.quadraticAttenuation.dirty(),this.setDirty(!1)},_replace:function(e,t,n,r){for(var i=0,s=t.length;i<s;i++){var o=new RegExp(e+t[i],"g");n=n.replace(o,r.call(this,t[i]))}return n},_shader:{},_shaderCommon:{},generateShader:function(e){return this._shader[e]?this._shader[e].call(this):""},generateShaderCommon:function(e){return this._shaderCommon[e]?this._shaderCommon[e].call(this):""}}),"osg","Light"),osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.VertexInit]=function(){return["","varying vec3 FragNormal;","varying vec3 FragEyeVector;","",""].join("\n")},osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.VertexFunction]=function(){return["","vec3 computeNormal() {","   return vec3(NormalMatrix * vec4(Normal, 0.0));","}","","vec3 computeEyeVertex() {","   return vec3(ModelViewMatrix * vec4(Vertex,1.0));","}","",""].join("\n")},osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.VertexMain]=function(){return["","  FragEyeVector = computeEyeVertex();","  FragNormal = computeNormal();",""].join("\n")},osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.FragmentInit]=function(){return["varying vec3 FragNormal;","varying vec3 FragEyeVector;",""].join("\n")},osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.FragmentFunction]=function(){return["","float getLightAttenuation(vec3 lightDir, float constant, float linear, float quadratic) {","    ","    float d = length(lightDir);","    float att = 1.0 / ( constant + linear*d + quadratic*d*d);","    return att;","}","vec4 computeLightContribution(vec4 materialAmbient,","                              vec4 materialDiffuse,","                              vec4 materialSpecular,","                              float materialShininess,","                              vec4 lightAmbient,","                              vec4 lightDiffuse,","                              vec4 lightSpecular,","                              vec3 normal,","                              vec3 eye,","                              vec3 lightDirection,","                              vec3 lightSpotDirection,","                              float lightCosSpotCutoff,","                              float lightSpotBlend,","                              float lightAttenuation)","{","    vec3 L = lightDirection;","    vec3 N = normal;","    float NdotL = max(dot(L, N), 0.0);","    float halfTerm = NdotL;","    vec4 ambient = lightAmbient;","    vec4 diffuse = vec4(0.0);","    vec4 specular = vec4(0.0);","    float spot = 0.0;","","    if (NdotL > 0.0) {","        vec3 E = eye;","        vec3 R = reflect(-L, N);","        float RdotE = max(dot(R, E), 0.0);","        if ( RdotE > 0.0) {","           RdotE = pow( RdotE, materialShininess );","        }","        vec3 D = lightSpotDirection;","        spot = 1.0;","        if (lightCosSpotCutoff > 0.0) {","          float cosCurAngle = dot(-L, D);","          if (cosCurAngle < lightCosSpotCutoff) {","             spot = 0.0;","          } else {","             if (lightSpotBlend > 0.0)","               spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle-lightCosSpotCutoff)/(lightSpotBlend));","          }","        }","        diffuse = lightDiffuse * ((halfTerm));","        specular = lightSpecular * RdotE;","    }","","    return (materialAmbient*ambient + (materialDiffuse*diffuse + materialSpecular*specular) * spot) * lightAttenuation;","}","float linearrgb_to_srgb1(const in float c)","{","  float v = 0.0;","  if(c < 0.0031308) {","    if ( c > 0.0)","      v = c * 12.92;","  } else {","    v = 1.055 * pow(c, 1.0/2.4) - 0.055;","  }","  return v;","}","vec4 linearrgb_to_srgb(const in vec4 col_from)","{","  vec4 col_to;","  col_to.r = linearrgb_to_srgb1(col_from.r);","  col_to.g = linearrgb_to_srgb1(col_from.g);","  col_to.b = linearrgb_to_srgb1(col_from.b);","  col_to.a = col_from.a;","  return col_to;","}","float srgb_to_linearrgb1(const in float c)","{","  float v = 0.0;","  if(c < 0.04045) {","    if (c >= 0.0)","      v = c * (1.0/12.92);","  } else {","    v = pow((c + 0.055)*(1.0/1.055), 2.4);","  }"," return v;","}","vec4 srgb2linear(const in vec4 col_from)","{","  vec4 col_to;","  col_to.r = srgb_to_linearrgb1(col_from.r);","  col_to.g = srgb_to_linearrgb1(col_from.g);","  col_to.b = srgb_to_linearrgb1(col_from.b);","  col_to.a = col_from.a;","  return col_to;","}",""].join("\n")},osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.FragmentMain]=function(){return["","  vec3 normal = normalize(FragNormal);","  vec3 eyeVector = normalize(-FragEyeVector);","  vec4 lightColor = MaterialEmission;",""].join("\n")},osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.FragmentEnd]=function(){return["","  fragColor *= lightColor;",""].join("\n")},osg.Light.prototype._shader[osg.ShaderGeneratorType.FragmentInit]=function(){var e=["","uniform vec4 Light_position;","uniform vec3 Light_direction;","uniform mat4 Light_matrix;","uniform mat4 Light_invMatrix;","uniform float Light_constantAttenuation;","uniform float Light_linearAttenuation;","uniform float Light_quadraticAttenuation;","uniform vec4 Light_ambient;","uniform vec4 Light_diffuse;","uniform vec4 Light_specular;","uniform float Light_spotCutoff;","uniform float Light_spotBlend;",""].join("\n");return uniforms=Object.keys(this.getOrCreateUniforms()),e=this._replace("Light_",uniforms,e,this.getUniformName),e},osg.Light.prototype._shader[osg.ShaderGeneratorType.FragmentMain]=function(){var e=["","  vec3 lightEye = vec3(Light_matrix * Light_position);","  vec3 lightDir;","  if (Light_position[3] == 1.0) {","    lightDir = lightEye - FragEyeVector;","  } else {","    lightDir = lightEye;","  }","  vec3 spotDirection = normalize(mat3(vec3(Light_invMatrix[0]), vec3(Light_invMatrix[1]), vec3(Light_invMatrix[2]))*Light_direction);","  float attenuation = getLightAttenuation(lightDir, Light_constantAttenuation, Light_linearAttenuation, Light_quadraticAttenuation);","  lightDir = normalize(lightDir);","  lightColor += computeLightContribution(MaterialAmbient,","                                         MaterialDiffuse, ","                                         MaterialSpecular,","                                         MaterialShininess,","                                         Light_ambient,","                                         Light_diffuse,","                                         Light_specular,","                                         normal,","                                         eyeVector,","                                         lightDir,","                                         spotDirection,","                                         Light_spotCutoff,","                                         Light_spotBlend,","                                         attenuation);",""].join("\n"),t=["lightEye","lightDir","spotDirection","attenuation"];return e=this._replace("",t,e,this.getParameterName),uniforms=Object.keys(this.getOrCreateUniforms()),e=this._replace("Light_",uniforms,e,this.getUniformName),e},osg.LightSource=function(){osg.Node.call(this),this._light=undefined},osg.LightSource.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.Node.prototype,{getLight:function(){return this._light},setLight:function(e){this._light=e}}),"osg","LightSource"),osg.LightSource.prototype.objectType=osg.objectType.generate("LightSource"),osg.LineWidth=function(e){osg.StateAttribute.call(this),this.lineWidth=1,e!==undefined&&(this.lineWidth=e)},osg.LineWidth.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"LineWidth",cloneType:function(){return new osg.LineWidth},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(e){e.getGraphicContext().lineWidth(this.lineWidth)}}),"osg","LineWidth"),osg.Material=function(){osg.StateAttribute.call(this),this.ambient=[.2,.2,.2,1],this.diffuse=[.8,.8,.8,1],this.specular=[0,0,0,1],this.emission=[0,0,0,1],this.shininess=12.5},osg.Material.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{setEmission:function(e){osg.Vec4.copy(e,this.emission),this._dirty=!0},setAmbient:function(e){osg.Vec4.copy(e,this.ambient),this._dirty=!0},setSpecular:function(e){osg.Vec4.copy(e,this.specular),this._dirty=!0},setDiffuse:function(e){osg.Vec4.copy(e,this.diffuse),this._dirty=!0},setShininess:function(e){this.shininess=e,this._dirty=!0},getEmission:function(){return this.emission},getAmbient:function(){return this.ambient},getSpecular:function(){return this.specular},getDiffuse:function(){return this.diffuse},getShininess:function(){return this.shininess},attributeType:"Material",cloneType:function(){return new osg.Material},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},getOrCreateUniforms:function(){if(osg.Material.uniforms===undefined){osg.Material.uniforms={ambient:osg.Uniform.createFloat4([0,0,0,0],"MaterialAmbient"),diffuse:osg.Uniform.createFloat4([0,0,0,0],"MaterialDiffuse"),specular:osg.Uniform.createFloat4([0,0,0,0],"MaterialSpecular"),emission:osg.Uniform.createFloat4([0,0,0,0],"MaterialEmission"),shininess:osg.Uniform.createFloat1([0],"MaterialShininess")};var e=[];for(var t in osg.Material.uniforms)e.push(t);osg.Material.uniforms.uniformKeys=e}return osg.Material.uniforms},apply:function(e){var t=this.getOrCreateUniforms();t.ambient.set(this.ambient),t.diffuse.set(this.diffuse),t.specular.set(this.specular),t.emission.set(this.emission),t.shininess.set([this.shininess]),this._dirty=!1},_shader:{},_shaderCommon:{},generateShader:function(e){return this._shader[e]?this._shader[e].call(this):""}}),"osg","Material"),osg.Material.prototype._shader[osg.ShaderGeneratorType.VertexInit]=function(){var e=["uniform vec4 MaterialAmbient;","uniform vec4 MaterialDiffuse;","uniform vec4 MaterialSpecular;","uniform vec4 MaterialEmission;","uniform float MaterialShininess;",""].join("\n");return e},osg.Material.prototype._shader[osg.ShaderGeneratorType.FragmentInit]=function(){var e=["uniform vec4 MaterialAmbient;","uniform vec4 MaterialDiffuse;","uniform vec4 MaterialSpecular;","uniform vec4 MaterialEmission;","uniform float MaterialShininess;",""].join("\n");return e},osg.MatrixTransform=function(){osg.Transform.call(this),this.matrix=osg.Matrix.makeIdentity([])},osg.MatrixTransform.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.Transform.prototype,{getMatrix:function(){return this.matrix},setMatrix:function(e){this.matrix=e},computeLocalToWorldMatrix:function(e,t){return this.referenceFrame===osg.Transform.RELATIVE_RF?osg.Matrix.preMult(e,this.matrix):e=this.matrix,!0},computeWorldToLocalMatrix:function(e,t){var n=[];return osg.Matrix.inverse(this.matrix,n),this.referenceFrame===osg.Transform.RELATIVE_RF?osg.Matrix.postMult(n,e):e=inverse,!0}}),"osg","MatrixTransform"),osg.MatrixTransform.prototype.objectType=osg.objectType.generate("MatrixTransform"),osg.PrimitiveSet=function(){},osg.PrimitiveSet.POINTS=0,osg.PrimitiveSet.LINES=1,osg.PrimitiveSet.LINE_LOOP=2,osg.PrimitiveSet.LINE_STRIP=3,osg.PrimitiveSet.TRIANGLES=4,osg.PrimitiveSet.TRIANGLE_STRIP=5,osg.PrimitiveSet.TRIANGLE_FAN=6,osg.DrawArrays=function(e,t,n){this.mode=e,this.first=t,this.count=n},osg.DrawArrays.prototype={draw:function(e){var t=e.getGraphicContext();t.drawArrays(this.mode,this.first,this.count)},getMode:function(){return this.mode},getCount:function(){return this.count},getFirst:function(){return this.first}},osg.DrawArrays.create=function(e,t,n){osg.log("osg.DrawArrays.create is deprecated, use new osg.DrawArrays with same arguments");var r=new osg.DrawArrays(e,t,n);return r},osg.DrawArrayLengths=function(e,t,n){this._mode=e,this._first=t,this._arrayLengths=n.slice(0)},osg.DrawArrayLengths.prototype={draw:function(e){var t=e.getGraphicContext(),n=this._mode,r=this._first,i=this._arrayLengths;for(var s=0,o=i.length;s<o;s++){var u=i[s];t.drawArrays(n,r,u),r+=u}},getMode:function(){return this._mode},getNumIndices:function(){var e=0,t=this._arrayLengths;for(var n=0,r=t.length;n<r;n++)e+=t[n];return e},getArrayLengths:function(){return this._arrayLengths},getFirst:function(){return this._first},setFirst:function(e){this._first=e}},osg.DrawElements=function(e,t){this.mode=osg.PrimitiveSet.POINTS,e!==undefined&&(this.mode=e),this.count=0,this.offset=0,this.indices=t,t!==undefined&&this.setIndices(t)},osg.DrawElements.prototype={getMode:function(){return this.mode},draw:function(e){e.setIndexArray(this.indices);var t=e.getGraphicContext();t.drawElements(this.mode,this.count,t.UNSIGNED_SHORT,this.offset)},setIndices:function(e){this.indices=e,this.count=e.getElements().length},getIndices:function(){return this.indices},setFirst:function(e){this.offset=e},getFirst:function(){return this.offset},setCount:function(e){this.count=e},getCount:function(){return this.count}},osg.DrawElements.create=function(e,t){return osg.log("osg.DrawElements.create is deprecated, use new osg.DrawElements with same arguments"),new osg.DrawElements(e,t)},osg.Program=function(e,t){osg.StateAttribute.call(this),osg.Program.instanceID===undefined&&(osg.Program.instanceID=0),this.instanceID=osg.Program.instanceID,osg.Program.instanceID+=1,this.program=null,this.setVertexShader(e),this.setFragmentShader(t),this.dirty=!0},osg.Program.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"Program",cloneType:function(){var e=new osg.Program;return e.default_program=!0,e},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setVertexShader:function(e){this.vertex=e},setFragmentShader:function(e){this.fragment=e},getVertexShader:function(){return this.vertex},getFragmentShader:function(){return this.fragment},apply:function(e){if(!this.program||this.isDirty()){if(this.default_program===!0)return;this.vertex.shader||this.vertex.compile(),this.fragment.shader||this.fragment.compile(),this.program=gl.createProgram(),gl.attachShader(this.program,this.vertex.shader),gl.attachShader(this.program,this.fragment.shader),gl.linkProgram(this.program),gl.validateProgram(this.program);if(!gl.getProgramParameter(this.program,gl.LINK_STATUS)&&!gl.isContextLost())return osg.log("can't link program\nvertex shader:\n"+this.vertex.text+"\n fragment shader:\n"+this.fragment.text),osg.log(gl.getProgramInfoLog(this.program)),this.setDirty(!1),null;this.uniformsCache={},this.uniformsCache.uniformKeys=[],this.attributesCache={},this.attributesCache.attributeKeys=[],this.cacheUniformList(this.vertex.text),this.cacheUniformList(this.fragment.text),this.cacheAttributeList(this.vertex.text),this.setDirty(!1)}gl.useProgram(this.program)},cacheUniformList:function(e){var t=e.match(/uniform\s+\w+\s+\w+/g);if(t!==null)for(var n=0,r=t.length;n<r;n++){var i=t[n].match(/uniform\s+\w+\s+(\w+)/)[1],s=gl.getUniformLocation(this.program,i);s!==undefined&&s!==null&&this.uniformsCache[i]===undefined&&(this.uniformsCache[i]=s,this.uniformsCache.uniformKeys.push(i))}},cacheAttributeList:function(e){var t=e.match(/attribute\s+\w+\s+\w+/g);if(t!==null)for(var n=0,r=t.length;n<r;n++){var i=t[n].match(/attribute\s+\w+\s+(\w+)/)[1],s=gl.getAttribLocation(this.program,i);s!==-1&&s!==undefined&&this.attributesCache[i]===undefined&&(this.attributesCache[i]=s,this.attributesCache.attributeKeys.push(i))}}}),"osg","Program"),osg.Program.create=function(e,t){0;var n=new osg.Program(e,t);return n},osg.Projection=function(){osg.Node.call(this),this.projection=osg.Matrix.makeIdentity([])},osg.Projection.prototype=osg.objectInehrit(osg.Node.prototype,{getProjectionMatrix:function(){return this.projection},setProjectionMatrix:function(e){this.projection=e}}),osg.Projection.prototype.objectType=osg.objectType.generate("Projection"),osg.Quat={copy:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},makeIdentity:function(e){return osg.Quat.init(e)},zeroRotation:function(e){return osg.Quat.init(e)},init:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},sub:function(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n},add:function(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},length2:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]},neg:function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},makeRotate:function(e,t,n,r,i){var s=1e-7,o=Math.sqrt(t*t+n*n+r*r);if(o<s)return this.init();var u=1/o,a=Math.cos(.5*e),f=Math.sin(.5*e);return i===undefined&&(i=[]),i[0]=t*f*u,i[1]=n*f*u,i[2]=r*f*u,i[3]=a,i},lerp:function(e,t,n,r){return r[0]=t[0]+(n[0]-t[0])*e,r[1]=t[1]+(n[1]-t[1])*e,r[2]=t[2]+(n[2]-t[2])*e,r[3]=t[3]+(n[3]-t[3])*e,r},slerp:function(e,t,n,r){var i=1e-5,s=n,o=this.dot(t,s);o<0&&(o=-o,this.neg(n,s));var u,a,f,l;return 1-o>i?(u=Math.acos(o),a=Math.sin(u),f=Math.sin((1-e)*u)/a,l=Math.sin(e*u)/a):(f=1-e,l=e),r[0]=t[0]*f+s[0]*l,r[1]=t[1]*f+s[1]*l,r[2]=t[2]*f+s[2]*l,r[3]=t[3]*f+s[3]*l,r},normalize:function(e,t){var n=1/this.length2(e);return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},conj:function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},inverse:function(e,t){var n=1/this.length2(e);return this.conj(e,t),t[0]*=n,t[1]*=n,t[2]*=n,t[3]*=n,t},mult:function(e,t,n){return n[0]=e[0]*t[3]+e[1]*t[2]-e[2]*t[1]+e[3]*t[0],n[1]=-e[0]*t[2]+e[1]*t[3]+e[2]*t[0]+e[3]*t[1],n[2]=e[0]*t[1]-e[1]*t[0]+e[2]*t[3]+e[3]*t[2],n[3]=-e[0]*t[0]-e[1]*t[1]-e[2]*t[2]+e[3]*t[3],n},div:function(e,t,n){var r=1/t;return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n},exp:function(e,t){var n=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=Math.exp(e[3]),i=0;return n>1e-5&&(i=r*Math.sin(n)/n),t===undefined&&(t=[]),t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*Math.cos(n),t},ln:function(e,t){var n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=Math.sqrt(n),i=0;return r>1e-5&&(i=Math.atan2(r,e[3])/r),t===undefined&&(t=[]),n+=e[3]*e[3],t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=.5*Math.log(n),t},squad:function(e,t,n,r,i,s){var o=this.slerp(e,t,i),u=this.slerp(e,n,r);return this.slerp(2*e*(1-e),o,u,s)},computeTangent:function(e,t,n,r){var i=this.inv(t),s,o;return this.mult(n,i,s),this.ln(s,s),this.mult(e,i,o),this.ln(o,o),this.add(s,o,s),this.div(s,-4,s),this.exp(s,o),this.mult(o,q1,r)}},osg.RenderBin=function(){this._leafs=[],this.positionedAttribute=[],this._renderStage=undefined,this._bins={},this.stateGraphList=[],this._parent=undefined,this._binNum=0,this._sorted=!1,this._sortMode=osg.RenderBin.SORT_BY_STATE},osg.RenderBin.SORT_BY_STATE=0,osg.RenderBin.SORT_BACK_TO_FRONT=1,osg.RenderBin.BinPrototypes={RenderBin:function(){return new osg.RenderBin},DepthSortedBin:function(){var e=new osg.RenderBin;return e._sortMode=osg.RenderBin.SORT_BACK_TO_FRONT,e}},osg.RenderBin.prototype={_createRenderBin:function(e){return e===undefined||osg.RenderBin.BinPrototypes[e]===undefined?osg.RenderBin.BinPrototypes.RenderBin():osg.RenderBin.BinPrototypes[e]()},getStateGraphList:function(){return this.stateGraphList},copyLeavesFromStateGraphListToRenderLeafList:function(){this._leafs.splice(0,this._leafs.length);var e=!1;for(var t=0,n=this.stateGraphList.length;t<n;t++){var r=this.stateGraphList[t].leafs;for(var i=0,s=r.length;i<s;i++){var o=r[i];isNaN(o.depth)?e=!0:this._leafs.push(o)}}e&&osg.debug("warning: RenderBin::copyLeavesFromStateGraphListToRenderLeafList() detected NaN depth values, database may be corrupted."),this.stateGraphList.splice(0,this.stateGraphList.length)},sortBackToFront:function(){this.copyLeavesFromStateGraphListToRenderLeafList();var e=function(e,t){return t.depth-e.depth};this._leafs.sort(e)},sortImplementation:function(){var e=osg.RenderBin;switch(this._sortMode){case e.SORT_BACK_TO_FRONT:this.sortBackToFront();break;case e.SORT_BY_STATE:}},sort:function(){if(this._sorted)return;var e=this._bins,t=Object.keys(e);for(var n=0,r=t.length;n<r;n++)e[t[n]].sort();this.sortImplementation(),_sorted=!0},setParent:function(e){this._parent=e},getParent:function(){return this._parent},getBinNumber:function(){return this._binNum},findOrInsert:function(e,t){var n=this._bins[e];return n===undefined&&(n=this._createRenderBin(t),n._parent=this,n._binNum=e,n._renderStage=this._renderStage,this._bins[e]=n),n},getStage:function(){return this._renderStage},addStateGraph:function(e){this.stateGraphList.push(e)},reset:function(){this.stateGraphList.length=0,this._bins={},this.positionedAttribute.length=0,this._leafs.length=0,this._sorted=!1},applyPositionedAttribute:function(e,t){for(var n=0,r=t.length;n<r;n++){var i=t[n],s=i[1],o=i[0];e.setGlobalDefaultValue(s),s.apply(e),s.applyPositionedUniform(o,e),e.haveAppliedAttribute(s)}},drawImplementation:function(e,t){var n=t,r=Object.keys(this._bins),i=this._bins,s=[];for(var o=0,u=r.length;o<u;o++){var a=r[o];s.push(i[a])}var f=function(e,t){return e._binNum-t._binNum};s.sort(f);var l=0,c=s.length,h;for(;l<c;l++){h=s[l];if(h.getBinNumber()>0)break;n=h.drawImplementation(e,n)}n=this.drawLeafs(e,n);for(;l<c;l++)h=s[l],n=h.drawImplementation(e,n);return n},drawLeafs:function(e,t){var n=this.stateGraphList,r=this._leafs,i,s,o,u,a,f=t,l=[],c=[],h=osg.Matrix;f&&osg.StateGraph.prototype.moveToRootStateGraph(e,t.parent);var p,d,v,m,g;for(var y=0,b=r.length;y<b;y++)p=r[y],d=!1,f!==undefined?(v=f.parent,m=v.parent,g=p.parent,m!==g.parent?(g.moveStateGraph(e,m,g.parent),e.pushStateSet(g.stateset),d=!0):g!==v&&(e.pushStateSet(g.stateset),d=!0)):(p.parent.moveStateGraph(e,undefined,p.parent.parent),e.pushStateSet(p.parent.stateset),d=!0),d===!0&&(e.apply(),u=e.getLastProgramApplied(),s=u.uniformsCache[e.modelViewMatrix.name],o=u.uniformsCache[e.projectionMatrix.name],i=u.uniformsCache[e.normalMatrix.name]),s!==undefined&&(e.modelViewMatrix.set(p.modelview),e.modelViewMatrix.apply(s)),o!==undefined&&(e.projectionMatrix.set(p.projection),e.projectionMatrix.apply(o)),i!==undefined&&(h.copy(p.modelview,l),l[12]=0,l[13]=0,l[14]=0,h.inverse(l,l),h.transpose(l,l),e.normalMatrix.set(l),e.normalMatrix.apply(i)),p.geometry.drawImplementation(e),d===!0&&(e.popGeneratedProgram(),e.popStateSet()),f=p;for(var w=0,E=n.length;w<E;w++){var S=n[w];for(var x=0,T=S.leafs.length;x<T;x++)p=S.leafs[x],d=!1,f!==undefined?(v=f.parent,m=v.parent,g=p.parent,m!==g.parent?(g.moveStateGraph(e,m,g.parent),e.pushStateSet(g.stateset),d=!0):g!==v&&(e.pushStateSet(g.stateset),d=!0)):(p.parent.moveStateGraph(e,undefined,p.parent.parent),e.pushStateSet(p.parent.stateset),d=!0),d===!0&&(e.apply(),u=e.getLastProgramApplied(),s=u.uniformsCache[e.modelViewMatrix.name],o=u.uniformsCache[e.projectionMatrix.name],i=u.uniformsCache[e.normalMatrix.name]),s!==undefined&&(e.modelViewMatrix.set(p.modelview),e.modelViewMatrix.apply(s)),o!==undefined&&(e.projectionMatrix.set(p.projection),e.projectionMatrix.apply(o)),i!==undefined&&(h.copy(p.modelview,l),l[12]=0,l[13]=0,l[14]=0,h.inverse(l,l),h.transpose(l,l),e.normalMatrix.set(l),e.normalMatrix.apply(i)),p.geometry.drawImplementation(e),d===!0&&(e.popGeneratedProgram(),e.popStateSet()),f=p}return f}},osg.RenderStage=function(){osg.RenderBin.call(this),this.positionedAttribute=[],this.clearDepth=1,this.clearColor=[0,0,0,1],this.clearMask=osg.Camera.COLOR_BUFFER_BIT|osg.Camera.DEPTH_BUFFER_BIT,this.camera=undefined,this.viewport=undefined,this.preRenderList=[],this.postRenderList=[],this._renderStage=this},osg.RenderStage.prototype=osg.objectInehrit(osg.RenderBin.prototype,{reset:function(){osg.RenderBin.prototype.reset.call(this),this.preRenderList.length=0,this.postRenderList.length=0},setClearDepth:function(e){this.clearDepth=e},getClearDepth:function(){return this.clearDepth},setClearColor:function(e){this.clearColor=e},getClearColor:function(){return this.clearColor},setClearMask:function(e){this.clearMask=e},getClearMask:function(){return this.clearMask},setViewport:function(e){this.viewport=e},getViewport:function(){return this.viewport},setCamera:function(e){this.camera=e},addPreRenderStage:function(e,t){for(var n=0,r=this.preRenderList.length;n<r;n++){var i=this.preRenderList[n];if(t<i.order)break}n<this.preRenderList.length?this.preRenderList=this.preRenderList.splice(n,0,{order:t,renderStage:e}):this.preRenderList.push({order:t,renderStage:e})},addPostRenderStage:function(e,t){for(var n=0,r=this.postRenderList.length;n<r;n++){var i=this.postRenderList[n];if(t<i.order)break}n<this.postRenderList.length?this.postRenderList=this.postRenderList.splice(n,0,{order:t,renderStage:e}):this.postRenderList.push({order:t,renderStage:e})},drawPreRenderStages:function(e,t){var n=t;for(var r=0,i=this.preRenderList.length;r<i;++r){var s=this.preRenderList[r].renderStage;n=s.draw(e,n)}return n},draw:function(e,t){var n=this.drawPreRenderStages(e,t);return n=this.drawImplementation(e,n),n=this.drawPostRenderStages(e,n),n},sort:function(){for(var e=0,t=this.preRenderList.length;e<t;++e)this.preRenderList[e].renderStage.sort();osg.RenderBin.prototype.sort.call(this);for(var n=0,r=this.postRenderList.length;e<t;++e)this.postRenderList[e].renderStage.sort()},drawPostRenderStages:function(e,t){var n=t;for(var r=0,i=this.postRenderList.length;r<i;++r){var s=this.postRenderList[r].renderStage;n=s.draw(e,n)}return n},applyCamera:function(e){var t=e.getGraphicContext();if(this.camera===undefined){t.bindFramebuffer(t.FRAMEBUFFER,null);return}var n=this.camera.getViewport(),r=this.camera.frameBufferObject;r||(r=new osg.FrameBufferObject,this.camera.frameBufferObject=r);if(r.isDirty()&&this.camera.attachments!==undefined)for(var i in this.camera.attachments){var s=this.camera.attachments[i],o;s.texture===undefined?o={attachment:i,format:s.format,width:n.width(),height:n.height()}:s.texture!==undefined&&(o={attachment:i,texture:s.texture,level:s.level},s.format&&(o.format=s.format)),r.setAttachment(o)}r.apply(e)},drawImplementation:function(e,t){var n,r=e.getGraphicContext();this.applyCamera(e),this.viewport===undefined&&osg.log("RenderStage does not have a valid viewport"),e.applyAttribute(this.viewport),this.clearMask&r.COLOR_BUFFER_BIT&&r.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),this.clearMask&r.DEPTH_BUFFER_BIT&&(r.depthMask(!0),r.clearDepth(this.clearDepth)),r.clear(this.clearMask),this.positionedAttribute&&this.applyPositionedAttribute(e,this.positionedAttribute);var i=osg.RenderBin.prototype.drawImplementation.call(this,e,t);return i}}),osg.ShaderGenerator=function(){this.cache=[]},osg.ShaderGenerator.prototype={getActiveTypeMember:function(e){var t=[];for(var n=0,r=e.attributeMap.attributeKeys.length;n<r;n++){var i=e.attributeMap.attributeKeys[n],s=e.attributeMap[i];if(s.length===0&&s.globalDefault.applyPositionedUniform===undefined)continue;(s.globalDefault.getOrCreateUniforms!==undefined||s.globalDefault.writeToShader!==undefined)&&t.push(i)}for(var o=0,u=e.textureAttributeMapList.length;o<u;o++){var a=e.textureAttributeMapList[o];if(a===undefined)continue;for(var f=0,l=a.attributeKeys.length;f<l;f++){var c=a.attributeKeys[f],h=a[c];if(h.length===0)continue;(h.globalDefault.getOrCreateUniforms!==undefined||h.globalDefault.writeToShader!==undefined)&&t.push(c+o)}}return t},getActiveAttributeMapKeys:function(e){var t=[];for(var n=0,r=e.attributeMap.attributeKeys.length;n<r;n++){var i=e.attributeMap.attributeKeys[n],s=e.attributeMap[i];if(s.length===0&&s.globalDefault.applyPositionedUniform===undefined)continue;(s.globalDefault.getOrCreateUniforms!==undefined||s.globalDefault.writeToShader!==undefined)&&t.push(i)}return t},getActiveTextureAttributeMapKeys:function(e){var t=[];for(var n=0,r=e.textureAttributeMapList.length;n<r;n++){var i=e.textureAttributeMapList[n];if(i===undefined)continue;t[n]=[];for(var s=0,o=i.attributeKeys.length;s<o;s++){var u=i.attributeKeys[s],a=i[u];if(a.length===0)continue;(a.globalDefault.getOrCreateUniforms!==undefined||a.globalDefault.writeToShader!==undefined)&&t[n].push(u)}}return t},getActiveUniforms:function(e,t,n){var r={};for(var i=0,s=t.length;i<s;i++){var o=t[i];if(e.attributeMap[o].globalDefault.getOrCreateUniforms===undefined)continue;var u=e.attributeMap[o].globalDefault.getOrCreateUniforms();for(var a=0,f=u.uniformKeys.length;a<f;a++){var l=u.uniformKeys[a],c=u[l];r[c.name]=c}}for(var h=0,p=n.length;h<p;h++){var d=n[h];if(d===undefined)continue;for(var v=0,m=d.length;v<m;v++){var g=d[v],y=e.textureAttributeMapList[h][g].globalDefault;if(y.getOrCreateUniforms===undefined)continue;var b=y.getOrCreateUniforms(h);for(var w=0,E=b.uniformKeys.length;w<E;w++){var S=b.uniformKeys[w],x=b[S];r[x.name]=x}}}var T=[];for(var N in r)T.push(N);return r.uniformKeys=T,r},getOrCreateProgram:function(e){var t=this.getActiveTypeMember(e);for(var n=0,r=this.cache.length;n<r;++n)if(this.compareAttributeMap(t,this.cache[n].flattenKeys)===0)return this.cache[n];var i=this.getActiveAttributeMapKeys(e),s=this.getActiveTextureAttributeMapKeys(e),o=this.getOrCreateVertexShader(e,i,s),u=this.getOrCreateFragmentShader(e,i,s),a=new osg.Program(new osg.Shader(gl.VERTEX_SHADER,o),new osg.Shader(gl.FRAGMENT_SHADER,u));return a.flattenKeys=t,a.activeAttributeKeys=i,a.activeTextureAttributeKeys=s,a.activeUniforms=this.getActiveUniforms(e,i,s),a.generated=!0,osg.log(a.vertex.text),osg.log(a.fragment.text),this.cache.push(a),a},compareAttributeMap:function(e,t){var n;for(var r=0,i=e.length;r<i;r++){n=e[r];if(t.indexOf(n)===-1)return 1}return t.length!==e.length?-1:0},fillTextureShader:function(e,t,n){var r="",i={};for(var s=0,o=t.length;s<o;s++){var u=t[s];if(u===undefined)continue;var a=e[s];for(var f=0,l=u.length;f<l;f++){var c=u[f],h=a[c].globalDefault;h.generateShaderCommon!==undefined&&i[c]===undefined&&(r+=h.generateShaderCommon(s,n),i[c]=!0),h.generateShader&&(r+=h.generateShader(s,n))}}return r},fillShader:function(e,t,n){var r="",i={};for(var s=0,o=t.length;s<o;s++){var u=t[s],a=e[u].globalDefault,f=a.getType();a.generateShaderCommon!==undefined&&i[f]===undefined&&(r+=a.generateShaderCommon(n),i[f]=!0),a.generateShader&&(r+=a.generateShader(n))}return r},getOrCreateVertexShader:function(e,t,n){var r,i=osg.ShaderGeneratorType,s=["","#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec4 Color;","attribute vec3 Normal;","uniform int ArrayColorEnabled;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","uniform mat4 NormalMatrix;","varying vec4 VertexColor;",""].join("\n");s+=this._writeShaderFromMode(e,t,n,i.VertexInit);var o=["","vec4 ftransform() {","  return ProjectionMatrix * ModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n");s+=o,s+=this._writeShaderFromMode(e,t,n,i.VertexFunction);var u=["","void main(void) {","  gl_Position = ftransform();","  if (ArrayColorEnabled == 1)","    VertexColor = Color;","  else","    VertexColor = vec4(1.0,1.0,1.0,1.0);",""].join("\n");return s+=u,s+=this._writeShaderFromMode(e,t,n,i.VertexMain),s+=["}",""].join("\n"),s},_writeShaderFromMode:function(e,t,n,r){var i="";return i+=this.fillTextureShader(e.textureAttributeMapList,n,r),i+=this.fillShader(e.attributeMap,t,r),i},getOrCreateFragmentShader:function(e,t,n){var r,i=["","#ifdef GL_ES","precision highp float;","#endif","varying vec4 VertexColor;","uniform int ArrayColorEnabled;","vec4 fragColor;",""].join("\n"),s=osg.ShaderGeneratorType;return i+=this._writeShaderFromMode(e,t,n,s.FragmentInit),i+=this._writeShaderFromMode(e,t,n,s.FragmentFunction),i+=["void main(void) {","  fragColor = VertexColor;",""].join("\n"),i+=this._writeShaderFromMode(e,t,n,s.FragmentMain),i+=this._writeShaderFromMode(e,t,n,s.FragmentEnd),i+=["","  gl_FragColor = fragColor;","}"].join("\n"),i}},osg.createTexturedBoxGeometry=function(e,t,n,r,i,s){var o=new osg.Geometry,u,a,f;u=r/2,a=i/2,f=s/2;var l=[],c=[],h=[];l[0]=e-u,l[1]=t-a,l[2]=n+f,h[0]=0,h[1]=-1,h[2]=0,c[0]=0,c[1]=1,l[3]=e-u,l[4]=t-a,l[5]=n-f,h[3]=0,h[4]=-1,h[5]=0,c[2]=0,c[3]=0,l[6]=e+u,l[7]=t-a,l[8]=n-f,h[6]=0,h[7]=-1,h[8]=0,c[4]=1,c[5]=0,l[9]=e+u,l[10]=t-a,l[11]=n+f,h[9]=0,h[10]=-1,h[11]=0,c[6]=1,c[7]=1,l[12]=e+u,l[13]=t+a,l[14]=n+f,h[12]=0,h[13]=1,h[14]=0,c[8]=0,c[9]=1,l[15]=e+u,l[16]=t+a,l[17]=n-f,h[15]=0,h[16]=1,h[17]=0,c[10]=0,c[11]=0,l[18]=e-u,l[19]=t+a,l[20]=n-f,h[18]=0,h[19]=1,h[20]=0,c[12]=1,c[13]=0,l[21]=e-u,l[22]=t+a,l[23]=n+f,h[21]=0,h[22]=1,h[23]=0,c[14]=1,c[15]=1,l[24]=e+u,l[25]=t-a,l[26]=n+f,h[24]=1,h[25]=0,h[26]=0,c[16]=0,c[17]=1,l[27]=e+u,l[28]=t-a,l[29]=n-f,h[27]=1,h[28]=0,h[29]=0,c[18]=0,c[19]=0,l[30]=e+u,l[31]=t+a,l[32]=n-f,h[30]=1,h[31]=0,h[32]=0,c[20]=1,c[21]=0,l[33]=e+u,l[34]=t+a,l[35]=n+f,h[33]=1,h[34]=0,h[35]=0,c[22]=1,c[23]=1,l[36]=e-u,l[37]=t+a,l[38]=n+f,h[36]=-1,h[37]=0,h[38]=0,c[24]=0,c[25]=1,l[39]=e-u,l[40]=t+a,l[41]=n-f,h[39]=-1,h[40]=0,h[41]=0,c[26]=0,c[27]=0,l[42]=e-u,l[43]=t-a,l[44]=n-f,h[42]=-1,h[43]=0,h[44]=0,c[28]=1,c[29]=0,l[45]=e-u,l[46]=t-a,l[47]=n+f,h[45]=-1,h[46]=0,h[47]=0,c[30]=1,c[31]=1,l[48]=e-u,l[49]=t+a,l[50]=n+f,h[48]=0,h[49]=0,h[50]=1,c[32]=0,c[33]=1,l[51]=e-u,l[52]=t-a,l[53]=n+f,h[51]=0,h[52]=0,h[53]=1,c[34]=0,c[35]=0,l[54]=e+u,l[55]=t-a,l[56]=n+f,h[54]=0,h[55]=0,h[56]=1,c[36]=1,c[37]=0,l[57]=e+u,l[58]=t+a,l[59]=n+f,h[57]=0,h[58]=0,h[59]=1,c[38]=1,c[39]=1,l[60]=e+u,l[61]=t+a,l[62]=n-f,h[60]=0,h[61]=0,h[62]=-1,c[40]=0,c[41]=1,l[63]=e+u,l[64]=t-a,l[65]=n-f,h[63]=0,h[64]=0,h[65]=-1,c[42]=0,c[43]=0,l[66]=e-u,l[67]=t-a,l[68]=n-f,h[66]=0,h[67]=0,h[68]=-1,c[44]=1,c[45]=0,l[69]=e-u,l[70]=t+a,l[71]=n-f,h[69]=0,h[70]=0,h[71]=-1,c[46]=1,c[47]=1;var p=[];p[0]=0,p[1]=1,p[2]=2,p[3]=0,p[4]=2,p[5]=3,p[6]=4,p[7]=5,p[8]=6,p[9]=4,p[10]=6,p[11]=7,p[12]=8,p[13]=9,p[14]=10,p[15]=8,p[16]=10,p[17]=11,p[18]=12,p[19]=13,p[20]=14,p[21]=12,p[22]=14,p[23]=15,p[24]=16,p[25]=17,p[26]=18,p[27]=16,p[28]=18,p[29]=19,p[30]=20,p[31]=21,p[32]=22,p[33]=20,p[34]=22,p[35]=23,o.getAttributes().Vertex=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,l,3),o.getAttributes().Normal=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,h,3),o.getAttributes().TexCoord0=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,c,2);var d=new osg.DrawElements(osg.PrimitiveSet.TRIANGLES,new osg.BufferArray(osg.BufferArray.ELEMENT_ARRAY_BUFFER,p,1));return o.getPrimitives().push(d),o},osg.createTexturedQuadGeometry=function(e,t,n,r,i,s,o,u,a,f,l,c,h){c===undefined&&h===undefined&&(c=f,h=l,f=0,l=0);var p=new osg.Geometry,d=[];d[0]=e+o,d[1]=t+u,d[2]=n+a,d[3]=e,d[4]=t,d[5]=n,d[6]=e+r,d[7]=t+i,d[8]=n+s,d[9]=e+r+o,d[10]=t+i+u,d[11]=n+s+a,c===undefined&&(c=1),h===undefined&&(h=1);var v=[];v[0]=f,v[1]=h,v[2]=f,v[3]=l,v[4]=c,v[5]=l,v[6]=c,v[7]=h;var m=osg.Vec3.cross([r,i,s],[o,u,a],[]),g=[];g[0]=m[0],g[1]=m[1],g[2]=m[2],g[3]=m[0],g[4]=m[1],g[5]=m[2],g[6]=m[0],g[7]=m[1],g[8]=m[2],g[9]=m[0],g[10]=m[1],g[11]=m[2];var y=[];y[0]=0,y[1]=1,y[2]=2,y[3]=0,y[4]=2,y[5]=3,p.getAttributes().Vertex=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,d,3),p.getAttributes().Normal=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,g,3),p.getAttributes().TexCoord0=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,v,2);var b=new osg.DrawElements(osg.PrimitiveSet.TRIANGLES,new osg.BufferArray(osg.BufferArray.ELEMENT_ARRAY_BUFFER,y,1));return p.getPrimitives().push(b),p},osg.createTexturedBox=function(e,t,n,r,i,s){return osg.log("osg.createTexturedBox is deprecated use instead osg.createTexturedBoxGeometry"),osg.createTexturedBoxGeometry(e,t,n,r,i,s)},osg.createTexturedQuad=function(e,t,n,r,i,s,o,u,a,f,l,c,h){return osg.log("osg.createTexturedQuad is deprecated use instead osg.createTexturedQuadGeometry"),osg.createTexturedQuadGeometry(e,t,n,r,i,s,o,u,a,f,l,c,h)},osg.createAxisGeometry=function(e){e===undefined&&(e=5),osg.createAxisGeometry.getShader===undefined&&(osg.createAxisGeometry.getShader=function(){if(osg.createAxisGeometry.getShader.program===undefined){var e=["#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec4 Color;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","","varying vec4 FragColor;","","vec4 ftransform() {","return ProjectionMatrix * ModelViewMatrix * vec4(Vertex, 1.0);","}","","void main(void) {","gl_Position = ftransform();","FragColor = Color;","}"].join("\n"),t=["#ifdef GL_ES","precision highp float;","#endif","varying vec4 FragColor;","void main(void) {","gl_FragColor = FragColor;","}"].join("\n"),n=new osg.Program(new osg.Shader(gl.VERTEX_SHADER,e),new osg.Shader(gl.FRAGMENT_SHADER,t));osg.createAxisGeometry.getShader.program=n}return osg.createAxisGeometry.getShader.program});var t=new osg.Geometry,n=[];n.push(0,0,0),n.push(e,0,0),n.push(0,0,0),n.push(0,e,0),n.push(0,0,0),n.push(0,0,e);var r=[];r.push(1,0,0,1),r.push(1,0,0,1),r.push(0,1,0,1),r.push(0,1,0,1),r.push(0,0,1,1),r.push(0,0,1,1),t.getAttributes().Vertex=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,n,3),t.getAttributes().Color=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,r,4);var i=new osg.DrawArrays(osg.PrimitiveSet.LINES,0,6);return t.getPrimitives().push(i),t.getOrCreateStateSet().setAttributeAndMode(osg.createAxisGeometry.getShader()),t},osg.Stack=function(){},osg.Stack.create=function(){var e=[];return e.globalDefault=undefined,e.lastApplied=undefined,e.back=function(){return this[this.length-1]},e},osg.StateGraph=function(){this.depth=0,this.children={},this.children.keys=[],this.leafs=[],this.stateset=undefined,this.parent=undefined},osg.StateGraph.prototype={clean:function(){this.leafs.splice(0,this.leafs.length),this.stateset=undefined,this.parent=undefined,this.depth=0;var e,t=this.children.keys;for(var n=0,r=t.length;n<r;n++)e=t[n],this.children[e].clean(),osg.memoryPools.stateGraph.put(this.children[e]);this.children={},t.splice(0,t.length),this.children.keys=t},getStateSet:function(){return this.stateset},findOrInsert:function(e){var t;return this.children[e.id]?t=this.children[e.id]:(t=osg.memoryPools.stateGraph.get(),t.parent=this,t.depth=this.depth+1,t.stateset=e,this.children[e.id]=t,this.children.keys.push(e.id)),t},moveToRootStateGraph:function(e,t){while(t)t.stateSet&&e.popStateSet(),t=t._parent},moveStateGraph:function(e,t,n){var r,i;if(n===t||n===undefined)return;if(t===undefined){r=[];do n.stateset!==undefined&&r.push(n.stateset),n=n.parent;while(n);r.reverse();for(i=0,l=r.length;i<l;++i)e.pushStateSet(r[i]);return}if(t.parent===n.parent){t.stateset!==undefined&&e.popStateSet(),n.stateset!==undefined&&e.pushStateSet(n.stateset);return}while(t.depth>n.depth)t.stateset!==undefined&&e.popStateSet(),t=t.parent;r=[];while(n.depth>t.depth)n.stateset!==undefined&&r.push(n.stateset),n=n.parent;while(t!==n)t.stateset!==undefined&&e.popStateSet(),t=t.parent,n.stateset!==undefined&&r.push(n.stateset),n=n.parent;r.reverse(),stackLength=r.length;for(i=0;i<stackLength;++i)e.pushStateSet(r[i])}},osg.State=function(){this._graphicContext=undefined,this.currentVBO=null,this.currentVAO=null,this.vertexAttribList=[],this.programs=osg.Stack.create(),this.stateSets=osg.Stack.create(),this.uniforms={},this.uniforms.uniformKeys=[],this.textureAttributeMapList=[],this.attributeMap={},this.attributeMap.attributeKeys=[],this.modeMap={},this.shaderGenerator=new osg.ShaderGenerator,this.modelViewMatrix=osg.Uniform.createMatrix4(osg.Matrix.makeIdentity([]),"ModelViewMatrix"),this.projectionMatrix=osg.Uniform.createMatrix4(osg.Matrix.makeIdentity([]),"ProjectionMatrix"),this.normalMatrix=osg.Uniform.createMatrix4(osg.Matrix.makeIdentity([]),"NormalMatrix"),this.uniformArrayState={},this.uniformArrayState.uniformKeys=[],this.uniformArrayState.Color=osg.Uniform.createInt1(0,"ArrayColorEnabled"),this.uniformArrayState.uniformKeys.push("Color"),this.vertexAttribMap={},this.vertexAttribMap._disable=[],this.vertexAttribMap._keys=[]},osg.State.prototype={setGraphicContext:function(e){this._graphicContext=e},getGraphicContext:function(){return this._graphicContext},pushStateSet:function(e){this.stateSets.push(e),e.attributeMap&&this.pushAttributeMap(this.attributeMap,e.attributeMap);if(e.textureAttributeMapList){var t=e.textureAttributeMapList;for(var n=0,r=t.length;n<r;n++){if(t[n]===undefined)continue;this.textureAttributeMapList[n]||(this.textureAttributeMapList[n]={},this.textureAttributeMapList[n].attributeKeys=[]),this.pushAttributeMap(this.textureAttributeMapList[n],t[n])}}e.uniforms&&this.pushUniformsList(this.uniforms,e.uniforms)},applyStateSet:function(e){this.pushStateSet(e),this.apply(),this.popStateSet()},popAllStateSets:function(){while(this.stateSets.length)this.popStateSet()},popStateSet:function(){var e=this.stateSets.pop();e.program&&this.programs.pop(),e.attributeMap&&this.popAttributeMap(this.attributeMap,e.attributeMap);if(e.textureAttributeMapList){var t=e.textureAttributeMapList;for(var n=0,r=t.length;n<r;n++){if(t[n]===undefined)continue;this.popAttributeMap(this.textureAttributeMapList[n],t[n])}}e.uniforms&&this.popUniformsList(this.uniforms,e.uniforms)},haveAppliedAttribute:function(e){var t=e.getTypeMember(),n=this.attributeMap[t];n.lastApplied=e,n.asChanged=!0},applyAttribute:function(e){var t=e.getTypeMember(),n=this.attributeMap[t];n===undefined&&(n=osg.Stack.create(),this.attributeMap[t]=n,this.attributeMap[t].globalDefault=e.cloneType(),this.attributeMap.attributeKeys.push(t)),n.lastApplied!==e&&(e.apply&&e.apply(this),n.lastApplied=e,n.asChanged=!0)},applyTextureAttribute:function(e,t){var n=this.getGraphicContext();n.activeTexture(n.TEXTURE0+e);var r=t.getTypeMember();this.textureAttributeMapList[e]||(this.textureAttributeMapList[e]={},this.textureAttributeMapList[e].attributeKeys=[]);var i=this.textureAttributeMapList[e][r];i===undefined&&(i=osg.Stack.create(),this.textureAttributeMapList[e][r]=i,i.globalDefault=t.cloneType(),this.textureAttributeMapList[e].attributeKeys.push(r)),i.lastApplied!==t&&(t.apply&&t.apply(this),i.lastApplied=t,i.asChanged=!0)},getLastProgramApplied:function(){return this.programs.lastApplied},pushGeneratedProgram:function(){var e;if(this.attributeMap.Program!==undefined&&this.attributeMap.Program.length!==0){e=this.attributeMap.Program.back().object,value=this.attributeMap.Program.back().value;if(e!==undefined&&value!==osg.StateAttribute.OFF)return this.programs.push(this.getObjectPair(e,value)),e}var t={textureAttributeMapList:this.textureAttributeMapList,attributeMap:this.attributeMap},n=this.stateSets.back().getShaderGenerator();return n===undefined&&(n=this.shaderGenerator),e=n.getOrCreateProgram(t),this.programs.push(this.getObjectPair(e,osg.StateAttribute.ON)),e},popGeneratedProgram:function(){this.programs.pop()},applyWithoutProgram:function(){this.applyAttributeMap(this.attributeMap),this.applyTextureAttributeMapList(this.textureAttributeMapList)},apply:function(){var e=this._graphicContext;this.applyAttributeMap(this.attributeMap),this.applyTextureAttributeMapList(this.textureAttributeMapList),this.pushGeneratedProgram();var t=this.programs.back().object;this.programs.lastApplied!==t&&(t.apply(this),this.programs.lastApplied=t);var n,r,i,s,o=this,u;if(t.generated===!0)n=t.uniformsCache,r=t.activeUniforms,u=this.uniforms,function(){var e=t.uniformsCache,n=t.activeUniforms,r=t.foreignUniforms;r||(function(){r=[];for(var i=0,s=e.uniformKeys.length;i<s;i++){var u=e.uniformKeys[i],a=e[u];a!==undefined&&n[u]===undefined&&u!==o.modelViewMatrix.name&&u!==o.projectionMatrix.name&&u!==o.normalMatrix.name&&r.push(u)}t.foreignUniforms=r}(),function(){var t=!1;for(var r=0,i=n.uniformKeys.length;r<i;r++){var s=n.uniformKeys[r],o=e[s];(o===undefined||o===null)&&delete n[s]}var u=Object.keys(n);for(var a=0,f=u.length;a<f;a++)if(u[a]==="uniformKeys"){u.splice(a,1);break}n.uniformKeys=u}()),function(){for(var t=0,r=n.uniformKeys.length;t<r;t++){var i=n.uniformKeys[t],s=e[i];n[i].apply(s)}}(),function(){for(var t=0,n=r.length;t<n;t++){var i=r[t],s=u[i],o=e[i],a;s!==undefined&&(s.length===0?a=s.globalDefault:a=s.back().object,a.apply(o))}}()}();else{var p=t.program,d,v,m;n=t.uniformsCache,u=this.uniforms,r=[];var g=t.trackAttributes,y=t.trackUniforms,w,E,S;if(g!==undefined&&y===undefined){var x=t.trackAttributes.attributeKeys;if(x!==undefined)for(i=0,l=x.length;i<l;i++){s=x[i],attributeStack=this.attributeMap[s];if(attributeStack===undefined)continue;w=attributeStack.globalDefault;if(w.getOrCreateUniforms===undefined)continue;E=w.getOrCreateUniforms();for(S=0,b=E.uniformKeys.length;S<b;S++)r.push(E[E.uniformKeys[S]])}var T=t.trackAttributes.textureAttributeKeys;if(T!==undefined)for(i=0,l=T.length;i<l;i++){var N=T[i];if(N===undefined)continue;for(var C=0,k=N.length;C<k;C++){s=N[C];var L=this.textureAttributeMapList[i];if(L===undefined)continue;attributeStack=L[s];if(attributeStack===undefined)continue;w=attributeStack.globalDefault;if(w.getOrCreateUniforms===undefined)continue;E=w.getOrCreateUniforms(i);for(S=0,b=E.uniformKeys.length;S<b;S++)r.push(E[E.uniformKeys[S]])}}var A={};for(i=0,l=r.length;i<l;i++){var O=r[i],M=e.getUniformLocation(p,O.name);M!==undefined&&M!==null&&(A[O.name]=r[i])}t.trackUniforms=A}for(i=0,l=n.uniformKeys.length;i<l;i++){var _=n.uniformKeys[i];d=n[_],v=u[_],v===undefined?t.trackUniforms!==undefined&&(m=t.trackUniforms[_],m!==undefined&&m.apply(d)):(v.length===0?m=v.globalDefault:m=v.back().object,m.apply(d))}}},applyUniformList:function(e,t){var n=this.getLastProgramApplied(),r=n.program,i,s,o,u={},a,f=n.uniformsCache;for(var l=0,c=f.uniformKeys.length;l<c;l++){var h=f.uniformKeys[l];i=f[h],o=t[h];if(o===undefined){s=e[h];if(s===undefined)continue;s.length===0?o=s.globalDefault:o=s.back().object}o.apply(i)}},applyAttributeMap:function(e){var t;for(var n=0,r=e.attributeKeys.length;n<r;n++){var i=e.attributeKeys[n];t=e[i];if(t===undefined)continue;var s;t.length===0?s=t.globalDefault:s=t.back().object,t.asChanged&&(t.lastApplied!==s&&(s.apply&&s.apply(this),t.lastApplied=s),t.asChanged=!1)}},getObjectPair:function(e,t){return{object:e,value:t}},pushUniformsList:function(e,t){var n,r;for(var i=0,s=t.uniformKeys.length;i<s;i++){var o=t.uniformKeys[i];uniformPair=t[o],r=uniformPair.getUniform(),n=r.name,e[n]===undefined&&(e[n]=osg.Stack.create(),e[n].globalDefault=r,e.uniformKeys.push(n));var u=uniformPair.getValue(),a=e[n];a.length===0?a.push(this.getObjectPair(r,u)):a[a.length-1].value&osg.StateAttribute.OVERRIDE&&!(u&osg.StateAttribute.PROTECTED)?a.push(a[a.length-1]):a.push(this.getObjectPair(r,u))}},popUniformsList:function(e,t){var n;for(var r=0,i=t.uniformKeys.length;r<i;r++){var s=t.uniformKeys[r];e[s].pop()}},applyTextureAttributeMapList:function(e){var t=this._graphicContext,n;for(var r=0,i=e.length;r<i;r++){n=e[r];if(n===undefined)continue;for(var s=0,o=n.attributeKeys.length;s<o;s++){var u=n.attributeKeys[s],a=n[u];if(a===undefined)continue;var f;a.length===0?f=a.globalDefault:f=a.back().object,a.asChanged&&(t.activeTexture(t.TEXTURE0+r),f.apply(this,r),a.lastApplied=f,a.asChanged=!1)}}},setGlobalDefaultValue:function(e){var t=e.getTypeMember();this.attributeMap[t]?this.attributeMap[t].globalDefault=e:(this.attributeMap[t]=osg.Stack.create(),this.attributeMap[t].globalDefault=e,this.attributeMap.attributeKeys.push(t))},pushAttributeMap:function(e,t){var n;for(var r=0,i=t.attributeKeys.length;r<i;r++){var s=t.attributeKeys[r],o=t[s],u=o.getAttribute();e[s]===undefined&&(e[s]=osg.Stack.create(),e[s].globalDefault=u.cloneType(),e.attributeKeys.push(s));var a=o.getValue();n=e[s],n.length===0?n.push(this.getObjectPair(u,a)):n[n.length-1].value&osg.StateAttribute.OVERRIDE&&!(a&osg.StateAttribute.PROTECTED)?n.push(n[n.length-1]):n.push(this.getObjectPair(u,a)),n.asChanged=!0}},popAttributeMap:function(e,t){var n;for(var r=0,i=t.attributeKeys.length;r<i;r++)type=t.attributeKeys[r],n=e[type],n.pop(),n.asChanged=!0},setIndexArray:function(e){var t=this._graphicContext;this.currentIndexVBO!==e&&(e.bind(t),this.currentIndexVBO=e),e.isDirty()&&e.compile(t)},lazyDisablingOfVertexAttributes:function(){var e=this.vertexAttribMap._keys;for(var t=0,n=e.length;t<n;t++){var r=e[t];this.vertexAttribMap[r]&&(this.vertexAttribMap._disable[r]=!0)}},applyDisablingOfVertexAttributes:function(){var e=this.vertexAttribMap._keys;for(var t=0,n=e.length;t<n;t++)if(this.vertexAttribMap._disable[e[t]]===!0){var r=e[t];this._graphicContext.disableVertexAttribArray(r),this.vertexAttribMap._disable[r]=!1,this.vertexAttribMap[r]=!1}var i,s=this.programs.lastApplied;if(s!==undefined&&s.generated===!0){var o=!1;this.previousAppliedProgram!==this.programs.lastApplied?(o=!0,this.previousAppliedProgram=this.programs.lastApplied):(i=s.attributesCache.Color,this.vertexAttribMap[i]!==this.previousColorAttrib&&(o=!0)),o&&(i=s.attributesCache.Color,i!==undefined&&(this.vertexAttribMap[i]?this.uniformArrayState.Color.set([1]):this.uniformArrayState.Color.set([0]),this.previousColorAttrib=this.vertexAttribMap[i],this.uniformArrayState.Color.apply(s.uniformsCache.ArrayColorEnabled)))}},setVertexAttribArray:function(e,t,n){var r=this.vertexAttribMap;r._disable[e]=!1;var i=this._graphicContext,s=!1;t.isDirty()&&(t.bind(i),t.compile(i),s=!0),r[e]!==t&&(s||t.bind(i),r[e]||(i.enableVertexAttribArray(e),r[e]===undefined&&r._keys.push(e)),r[e]=t,i.vertexAttribPointer(e,t._itemSize,i.FLOAT,n,0,0))}},osg.StateSet=function(){osg.Object.call(this),this.id=osg.StateSet.instance++,this.attributeMap={},this.attributeMap.attributeKeys=[],this.textureAttributeMapList=[],this._binName=undefined,this._binNumber=0,this._shaderGenerator=undefined},osg.StateSet.instance=0,osg.StateSet.AttributePair=function(e,t){this._object=e,this._value=t},osg.StateSet.AttributePair.prototype={getAttribute:function(){return this._object},getUniform:function(){return this._object},getValue:function(){return this._value}},osg.StateSet.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.Object.prototype,{getAttributePair:function(e,t){return new osg.StateSet.AttributePair(e,t)},addUniform:function(e,t){t===undefined&&(t=osg.StateAttribute.ON),this.uniforms||(this.uniforms={},this.uniforms.uniformKeys=[]);var n=e.name;this.uniforms[n]=this.getAttributePair(e,t),this.uniforms.uniformKeys.indexOf(n)===-1&&this.uniforms.uniformKeys.push(n)},getUniform:function(e){return this.uniforms&&this.uniforms[e]?this.uniforms[e].getAttribute():undefined},getUniformList:function(){return this.uniforms},setTextureAttributeAndMode:function(e,t,n){n===undefined&&(n=osg.StateAttribute.ON),this._setTextureAttribute(e,this.getAttributePair(t,n))},getNumTextureAttributeLists:function(){return this.textureAttributeMapList.length},getTextureAttribute:function(e,t){return this.textureAttributeMapList[e]===undefined||this.textureAttributeMapList[e][t]===undefined?undefined:this.textureAttributeMapList[e][t].getAttribute()},removeTextureAttribute:function(e,t){if(this.textureAttributeMapList[e]===undefined||this.textureAttributeMapList[e][t]===undefined)return;delete this.textureAttributeMapList[e][t];var n=this.textureAttributeMapList[e].attributeKeys.indexOf(t);this.textureAttributeMapList[e].attributeKeys.splice(n,1)},getAttribute:function(e){return this.attributeMap[e]===undefined?undefined:this.attributeMap[e].getAttribute()},setAttributeAndMode:function(e,t){t===undefined&&(t=osg.StateAttribute.ON),this._setAttribute(this.getAttributePair(e,t))},setAttribute:function(e,t){t===undefined&&(t=osg.StateAttribute.ON),this._setAttribute(this.getAttributePair(e,t))},removeAttribute:function(e){if(this.attributeMap[e]!==undefined){delete this.attributeMap[e];var t=this.attributeMap.attributeKeys.indexOf(e);this.attributeMap.attributeKeys.splice(t,1)}},setRenderingHint:function(e){e==="OPAQUE_BIN"?this.setRenderBinDetails(0,"RenderBin"):e==="TRANSPARENT_BIN"?this.setRenderBinDetails(10,"DepthSortedBin"):this.setRenderBinDetails(0,"")},setRenderBinDetails:function(e,t){this._binNumber=e,this._binName=t},getAttributeMap:function(){return this.attributeMap},getBinNumber:function(){return this._binNumber},getBinName:function(){return this._binName},setBinNumber:function(e){this._binNumber=e},setBinName:function(e){this._binName=e},getAttributeList:function(){var e=this.attributeMap,t=e.attributeKeys,n=t.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=e[t[i]];return r},setShaderGenerator:function(e){this._shaderGenerator=e},getShaderGenerator:function(){return this._shaderGenerator},_getUniformMap:function(){return this.uniforms},_setTextureAttribute:function(e,t){this.textureAttributeMapList[e]===undefined&&(this.textureAttributeMapList[e]={},this.textureAttributeMapList[e].attributeKeys=[]);var n=t.getAttribute().getTypeMember();this.textureAttributeMapList[e][n]=t,this.textureAttributeMapList[e].attributeKeys.indexOf(n)===-1&&this.textureAttributeMapList[e].attributeKeys.push(n)},_setAttribute:function(e){var t=e.getAttribute().getTypeMember();this.attributeMap[t]=e,this.attributeMap.attributeKeys.indexOf(t)===-1&&this.attributeMap.attributeKeys.push(t)}}),"osg","StateSet"),osg.StateSet.prototype.setTextureAttributeAndModes=osg.StateSet.prototype.setTextureAttributeAndMode,osg.StateSet.prototype.setAttributeAndModes=osg.StateSet.prototype.setAttributeAndMode,osg.Texture=function(){osg.StateAttribute.call(this),this.setDefaultParameters()},osg.Texture.DEPTH_COMPONENT=6402,osg.Texture.ALPHA=6406,osg.Texture.RGB=6407,osg.Texture.RGBA=6408,osg.Texture.LUMINANCE=6409,osg.Texture.LUMINANCE_ALPHA=6410,osg.Texture.LINEAR=9729,osg.Texture.NEAREST=9728,osg.Texture.NEAREST_MIPMAP_NEAREST=9984,osg.Texture.LINEAR_MIPMAP_NEAREST=9985,osg.Texture.NEAREST_MIPMAP_LINEAR=9986,osg.Texture.LINEAR_MIPMAP_LINEAR=9987,osg.Texture.CLAMP_TO_EDGE=33071,osg.Texture.REPEAT=10497,osg.Texture.MIRRORED_REPEAT=33648,osg.Texture.TEXTURE_2D=3553,osg.Texture.TEXTURE_CUBE_MAP=34067,osg.Texture.TEXTURE_BINDING_CUBE_MAP=34068,osg.Texture.TEXTURE_CUBE_MAP_POSITIVE_X=34069,osg.Texture.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,osg.Texture.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,osg.Texture.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,osg.Texture.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,osg.Texture.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,osg.Texture.MAX_CUBE_MAP_TEXTURE_SIZE=34076,osg.Texture.UNSIGNED_BYTE=5121,osg.Texture.FLOAT=5126,osg.Texture.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"Texture",cloneType:function(){var e=new osg.Texture;return e.default_type=!0,e},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},getOrCreateUniforms:function(e){osg.Texture.uniforms===undefined&&(osg.Texture.uniforms=[]);if(osg.Texture.uniforms[e]===undefined){var t=this.getType()+e,n={};n.texture=osg.Uniform.createInt1(e,t),n.uniformKeys=Object.keys(n),osg.Texture.uniforms[e]=n}return osg.Texture.uniforms[e]},setDefaultParameters:function(){this._magFilter=osg.Texture.LINEAR,this._minFilter=osg.Texture.LINEAR,this._wrapS=osg.Texture.CLAMP_TO_EDGE,this._wrapT=osg.Texture.CLAMP_TO_EDGE,this._textureWidth=0,this._textureHeight=0,this._unrefImageDataAfterApply=!1,this.setInternalFormat(osg.Texture.RGBA),this._textureTarget=osg.Texture.TEXTURE_2D,this._type=osg.Texture.UNSIGNED_BYTE},getTextureTarget:function(){return this._textureTarget},getTextureObject:function(){return this._textureObject},setTextureSize:function(e,t){this._textureWidth=e,this._textureHeight=t},init:function(e){this._textureObject||(this._textureObject=e.createTexture(),this.dirty())},getWidth:function(){return this._textureWidth},getHeight:function(){return this._textureHeight},releaseGLObjects:function(e){this._textureObject!==undefined&&this._textureObject!==null&&(e.deleteTexture(this._textureObject),this._textureObject=null,this._image=undefined)},setWrapS:function(e){typeof e=="string"?this._wrapS=osg.Texture[e]:this._wrapS=e},setWrapT:function(e){typeof e=="string"?this._wrapT=osg.Texture[e]:this._wrapT=e},getWrapT:function(){return this._wrapT},getWrapS:function(){return this._wrapS},getMinFilter:function(e){return this._minFilter},getMagFilter:function(e){return this._magFilter},setMinFilter:function(e){typeof e=="string"?this._minFilter=osg.Texture[e]:this._minFilter=e},setMagFilter:function(e){typeof e=="string"?this._magFilter=osg.Texture[e]:this._magFilter=e},setImage:function(e,t){this._image=e,this.setImageFormat(t),this.dirty()},getImage:function(){return this._image},setImageFormat:function(e){e?(typeof e=="string"&&(e=osg.Texture[e]),this._imageFormat=e):this._imageFormat=osg.Texture.RGBA,this.setInternalFormat(this._imageFormat)},setType:function(e){typeof e=="string"?this._type=osg.Texture[e]:this._type=e},setUnrefImageDataAfterApply:function(e){this._unrefImageDataAfterApply=e},setInternalFormat:function(e){this._internalFormat=e},getInternalFormat:function(){return this._internalFormat},setFromCanvas:function(e,t){this.setImage(e,t)},setFromTypedArray:function(e,t){this.setImage(e,t)},isImageReady:function(e){if(e)if(e instanceof Image){if(e.complete)return e.naturalWidth!==undefined&&e.naturalWidth===0?!1:!0}else{if(e instanceof HTMLCanvasElement)return!0;if(e instanceof Uint8Array)return!0}return!1},applyFilterParameter:function(e,t){e.texParameteri(t,e.TEXTURE_MAG_FILTER,this._magFilter),e.texParameteri(t,e.TEXTURE_MIN_FILTER,this._minFilter),e.texParameteri(t,e.TEXTURE_WRAP_S,this._wrapS),e.texParameteri(t,e.TEXTURE_WRAP_T,this._wrapT)},generateMipmap:function(e,t){(this._minFilter===e.NEAREST_MIPMAP_NEAREST||this._minFilter===e.LINEAR_MIPMAP_NEAREST||this._minFilter===e.NEAREST_MIPMAP_LINEAR||this._minFilter===e.LINEAR_MIPMAP_LINEAR)&&e.generateMipmap(t)},apply:function(e){var t=e.getGraphicContext();if(this._textureObject!==undefined&&!this.isDirty())t.bindTexture(this._textureTarget,this._textureObject);else if(this.default_type)t.bindTexture(this._textureTarget,null);else{var n=this._image;n!==undefined?this.isImageReady(n)?(this._textureObject||this.init(t),this.setDirty(!1),t.bindTexture(this._textureTarget,this._textureObject),n instanceof Image?(this.setTextureSize(n.naturalWidth,n.naturalHeight),t.texImage2D(this._textureTarget,0,this._internalFormat,this._imageFormat,this._type,this._image)):n instanceof HTMLCanvasElement?(this.setTextureSize(n.width,n.height),t.texImage2D(this._textureTarget,0,this._internalFormat,this._imageFormat,this._type,this._image)):n instanceof Uint8Array&&t.texImage2D(this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,this._image),this.applyFilterParameter(t,this._textureTarget),this.generateMipmap(t,this._textureTarget),this._unrefImageDataAfterApply&&(this._image=undefined)):t.bindTexture(this._textureTarget,null):this._textureHeight!==0&&this._textureWidth!==0&&(this._textureObject||this.init(t),t.bindTexture(this._textureTarget,this._textureObject),t.texImage2D(this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,null),this.applyFilterParameter(t,this._textureTarget),this.generateMipmap(t,this._textureTarget),this.setDirty(!1))}},setShaderGeneratorFunction:function(e,t){this[t]=e},generateShader:function(e,t){return this[t]?this[t].call(this,e):""}}),"osg","Texture"),osg.Texture.prototype[osg.ShaderGeneratorType.VertexInit]=function(e){var t="attribute vec2 TexCoord"+e+";\n";return t+="varying vec2 FragTexCoord"+e+";\n",t},osg.Texture.prototype[osg.ShaderGeneratorType.VertexMain]=function(e){return"FragTexCoord"+e+" = TexCoord"+e+";\n"},osg.Texture.prototype[osg.ShaderGeneratorType.FragmentInit]=function(e){var t="varying vec2 FragTexCoord"+e+";\n";return t+="uniform sampler2D Texture"+e+";\n",t+="vec4 texColor"+e+";\n",t},osg.Texture.prototype[osg.ShaderGeneratorType.FragmentMain]=function(e){var t="texColor"+e+" = texture2D( Texture"+e+", FragTexCoord"+e+".xy );\n";return t+="fragColor = fragColor * texColor"+e+";\n",t},osg.Texture.createFromURL=function(e,t){var n=new osg.Texture;return osgDB.Promise.when(osgDB.readImage(e)).then(function(e){n.setImage(e,t)}),n},osg.Texture.createFromImg=function(e,t){var n=new osg.Texture;return n.setImage(e,t),n},osg.Texture.createFromImage=osg.Texture.createFromImg,osg.Texture.createFromCanvas=function(e,t){var n=new osg.Texture;return n.setFromCanvas(e,t),n},osg.Texture.create=function(e){return osg.log("osg.Texture.create is deprecated, use osg.Texture.createFromURL instead"),osg.Texture.createFromURL(e)},osg.TextureCubeMap=function(){osg.Texture.call(this),this._images={}},osg.TextureCubeMap.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.Texture.prototype,{setDefaultParameters:function(){osg.Texture.prototype.setDefaultParameters.call(this),this._textureTarget=osg.Texture.TEXTURE_CUBE_MAP},cloneType:function(){var e=new osg.TextureCubeMap;return e.default_type=!0,e},setImage:function(e,t,n){typeof e=="string"&&(e=osg.Texture[e]),this._images[e]===undefined&&(this._images[e]={}),typeof n=="string"&&(n=osg.Texture[n]),n===undefined&&(n=osg.Texture.RGBA),this._images[e].image=t,this._images[e].format=n,this._images[e].dirty=!0,this.dirty()},getImage:function(e){return this._images[e].image},applyTexImage2D_load:function(e,t,n,r,i,s,o){return o?osg.Texture.prototype.isImageReady(o)?(o instanceof Image?this.setTextureSize(o.naturalWidth,o.naturalHeight):o instanceof HTMLCanvasElement&&this.setTextureSize(o.width,o.height),e.texImage2D(t,0,r,i,s,o),!0):!1:!1},_applyImageTarget:function(e,t,n){var r=this._images[n];return r?r.dirty?this.applyTexImage2D_load(e,n,0,t,r.format,e.UNSIGNED_BYTE,r.image)?(r.dirty=!1,this._unrefImageDataAfterApply&&delete this._images[n],1):0:1:0},apply:function(e){var t=e.getGraphicContext();if(this._textureObject!==undefined&&!this.isDirty())t.bindTexture(this._textureTarget,this._textureObject);else if(this.default_type)t.bindTexture(this._textureTarget,null);else{var n=this._images;this._textureObject||this.init(t),t.bindTexture(this._textureTarget,this._textureObject);var r=this._internalFormat,i=0;i+=this._applyImageTarget(t,r,t.TEXTURE_CUBE_MAP_POSITIVE_X),i+=this._applyImageTarget(t,r,t.TEXTURE_CUBE_MAP_NEGATIVE_X),i+=this._applyImageTarget(t,r,t.TEXTURE_CUBE_MAP_POSITIVE_Y),i+=this._applyImageTarget(t,r,t.TEXTURE_CUBE_MAP_NEGATIVE_Y),i+=this._applyImageTarget(t,r,t.TEXTURE_CUBE_MAP_POSITIVE_Z),i+=this._applyImageTarget(t,r,t.TEXTURE_CUBE_MAP_NEGATIVE_Z),i===6&&(this.setDirty(!1),this.applyFilterParameter(t,this._textureTarget),this.generateMipmap(t,this._textureTarget))}}}),"osg","TextureCubeMap"),osg.UpdateVisitor=function(){osg.NodeVisitor.call(this);var e=new osg.FrameStamp;this.getFrameStamp=function(){return e},this.setFrameStamp=function(t){e=t}},osg.UpdateVisitor.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{apply:function(e){var t=e.getUpdateCallbackList();for(var n=0;n<t.length;n++)if(!t[n].update(e,this))return;this.traverse(e)}}),osg.Viewport=function(e,t,n,r){osg.StateAttribute.call(this),e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=800),r===undefined&&(r=600),this._x=e,this._y=t,this._width=n,this._height=r,this._dirty=!0},osg.Viewport.prototype=osg.objectLibraryClass(osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"Viewport",cloneType:function(){return new osg.Viewport},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(e){var t=e.getGraphicContext();t.viewport(this._x,this._y,this._width,this._height),this._dirty=!1},setViewport:function(e,t,n,r){this._x=e,this._y=t,this._width=n,this._height=r,this.dirty()},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height},computeWindowMatrix:function(){var e=osg.Matrix.makeTranslate(1,1,1),t=osg.Matrix.makeScale(.5*this._width,.5*this._height,.5),n=osg.Matrix.makeTranslate(this._x,this._y,0);return osg.Matrix.preMult(n,osg.Matrix.preMult(t,e))}}),"osg","Viewport"),osg.CullStack=function(){this._modelviewMatrixStack=[],this._projectionMatrixStack=[],this._viewportStack=[],this._bbCornerFar=0,this._bbCornerNear=0},osg.CullStack.prototype={getCurrentProjectionMatrix:function(){return this._projectionMatrixStack[this._projectionMatrixStack.length-1]},getCurrentModelviewMatrix:function(){return this._modelviewMatrixStack[this._modelviewMatrixStack.length-1]},getViewport:function(){return this._viewportStack.length===0?undefined:this._viewportStack[this._viewportStack.length-1]},getLookVectorLocal:function(){var e=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];return[-e[2],-e[6],-e[10]]},pushViewport:function(e){this._viewportStack.push(e)},popViewport:function(){this._viewportStack.pop()},pushModelviewMatrix:function(e){this._modelviewMatrixStack.push(e);var t=this.getLookVectorLocal();this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=~this._bbCornerFar&7},popModelviewMatrix:function(){this._modelviewMatrixStack.pop();var e;this._modelviewMatrixStack.length!==0?e=this.getLookVectorLocal():e=[0,0,-1],this._bbCornerFar=(e[0]>=0?1:0)|(e[1]>=0?2:0)|(e[2]>=0?4:0),this._bbCornerNear=~this._bbCornerFar&7},pushProjectionMatrix:function(e){this._projectionMatrixStack.push(e)},popProjectionMatrix:function(){this._projectionMatrixStack.pop()}},osg.CullVisitor=function(){osg.NodeVisitor.call(this),osg.CullSettings.call(this),osg.CullStack.call(this),this._rootStateGraph=undefined,this._currentStateGraph=undefined,this._currentRenderBin=undefined,this._currentRenderStage=undefined,this._rootRenderStage=undefined,this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY;var e=[0,0,-1];this._bbCornerFar=(e[0]>=0?1:0)|(e[1]>=0?2:0)|(e[2]>=0?4:0),this._bbCornerNear=~this._bbCornerFar&7,this._reserveMatrixStack=[[]],this._reserveMatrixStack.current=0,this._reserveLeafStack=[{}],this._reserveLeafStack.current=0,this._renderBinStack=[]},osg.CullVisitor.prototype=osg.objectInehrit(osg.CullStack.prototype,osg.objectInehrit(osg.CullSettings.prototype,osg.objectInehrit(osg.NodeVisitor.prototype,{distance:function(e,t){return-(e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+t[14])},handleCullCallbacksAndTraverse:function(e){var t=e.getCullCallback();if(t&&!t.cull(e,this))return;this.traverse(e)},updateCalculatedNearFar:function(e,t){var n=t.getBoundingBox(),r,i;r=this.distance(n.corner(this._bbCornerNear),e),i=this.distance(n.corner(this._bbCornerFar),e);if(r>i){var s=r;r=i,i=s}return i<0?!1:(r<this._computedNear&&(this._computedNear=r),i>this._computedFar&&(this._computedFar=i),!0)},clampProjectionMatrix:function(e,t,n,r,i){var s=1e-6;if(n<t-s)return osg.log("clampProjectionMatrix not applied, invalid depth range, znear = "+t+"  zfar = "+n),!1;var o,u;if(n<t+s){var a=(t+n)*.5;t=a-s,n=a+s}if(Math.abs(osg.Matrix.get(e,0,3))<s&&Math.abs(osg.Matrix.get(e,1,3))<s&&Math.abs(osg.Matrix.get(e,2,3))<s){var f=(n-t)*.02;f<1&&(f=1),o=t-f,u=n+f,t=o,n=u,osg.Matrix.set(e,2,2,-2/(u-o)),osg.Matrix.set(e,3,2,-(u+o)/(u-o))}else{var l=1.02,c=.98;o=t*c,u=n*l;var h=n*r;o<h&&(o=h),t=o,n=u;var p=osg.Matrix.get(e,2,2),d=osg.Matrix.get(e,3,2),v=osg.Matrix.get(e,2,3),m=osg.Matrix.get(e,3,3),g=(-o*p+d)/(-o*v+m),y=(-u*p+d)/(-u*v+m),b=Math.abs(2/(g-y)),w=-(g+y)/2,E=[1,0,0,0,0,1,0,0,0,0,b,0,0,0,w*b,1];osg.Matrix.postMult(E,e)}return i!==undefined&&(i[0]=t,i[1]=n),!0},setStateGraph:function(e){this._rootStateGraph=e,this._currentStateGraph=e},setRenderStage:function(e){this._rootRenderStage=e,this._currentRenderBin=e},reset:function(){this._modelviewMatrixStack.splice(0,this._modelviewMatrixStack.length),this._projectionMatrixStack.splice(0,this._projectionMatrixStack.length),this._reserveMatrixStack.current=0,this._reserveLeafStack.current=0,this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY},getCurrentRenderBin:function(){return this._currentRenderBin},setCurrentRenderBin:function(e){this._currentRenderBin=e},addPositionedAttribute:function(e){var t=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];this._currentRenderBin.getStage().positionedAttribute.push([t,e])},pushStateSet:function(e){this._currentStateGraph=this._currentStateGraph.findOrInsert(e);if(e.getBinName()!==undefined){var t=this._renderBinStack,n=this._currentRenderBin;t.push(n),this._currentRenderBin=n.getStage().findOrInsert(e.getBinNumber(),e.getBinName())}},popStateSet:function(){var e=this._currentStateGraph,t=e.getStateSet();this._currentStateGraph=e.parent;if(t.getBinName()!==undefined){var n=this._renderBinStack;n.length===0?this._currentRenderBin=this._currentRenderBin.getStage():this._currentRenderBin=n.pop()}},popProjectionMatrix:function(){if(this._computeNearFar===!0&&this._computedFar>=this._computedNear){var e=this._projectionMatrixStack[this._projectionMatrixStack.length-1];this.clampProjectionMatrix(e,this._computedNear,this._computedFar,this._nearFarRatio)}osg.CullStack.prototype.popProjectionMatrix.call(this)},apply:function(e){this[e.objectType].call(this,e)},_getReservedMatrix:function(){var e=this._reserveMatrixStack[this._reserveMatrixStack.current++];return this._reserveMatrixStack.current===this._reserveMatrixStack.length&&this._reserveMatrixStack.push(osg.Matrix.makeIdentity([])),e},_getReservedLeaf:function(){var e=this._reserveLeafStack[this._reserveLeafStack.current++];return this._reserveLeafStack.current===this._reserveLeafStack.length&&this._reserveLeafStack.push({}),e}}))),osg.CullVisitor.prototype[osg.Camera.prototype.objectType]=function(e){var t=e.getStateSet();t&&this.pushStateSet(t),e.light&&this.addPositionedAttribute(e.light);var n=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1],r=this._getReservedMatrix(),i=this._getReservedMatrix();if(e.getReferenceFrame()===osg.Transform.RELATIVE_RF){var s=this._projectionMatrixStack[this._projectionMatrixStack.length-1];osg.Matrix.mult(s,e.getProjectionMatrix(),i);var o=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];osg.Matrix.mult(o,e.getViewMatrix(),r)}else osg.Matrix.copy(e.getViewMatrix(),r),osg.Matrix.copy(e.getProjectionMatrix(),i);this.pushProjectionMatrix(i),this.pushModelviewMatrix(r),e.getViewport()&&this.pushViewport(e.getViewport());var u=this._computedNear,a=this._computedFar,f=new osg.CullSettings;f.setCullSettings(this),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY,this.setCullSettings(e);if(e.getRenderOrder()===osg.Camera.NESTED_RENDER)this.handleCullCallbacksAndTraverse(e);else{var l=this.getCurrentRenderBin().getStage(),c=new osg.RenderStage;c.setCamera(e),c.setClearDepth(e.getClearDepth()),c.setClearColor(e.getClearColor()),c.setClearMask(e.getClearMask());var h;e.getViewport()===undefined?h=l.getViewport():h=e.getViewport(),c.setViewport(h);var p=this.getCurrentRenderBin();this.setCurrentRenderBin(c),this.handleCullCallbacksAndTraverse(e),this.setCurrentRenderBin(p),e.getRenderOrder()===osg.Camera.PRE_RENDER?this.getCurrentRenderBin().getStage().addPreRenderStage(c,e.renderOrderNum):this.getCurrentRenderBin().getStage().addPostRenderStage(c,e.renderOrderNum)}this.popModelviewMatrix(),this.popProjectionMatrix(),e.getViewport()&&this.popViewport(),this.setCullSettings(f),this._computedNear=u,this._computedFar=a,t&&this.popStateSet()},osg.CullVisitor.prototype[osg.MatrixTransform.prototype.objectType]=function(e){var t=this._getReservedMatrix();if(e.getReferenceFrame()===osg.Transform.RELATIVE_RF){var n=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];osg.Matrix.mult(n,e.getMatrix(),t)}else osg.Matrix.copy(e.getMatrix(),t);this.pushModelviewMatrix(t);var r=e.getStateSet();r&&this.pushStateSet(r),e.light&&this.addPositionedAttribute(e.light),this.handleCullCallbacksAndTraverse(e),r&&this.popStateSet(),this.popModelviewMatrix()},osg.CullVisitor.prototype[osg.Projection.prototype.objectType]=function(e){lastMatrixStack=this._projectionMatrixStack[this._projectionMatrixStack.length-1];var t=this._getReservedMatrix();osg.Matrix.mult(lastMatrixStack,e.getProjectionMatrix(),t),this.pushProjectionMatrix(t);var n=e.getStateSet();n&&this.pushStateSet(n),this.handleCullCallbacksAndTraverse(e),n&&this.popStateSet(),this.popProjectionMatrix()},osg.CullVisitor.prototype[osg.Node.prototype.objectType]=function(e){var t=e.getStateSet();t&&this.pushStateSet(t),e.light&&this.addPositionedAttribute(e.light),this.handleCullCallbacksAndTraverse(e),t&&this.popStateSet()},osg.CullVisitor.prototype[osg.LightSource.prototype.objectType]=function(e){var t=e.getStateSet();t&&this.pushStateSet(t);var n=e.getLight();n&&this.addPositionedAttribute(n),this.handleCullCallbacksAndTraverse(e),t&&this.popStateSet()},osg.CullVisitor.prototype[osg.Geometry.prototype.objectType]=function(e){var t=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1],n=e.getBoundingBox();if(this._computeNearFar&&n.valid()&&!this.updateCalculatedNearFar(t,e))return;var r=e.getStateSet();r&&this.pushStateSet(r),this.handleCullCallbacksAndTraverse(e);var i=this._currentStateGraph.leafs;i.length===0&&this._currentRenderBin.addStateGraph(this._currentStateGraph);var s=this._getReservedLeaf(),o=0;n.valid()&&(o=this.distance(n.center(),t)),isNaN(o)?osg.warn("warning geometry has a NaN depth, "+t+" center "+n.center()):(s.parent=this._currentStateGraph,s.projection=this._projectionMatrixStack[this._projectionMatrixStack.length-1],s.geometry=e,s.modelview=t,s.depth=o,i.push(s)),r&&this.popStateSet()};var osgAnimation={};osgAnimation.EaseOutQuad=function(e){return-(e*(e-2))},osgAnimation.EaseInQuad=function(e){return e*e},osgAnimation.EaseOutCubic=function(e){return e-=1,e*e*e+1},osgAnimation.EaseInCubic=function(e){return e*e*e},osgAnimation.EaseOutQuart=function(e){return e-=1,-(e*e*e*e-1)},osgAnimation.EaseInQuart=function(e){return e*e*e*e},osgAnimation.EaseOutElastic=function(e){return Math.pow(2,-10*e)*Math.sin((e-.075)*2*Math.PI/.3)+1},osgAnimation.easeOutBounce=function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},osgAnimation.easeOutQuad=osgAnimation.EaseOutQuad,osgAnimation.easeInQuad=osgAnimation.EaseInQuad,osgAnimation.easeOutCubic=osgAnimation.EaseOutCubic,osgAnimation.easeInCubic=osgAnimation.EaseInCubic,osgAnimation.easeOutQuart=osgAnimation.EaseOutQuart,osgAnimation.easeInQuart=osgAnimation.EaseInQuart,osgAnimation.easeOutElastic=osgAnimation.EaseOutElastic,osgAnimation.Animation=function(){osg.Object.call(this),this._channels=[]},osgAnimation.Animation.prototype=osg.objectInehrit(osg.Object.prototype,{getChannels:function(){return this._channels},getDuration:function(){var e=1e5,t=-1e5;for(var n=0,r=this._channels.length;n<r;n++){var i=this._channels[n];e=Math.min(e,i.getStartTime()),t=Math.max(t,i.getEndTime())}return t-e}}),osgAnimation.BasicAnimationManager=function(){osg.Object.call(this),this._animations={},this._actives={},this._actives._keys=[],this._lastUpdate=undefined,this._targets=[]},osgAnimation.BasicAnimationManager.prototype=osg.objectInehrit(osg.Object.prototype,{_updateAnimation:function(e,t,n){var r=e.duration,i=e.weight,s=e.anim,o=e.start,u=e.loop;if(u>0){var a=t-o;if(a>=u*r)return!0}t=(t-o)%r;var f=e.callback;f&&f(t);var l=s.getChannels();for(var c=0,h=l.length;c<h;c++){var p=l[c];p.update(t,i,n)}return!1},update:function(e,t){var n=t.getFrameStamp().getSimulationTime();return this.updateManager(n),!0},updateManager:function(e){var t=this._targets;for(var n=0,r=t.length;n<r;n++)t[n].reset();if(this._actives._keys.length>0){var i=this._actives._keys.length-1;while(i>=0){var s=this._actives[i],o=this._actives[i]._keys,u=[];for(var a=0,f=o.length;a<f;a++){var l=o[a],c=s[l];c.start===undefined&&(c.start=e);var h=this._updateAnimation(c,e,i);h&&u.push(a)}for(var p=u.length-1;p>=0;p--){var d=o[p];o.splice(p,1),delete s[d]}i--}}},stopAll:function(){},isPlaying:function(e){if(this._actives._keys.length>0){var t=this._actives._keys.length-1;while(t>=0){if(this._actives[t][e])return!0;t--}}return!1},stopAnimation:function(e){if(this._actives._keys.length>0){var t=this._actives._keys.length-1,n=function(e,t,n){return e!=="_keys"};while(t>=0){if(this._actives[t][e]){delete this._actives[t][e],this._actives[t]._keys=Object.keys(this._actives[t]).filter(n);return}t--}}},playAnimationObject:function(e){if(e.name===undefined)return;var t=this._animations[e.name];if(t===undefined){osg.log("no animation "+e.name+" found");return}if(this.isPlaying(e.name))return;e.priority===undefined&&(e.priority=0),e.weight===undefined&&(e.weight=1),e.timeFactor===undefined&&(e.timeFactor=1),e.loop===undefined&&(e.loop=0),this._actives[e.priority]===undefined&&(this._actives[e.priority]={},this._actives[e.priority]._keys=[],this._actives._keys.push(e.priority)),e.start=undefined,e.duration=t.getDuration(),e.anim=t,this._actives[e.priority][e.name]=e,this._actives[e.priority]._keys.push(e.name)},playAnimation:function(e,t,n){var r=e;if(typeof e=="object"){if(e.getName===undefined)return this.playAnimationObject(e);r=e.getName()}var i={name:r,priority:t,weight:n};return this.playAnimationObject(i)},registerAnimation:function(e){this._animations[e.getName()]=e,this.buildTargetList()},getAnimationMap:function(){return this._animations},buildTargetList:function(){this._targets.length=0;var e=Object.keys(this._animations);for(var t=0,n=e.length;t<n;t++){var r=this._animations[e[t]],i=r.getChannels();for(var s=0,o=i.length;s<o;s++){var u=i[s];this._targets.push(u.getTarget())}}}}),osgAnimation.Channel=function(e,t){osg.Object.call(this),this._sampler=e,this._target=t,this._targetName=undefined,this._data={value:undefined,key:0}},osgAnimation.Channel.prototype=osg.objectInehrit(osg.Object.prototype,{getKeyframes:function(){return this._sampler.getKeyframes()},setKeyframes:function(e){this._sampler.setKeyframes(e)},getStartTime:function(){return this._sampler.getStartTime()},getEndTime:function(){return this._sampler.getEndTime()},getSampler:function(){return this._sampler},setSampler:function(e){this._sampler=e},getTarget:function(){return this._target},setTarget:function(e){this._target=e},setTargetName:function(e){this._targetName=e},getTargetName:function(){return this._targetName},update:function(e,t,n){t=t||1,n=n||0;if(t<1e-4)return;var r=this._data;this._sampler.getValueAt(e,r),this._target.update.call(this._target,t,r.value,n)},reset:function(){this._target.reset()}}),osgAnimation.Vec3LerpChannel=function(e,t){var n=new osgAnimation.Sampler;e||(e=[]),t||(t=new osgAnimation.Vec3Target),osgAnimation.Channel.call(this,n,t),n.setInterpolator(osgAnimation.Vec3LerpInterpolator),this.setKeyframes(e),this._data.value=osg.Vec3.copy(t.getValue(),[])},osgAnimation.Vec3LerpChannel.prototype=osgAnimation.Channel.prototype,osgAnimation.FloatLerpChannel=function(e,t){var n=new osgAnimation.Sampler;e||(e=[]),t||(t=new osgAnimation.FloatTarget),osgAnimation.Channel.call(this,n,t),n.setInterpolator(osgAnimation.FloatLerpInterpolator),this.setKeyframes(e),this._data.value=t.getValue()},osgAnimation.FloatLerpChannel.prototype=osgAnimation.Channel.prototype,osgAnimation.QuatLerpChannel=function(e,t){var n=new osgAnimation.Sampler;e||(e=[]),t||(t=new osgAnimation.QuatTarget),osgAnimation.Channel.call(this,n,t),n.setInterpolator(osgAnimation.QuatLerpInterpolator),this.setKeyframes(e),this._data.value=osg.Quat.copy(t.getValue(),[])},osgAnimation.QuatLerpChannel.prototype=osgAnimation.Channel.prototype,osgAnimation.QuatSlerpChannel=function(e,t){osgAnimation.QuatLerpChannel.call(this,e,t),this.getSampler().setInterpolator(osgAnimation.QuatSlerpInterpolator)},osgAnimation.QuatSlerpChannel.prototype=osgAnimation.Channel.prototype,osgAnimation.Vec3LerpInterpolator=function(e,t,n){var r,i,s=e[e.length-1],o=s.t;if(t>=o){n.key=0,n.value[0]=s[0],n.value[1]=s[1],n.value[2]=s[2];return}r=e[0],i=r.t;if(t<=i){n.key=0,n.value[0]=r[0],n.value[1]=r[1],n.value[2]=r[2];return}var u=n.key;while(e[u+1].t<t)u++;var a=u+1,f=e[u].t,l=e[u][0],c=e[u][1],h=e[u][2],p=e[a].t,d=e[a][0],v=e[a][1],m=e[a][2],g=(t-f)/(p-f);n.value[0]=l+(d-l)*g,n.value[1]=c+(v-c)*g,n.value[2]=h+(m-h)*g,n.key=u},osgAnimation.QuatLerpInterpolator=function(e,t,n){var r,i,s=e[e.length-1],o=s.t;if(t>=o){n.key=0,n.value[0]=s[0],n.value[1]=s[1],n.value[2]=s[2],n.value[3]=s[3];return}r=e[0],i=r.t;if(t<=i){n.key=0,n.value[0]=r[0],n.value[1]=r[1],n.value[2]=r[2],n.value[3]=r[3];return}var u=n.key;while(e[u+1].t<t)u++;var a=u+1,f=e[u].t,l=e[u][0],c=e[u][1],h=e[u][2],p=e[u][3],d=e[a].t,v=e[a][0],m=e[a][1],g=e[a][2],y=e[a][3],b=(t-f)/(d-f);n.value[0]=l+(v-l)*b,n.value[1]=c+(m-c)*b,n.value[2]=h+(g-h)*b,n.value[3]=p+(y-p)*b,n.key=u},osgAnimation.QuatSlerpInterpolator=function(e,t,n){var r,i,s=e[e.length-1],o=s.t;if(t>=o){n.key=0,n.value[0]=s[0],n.value[1]=s[1],n.value[2]=s[2],n.value[3]=s[3];return}r=e[0],i=r.t;if(t<=i){n.key=0,n.value[0]=r[0],n.value[1]=r[1],n.value[2]=r[2],n.value[3]=r[3];return}var u=n.key;while(e[u+1].t<t)u++;var a=u+1,f=e[u].t,l=e[a].t,c=(t-f)/(l-f);osg.Quat.slerp(c,e[u],e[a],n.value),n.key=u},osgAnimation.FloatLerpInterpolator=function(e,t,n){var r,i,s=e[e.length-1],o=s.t;if(t>=o){n.key=0,n.value=s[0];return}r=e[0],i=r.t;if(t<=i){n.key=0,n.value=r[0];return}var u=n.key;while(e[u+1].t<t)u++;var a=u+1,f=e[u].t,l=e[u][0],c=e[a].t,h=e[a][0],p=(t-f)/(c-f);n.value=l+(h-l)*p,n.key=u},osgAnimation.FloatStepInterpolator=function(e,t,n){var r,i,s=e[e.length-1],o=s.t;if(t>=o){n.key=0,n.value=s[0];return}r=e[0],i=r.t;if(t<=i){n.key=0,n.value=r[0];return}var u=n.key;while(e[u+1].t<t)u++;var a=u+1,f=e[u].t,l=e[u][0];n.value=l,n.key=u},osgAnimation.createVec3Keyframe=function(e,t){var n=t.slice(0);return n.t=e,n},osgAnimation.createQuatKeyframe=function(e,t){var n=t.slice(0);return n.t=e,n},osgAnimation.createFloatKeyframe=function(e,t){var n=[t];return n.t=e,n},osgAnimation.LinkVisitor=function(){osg.NodeVisitor.call(this),this._animations=undefined,this._nbLinkTarget=0},osgAnimation.LinkVisitor.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{setAnimationMap:function(e){this._animations=e,this._animationKeys=Object.keys(e)},apply:function(e){var t=e.getUpdateCallbackList();for(var n=0,r=t.length;n<r;n++){var i=t[n];i instanceof osgAnimation.AnimationUpdateCallback&&this.link(i)}this.traverse(e)},link:function(e){var t=0,n=this._animations,r=this._animationKeys;for(var i=0,s=r.length;i<s;i++){var o=r[i],u=n[o];t+=e.linkAnimation(u)}this._nbLinkedTarget+=t,osg.log("linked "+t+' for "'+e.getName()+'"')}}),osgAnimation.Sampler=function(e,t){e||(e=[]),this._keys=e,this._interpolator=t},osgAnimation.Sampler.prototype={getKeyframes:function(){return this._keys},setKeyframes:function(e){this._keys=e},setInterpolator:function(e){this._interpolator=e},getInterpolator:function(){return this._interpolator},getStartTime:function(){return this._keys.length===0?undefined:this._keys[0].t},getEndTime:function(){return this._keys.length===0?undefined:this._keys[this._keys.length-1].t},getValueAt:function(e,t){this._keys[t.key].t>e&&(t.key=0),this._interpolator(this._keys,e,t)}},osgAnimation.StackedTranslate=function(e,t){osg.Object.call(this),t||(t=[0,0,0]),this._translate=t,this._target=undefined,this.setName(e)},osgAnimation.StackedTranslate.prototype=osg.objectInehrit(osg.Object.prototype,{setTranslate:function(e){osg.Vec3.copy(e,this._translate)},setTarget:function(e){this._target=e},getTarget:function(){return this._target},update:function(){this._target!==undefined&&osg.Vec3.copy(this._target.getValue(),this._translate)},getOrCreateTarget:function(){return this._target||(this._target=new osgAnimation.Vec3Target(this._translate)),this._target},applyToMatrix:function(e){osg.Matrix.preMultTranslate(e,this._translate)}}),osgAnimation.StackedRotateAxis=function(e,t,n){osg.Object.call(this),t||(t=[1,0,0]),n||(n=0),this._axis=t,this._angle=n,this._target=undefined,this.setName(e),this._matrixTmp=[],osg.Matrix.makeIdentity(this._matrixTmp),this._quatTmp=[],osg.Quat.makeIdentity(this._quatTmp)},osgAnimation.StackedRotateAxis.prototype=osg.objectInehrit(osg.Object.prototype,{setAxis:function(e){osg.Vec3.copy(e,this._axis)},setAngle:function(e){this._angle=e},setTarget:function(e){this._target=e},getTarget:function(){return this._target},update:function(){this._target!==undefined&&(this._angle=this._target.getValue())},getOrCreateTarget:function(){return this._target||(this._target=new osgAnimation.FloatTarget(this._angle)),this._target},applyToMatrix:function(e){var t=this._axis,n=this._quatTmp,r=this._matrixTmp;osg.Quat.makeRotate(this._angle,t[0],t[1],t[2],n),osg.Matrix.setRotateFromQuat(r,n),osg.Matrix.preMult(e,r)}}),osgAnimation.StackedQuaternion=function(e,t){osg.Object.call(this),t||(t=[0,0,0,1]),this._quaternion=t,this._target=undefined,this._matrixTmp=[],osg.Matrix.makeIdentity(this._matrixTmp),this.setName(e)},osgAnimation.StackedQuaternion.prototype=osg.objectInehrit(osg.Object.prototype,{setQuaternion:function(e){osg.Quat.copy(e,this._quaternion)},setTarget:function(e){this._target=e},getTarget:function(){return this._target},update:function(){this._target!==undefined&&osg.Quat.copy(this._target.getValue(),this._quaternion)},getOrCreateTarget:function(){return this._target||(this._target=new osgAnimation.QuatTarget(this._quaternion)),this._target},applyToMatrix:function(e){var t=this._matrixTmp;osg.Matrix.setRotateFromQuat(t,this._quaternion),osg.Matrix.preMult(e,t)}}),osgAnimation.Target=function(){this._weight=0,this._priorityWeight=0,this._count=0,this._lastPriority=0,this._target=undefined},osgAnimation.Target.prototype={reset:function(){this._weight=0,this._priorityWeight=0},getValue:function(){return this._target}},osgAnimation.Vec3Target=function(){osgAnimation.Target.call(this),this._target=[0,0,0]},osgAnimation.Vec3Target.prototype=osg.objectInehrit(osgAnimation.Target.prototype,{update:function(e,n,r){this._weight||this._priorityWeight?(this._lastPriority!=r&&(this._weight+=this._priorityWeight*(1-this._weight),this._priorityWeight=0,this._lastPriority=r),this._priorityWeight+=e,t=(1-this._weight)*e/this._priorityWeight,osg.Vec3.lerp(t,this._target,n,this._target)):(this._priorityWeight=e,this._lastPriority=r,osg.Vec3.copy(n,this._target))}}),osgAnimation.FloatTarget=function(e){osgAnimation.Target.call(this),this._target=[e]},osgAnimation.FloatTarget.prototype=osg.objectInehrit(osgAnimation.Target.prototype,{update:function(e,n,r){this._weight||this._priorityWeight?(this._lastPriority!=r&&(this._weight+=this._priorityWeight*(1-this._weight),this._priorityWeight=0,this._lastPriority=r),this._priorityWeight+=e,t=(1-this._weight)*e/this._priorityWeight,this._target+=(n-this._target)*t):(this._priorityWeight=e,this._lastPriority=r,this._target=n)}}),osgAnimation.QuatTarget=function(){osgAnimation.Target.call(this),this._target=[],osg.Quat.makeIdentity(this._target)},osgAnimation.QuatTarget.prototype=osg.objectInehrit(osgAnimation.Target.prototype,{update:function(e,n,r){this._weight||this._priorityWeight?(this._lastPriority!=r&&(this._weight+=this._priorityWeight*(1-this._weight),this._priorityWeight=0,this._lastPriority=r),this._priorityWeight+=e,t=(1-this._weight)*e/this._priorityWeight,osg.Quat.lerp(t,this._target,n,this._target),osg.Quat.normalize(this._target,this._target)):(this._priorityWeight=e,this._lastPriority=r,osg.Quat.copy(n,this._target))}}),osgAnimation.AnimationUpdateCallback=function(){},osgAnimation.AnimationUpdateCallback.prototype=osg.objectInehrit(osg.Object.prototype,{linkChannel:function(){},linkAnimation:function(e){var t=this.getName();if(t.length===0)return osg.log("no name on an update callback, discard"),0;var n=0,r=e.getChannels();for(var i=0,s=r.length;i<s;i++){var o=r[i];o.getTargetName()===t&&(this.linkChannel(o),n++)}return n}}),osgAnimation.UpdateMatrixTransform=function(){osgAnimation.AnimationUpdateCallback.call(this),this._stackedTransforms=[]},osgAnimation.UpdateMatrixTransform.prototype=osg.objectInehrit(osgAnimation.AnimationUpdateCallback.prototype,{getStackedTransforms:function(){return this._stackedTransforms},update:function(e,t){var n=e.getMatrix();osg.Matrix.makeIdentity(n);var r=this._stackedTransforms;for(var i=0,s=r.length;i<s;i++){var o=r[i];o.update(),o.applyToMatrix(n)}return!0},linkChannel:function(e){var t=e.getName(),n=this._stackedTransforms;for(var r=0,i=n.length;r<i;r++){var s=n[r],o=s.getName();if(t.length>0&&o===t){var u=s.getOrCreateTarget();if(u)return e.setTarget(u),!0}}osg.log("can't link channel "+t+", does not contain a symbolic name that can be linked to TransformElements")}});var osgUtil={};osgUtil.TriangleHit=function(e,t,n,r,i,s,o,u){this.index=e,this.normal=t,this.r1=n,this.v1=r,this.r2=i,this.v2=s,this.r3=o,this.v3=u},osgUtil.TriangleIntersect=function(){this.hits=[],this.nodePath=[]},osgUtil.TriangleIntersect.prototype={setNodePath:function(e){this.nodePath=e},set:function(e,t){this.start=e,this.end=t,this.dir=osg.Vec3.sub(t,e,[]),this.length=osg.Vec3.length(this.dir);var n=1/this.length;osg.Vec3.mult(this.dir,n,this.dir)},applyDrawElementsTriangles:function(e,t,n){var r=[],i=[],s=[],o,u,a;for(var f=0;f<e;f+=3)o=n[f]*3,r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],u=n[f+1]*3,i[0]=t[u],i[1]=t[u+1],i[2]=t[u+2],a=n[f+2]*3,s[0]=t[a],s[1]=t[a+1],s[2]=t[a+2],this.intersect(r,i,s)},applyDrawElementsTriangleStrip:function(e,t,n){var r=[],i=[],s=[],o,u,a;for(var f=2,l=0;f<e;f++,l++)f%2?(o=n[l]*3,u=n[l+2]*3,a=n[l+1]*3):(o=n[l]*3,u=n[l+1]*3,a=n[l+2]*3),r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],i[0]=t[u],i[1]=t[u+1],i[2]=t[u+2],s[0]=t[a],s[1]=t[a+1],s[2]=t[a+2],this.intersect(r,i,s)},applyDrawElementsTriangleFan:function(e,t,n){var r=[],i=[],s=[],o=n[0]*3;r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2];var u,a;for(var f=2,l=1;f<e;f++,l++)u=n[l]*3,a=n[l+1]*3,i[0]=t[u],i[1]=t[u+1],i[2]=t[u+2],s[0]=t[a],s[1]=t[a+1],s[2]=t[a+2],this.intersect(r,i,s)},applyDrawArraysTriangles:function(e,t,n){var r=[],i=[],s=[];for(var o=e;o<t;o+=9)r[0]=n[o],r[1]=n[o+1],r[2]=n[o+2],i[0]=n[o+3],i[1]=n[o+4],i[2]=n[o+5],s[0]=n[o+6],s[1]=n[o+7],s[2]=n[o+8],this.intersect(r,i,s)},applyDrawArraysTriangleStrip:function(e,t,n){var r=[],i=[],s=[],o,u,a;for(var f=2,l=e;f<t;f++,l++)f%2?(o=l*3,u=(l+2)*3,a=(l+1)*3):(o=l*3,u=(l+1)*3,a=(l+2)*3),r[0]=n[o],r[1]=n[o+1],r[2]=n[o+2],i[0]=n[u],i[1]=n[u+1],i[2]=n[u+2],s[0]=n[a],s[1]=n[a+1],s[2]=n[a+2],this.intersect(r,i,s)},applyDrawArraysTriangleFan:function(e,t,n){var r=[],i=[],s=[],o=e*3;r[0]=n[o],r[1]=n[o+1],r[2]=n[o+2];var u,a;for(var f=2,l=e+1;f<t;f++,l++)u=l*3,a=(l+1)*3,i[0]=n[u],i[1]=n[u+1],i[2]=n[u+2],s[0]=n[a],s[1]=n[a+1],s[2]=n[a+2],this.intersect(r,i,s)},apply:function(e){if(!e.getAttributes().Vertex)return;var t,n,r=e.getAttributes().Vertex.getElements();this.index=0;for(var i=0,s=e.primitives.length;i<s;i++){t=e.primitives[i];if(t.getIndices!==undefined){var o=t.indices.getElements();switch(t.getMode()){case gl.TRIANGLES:this.applyDrawElementsTriangles(t.getCount(),r,o);break;case gl.TRIANGLE_STRIP:this.applyDrawElementsTriangleStrip(t.getCount(),r,o);break;case gl.TRIANGLE_FAN:this.applyDrawElementsTriangleFan(t.getCount(),r,o)}}else switch(t.getMode()){case gl.TRIANGLES:this.applyDrawArraysTriangles(t.getFirst(),t.getCount(),r);break;case gl.TRIANGLE_STRIP:this.applyDrawArraysTriangleStrip(t.getFirst(),t.getCount(),r);break;case gl.TRIANGLE_FAN:this.applyDrawArraysTriangleFan(t.getFirst(),t.getCount(),r)}}},intersect:function(e,t,n){this.index++;if(e==t||t==n||e==n)return;var r=osg.Vec3.sub(t,e,[]),i=osg.Vec3.cross(r,this.dir,[]),s=osg.Vec3.dot(osg.Vec3.sub(this.start,e,[]),i),o=osg.Vec3.dot(osg.Vec3.sub(n,e,[]),i);if(o>=0){if(s<0)return;if(s>o)return}else{if(s>0)return;if(s<o)return}var u=osg.Vec3.sub(n,t,[]),a=osg.Vec3.cross(u,this.dir,[]),f=osg.Vec3.dot(osg.Vec3.sub(this.start,t,[]),a),l=osg.Vec3.dot(osg.Vec3.sub(e,t,[]),a);if(l>=0){if(f<0)return;if(f>l)return}else{if(f>0)return;if(f<l)return}var c=osg.Vec3.sub(e,n,[]),h=osg.Vec3.cross(c,this.dir,[]),p=osg.Vec3.dot(osg.Vec3.sub(this.start,n,[]),h),d=osg.Vec3.dot(osg.Vec3.sub(t,n,[]),h);if(d>=0){if(p<0)return;if(p>d)return}else{if(p>0)return;if(p<d)return}var v;if(s===0)v=0;else{if(o===0)return;v=s/o}var m;if(f===0)m=0;else{if(l===0)return;m=f/l}var g;if(p===0)g=0;else{if(d===0)return;g=p/d}var y=m+g+v;if(y!==1){if(y===0)return;var b=1/y;m*=b,g*=b,v*=b}var w=[];osg.Vec3.add(osg.Vec3.mult(e,m,[]),osg.Vec3.mult(t,g,[]),w),osg.Vec3.add(osg.Vec3.mult(n,v,[]),w,w);if(!osg.Vec3.valid(w)){osg.log("Warning: TriangleIntersect "),osg.log("hit:     "+w),osg.log("         "+e),osg.log("         "+t),osg.log("         "+n);return}var E=osg.Vec3.dot(osg.Vec3.sub(w,this.start,[]),this.dir);if(E<0)return;if(E>this.length)return;var S=osg.Vec3.cross(r,u,[]);osg.Vec3.normalize(S,S);var x=E/this.length,T=[];T[0]=this.start[0]*(1-x)+this.end[0]*x,T[1]=this.start[1]*(1-x)+this.end[1]*x,T[2]=this.start[2]*(1-x)+this.end[2]*x,this.hits.push({ratio:x,nodepath:this.nodePath.slice(0),triangleHit:new osgUtil.TriangleHit(this.index-1,S,m,e,g,t,v,n),point:T}),this.hit=!0}},osgUtil.IntersectVisitor=function(){osg.NodeVisitor.call(this),this.matrix=[],this.hits=[],this.nodePath=[]},osgUtil.IntersectVisitor.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{addLineSegment:function(e,t){this.start=e,this.end=t},intersectSegmentWithSphere:function(e,t,n){var r=osg.Vec3.sub(e,n.center),i=osg.Vec3.length2(r)-n.radius*n.radius;if(i<0)return!0;var s=osg.Vec3.sub(t,e),o=osg.Vec3.length2(s),u=osg.Vec3.dot(r,s)*2,a=u*u-4*o*i;if(a<0)return!1;a=Math.sqrt(a);var f=.5*o,l=(-u-a)*f,c=(-u+a)*f;return l<=0&&c<=0?!1:l>=1&&c>=1?!1:!0},pushModelMatrix:function(e){if(this.matrix.length>0){var t=osg.Matrix.copy(this.matrix[this.matrix.length-1]);osg.Matrix.preMult(t,e),this.matrix.push(t)}else this.matrix.push(e)},getModelMatrix:function(){return this.matrix.length===0?osg.Matrix.makeIdentity([]):this.matrix[this.matrix.length-1]},popModelMatrix:function(){return this.matrix.pop()},getWindowMatrix:function(){return this.windowMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getViewMatrix:function(){return this.viewMatrix},intersectSegmentWithGeometry:function(e,t,n){ti=new osgUtil.TriangleIntersect,ti.setNodePath(this.nodePath),ti.set(e,t),ti.apply(n);var r=ti.hits.length;if(r>0){for(var i=0;i<r;i++)this.hits.push(ti.hits[i]);return!0}return!1},pushCamera:function(e){this.projectionMatrix=e.getProjectionMatrix(),this.viewMatrix=e.getViewMatrix();var t=e.getViewport();t!==undefined&&(this.windowMatrix=t.computeWindowMatrix())},applyCamera:function(e){this.pushCamera(e),this.traverse(e)},applyNode:function(e){e.getMatrix&&this.pushModelMatrix(e.getMatrix());if(e.primitives){var t=[];osg.Matrix.copy(this.getWindowMatrix(),t),osg.Matrix.preMult(t,this.getProjectionMatrix()),osg.Matrix.preMult(t,this.getViewMatrix()),osg.Matrix.preMult(t,this.getModelMatrix());var n=[],r=osg.Matrix.inverse(t,n);if(!r)return;var i=osg.Matrix.transformVec3(n,this.start,new Array(3)),s=osg.Matrix.transformVec3(n,this.end,new Array(3));this.intersectSegmentWithGeometry(i,s,e)}e.traverse&&this.traverse(e),e.getMatrix&&this.popModelMatrix()},apply:function(e){if(this.enterNode(e)===!1)return;e.getViewMatrix?this.applyCamera(e):this.applyNode(e)},enterNode:function(e){var t=e.boundingSphere;return t!==undefined&&!this.intersectSegmentWithSphere?!1:!0}}),function(){var e=function(e){e!==undefined&&(e.object!==undefined&&e.field!==undefined&&this.createInternalSlider(param),this._uniform=this.createInternalSliderUniform(param))};e.prototype={setTargetHTML:function(e){this.parent=e},addToDom:function(e){var t=document.createElement("div");t.innerHTML=e,this.parent.appendChild(t)},getValue:function(e){if(window.localStorage){var t=window.localStorage.getItem(e);return t}return null},setValue:function(e,t){window.localStorage&&window.localStorage.setItem(e,t)},createHTMLSlider:function(e,t,n,r){var i='<div>NAME [ MIN - MAX ] <input type="range" min="MIN" max="MAX" value="VALUE" step="STEP" onchange="ONCHANGE" /><span id="UPDATE"></span></div>',s=e.min,o=e.max,u=e.step,a=n,f=r,l=f+"(this.value)";return i=i.replace(/MIN/g,s),i=i.replace(/MAX/g,o+u),i=i.replace("STEP",u),i=i.replace("VALUE",t),i=i.replace(/NAME/g,a),i=i.replace(/UPDATE/g,f),i=i.replace("ONCHANGE",l),i},createUniformFunction:function(e,t,n,r,i){return self=this,function(){var s=t,o=n,u=r,a=i,f=function(t){u.get()[o]=t,u.dirty(),osg.debug(s+" value "+t),document.getElementById(i).innerHTML=Number(t).toFixed(4),self.setValue(a,t),e.onchange!==undefined&&e.onchange(u.get())};return f}()},createFunction:function(e,t,n,r,i,s){return self=this,function(){var o=t,u=n,a=i,f=s,l=r,c=function(t){typeof t=="string"&&(t=parseFloat(t)),typeof r[a]=="number"?l[a]=t:l[a][n]=t,osg.debug(o+" value "+t),document.getElementById(s).innerHTML=Number(t).toFixed(4),self.setValue(f,t),e.onchange!==undefined&&e.onchange(l[a])};return c}()},getCallbackName:function(e,t){return"change_"+t+"_"+e},copyDefaultValue:function(e){var t=e.value;return Array.isArray(e.value)?t=e.value.slice():t=[t],t},createInternalSliderUniform:function(e){var t=e.value,n=e.uniform;if(n===undefined){var r=e.type;r=r.charAt(0).toUpperCase()+r.slice(1),n=osg.Uniform["create"+r](t,e.name)}var i=this.getCallbackName(e.name,e.id),s=t.length;for(var o=0;o<s;o++){var u=o.toString(),a=e.name+u,f=i+u,l=t[o],c=this.getValue(f);c!==null?l=c:e.uniform&&e.uniform.get()[o]!==undefined&&(l=e.uniform.get()[o]);var h=this.createHTMLSlider(e,l,a,f);this.addToDom(h),window[f]=this.createUniformFunction(e,a,o,n,f),osg.log(a+" "+l),window[f](l)}return this.uniform=n,n},createInternalSlider:function(e){var t=e.value,n=e.name,r=e.id,i=t.length,s=this.getCallbackName(n,r),o=e.object,u=e.field;for(var a=0;a<i;a++){var f=a.toString(),l=n+f,c=s+f,h=t[a],p=this.getValue(c);p!==null?h=p:typeof o[u]=="number"?h=o[u]:h=o[u][a];var d=this.createHTMLSlider(e,h,l,c);this.addToDom(d),window[c]=this.createFunction(e,l,a,o,u,c),osg.log(l+" "+h),window[c](h)}},createSlider:function(e){return e.html!==undefined&&this.setTargetHTML(e.html),e.id===undefined&&(e.id=e.name),e.value=this.copyDefaultValue(e),e.type!==undefined?this.createInternalSliderUniform(e):(e.object===undefined&&(e.object={data:e.value},e.field="data"),this.createInternalSlider(e))}},osgUtil.ParameterVisitor=function(){osg.NodeVisitor.call(this),this.arraySlider=new e,this.setTargetHTML(document.body)},osgUtil.ParameterVisitor.createSlider=function(t){(new e).createSlider(t)},osgUtil.ParameterVisitor.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{setTargetHTML:function(e){this.targetHTML=e,this.arraySlider.setTargetHTML(this.targetHTML)},getUniformList:function(e,t){var n="(uniform)",r=".*?",i="((?:[a-z][a-z]+))",s=".*?",o="((?:[a-z][a-z]+))",u=".*?",a=".",f=".*?",l=".",c=".*?",h="(.)",p="(.)",d=".*?",v="(\\{.*?\\})",m=new RegExp(n+r+i+s+o+u+a+f+l+c+h+p+d+v,["g"]),g=e.match(m),y=t;if(g!==null){var b=new RegExp(n+r+i+s+o+u+a+f+l+c+h+p+d+v,["i"]);for(var w=0,E=g.length;w<E;w++){var S=g[w].match(b);if(S!==null){var x=S[1],T=S[2],N=S[3],C=S[4],k=S[5],L=S[6],A=JSON.parse(L);A.type=T,A.name=N;var O=A.value;A.value=function(){return O},y[N]=A}}}return y},getUniformFromStateSet:function(e,t){var n=e.getUniformList();if(!n)return;var r=Object.keys(t);for(var i=0,s=r.length;i<s;i++){var o=r[i];n[o]!==undefined&&t[o].uniform===undefined&&(t[o].uniform=n[o].object)}},findExistingUniform:function(e,t){var n=function(){osg.NodeVisitor.call(this,osg.NodeVisitor.TRAVERSE_PARENTS)};n.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{setUniformMap:function(e){this.uniformMap=e},apply:function(e){var t=e.getStateSet();t&&osgUtil.ParameterVisitor.prototype.getUniformFromStateSet(t,this.uniformMap),this.traverse(e)}});var r=new n;r.setUniformMap(t),e.accept(r)},applyProgram:function(e,t){var n=t.getAttribute("Program"),r=n.getName(),i=n.getVertexShader().getText(),s={};this.getUniformList(n.getVertexShader().getText(),s),this.getUniformList(n.getFragmentShader().getText(),s);var o=Object.keys(s);if(r===undefined){var u=function(e){var t=0,n=0;if(e.length===0)return t;for(l=0;l<e.length;l++)n=e.charCodeAt(l),t=(t<<5)-t+n,t&=t;return t<0&&(t=-t),t},a=o.join("");r=u(a).toString()}this.findExistingUniform(e,s);var f=!1;for(var l=0;l<o.length;l++){var c=o[l],h=s[c],p=h.type,d=h.name;h.id=r;var v=this.arraySlider.createSlider(h);h.uniform===undefined&&v&&t.addUniform(v),f=!0}if(f){var m=document.createElement("div");m.innerHTML="<p> </p>",this.targetHTML.appendChild(m)}osg.log(s)},applyStateSet:function(e,t){t.getAttribute("Program")!==undefined&&this.applyProgram(e,t)},apply:function(e){var t=this.targetHTML;if(t===undefined||t===null)return;var n=e.getStateSet();n!==undefined&&this.applyStateSet(e,n),this.traverse(e)}})}();var OsgObjectMemoryPool=function(e){return{_memPool:[],reset:function(){return this._memPool=[],this},put:function(e){this._memPool.push(e)},get:function(){return this._memPool.length>0?this._memPool.pop():(this.grow(),this.get())},grow:function(t){t===undefined&&(t=this._memPool.length>0?this._memPool.length*2:20);var n=this._memPool.length;while(n++<t)this._memPool.push(new e);return this}}},OsgArrayMemoryPool=function(){return{_mempoolofPools:[],reset:function(){return this._memPoolofPools={},this},put:function(e){this._memPoolofPools[e.length]||(this._memPoolofPools[e.length]=[]),this._memPoolofPools[e.length].push(e)},get:function(e){if(!this._memPoolofPools[e])this._memPoolofPools[e]=[];else if(this._memPoolofPools.length>0)return this._memPool.pop();return this.grow(e),this.get()},grow:function(e,t){t===undefined&&(t=this._memPool.length>0?this._memPool.length*2:20);var n=this._memPool.length;while(n++<t)this._memPool.push(new Array(e));return this}}},osgDB={};osgDB.ObjectWrapper={},osgDB.ObjectWrapper.serializers={},osgDB.readImage=function(e){return osgDB._input===undefined&&(osgDB._input=new osgDB.Input),osgDB._input.readImageURL(e)},osgDB.parseSceneGraph=function(e,t){if(!(e.Version!==undefined&&e.Version>0))return osgDB.parseSceneGraph_deprecated(e);var n=function(e){var t=Object.keys(e);for(var n=0,r=t.length;n<r;n++)if(t[n]!=="Generator"&&t[n]!=="Version")return t[n];return undefined},r=n(e);if(r){var i={};i[r]=e[r];var s=new osgDB.Input(i);return t!==undefined&&t.progressXHRCallback!==undefined&&s.setProgressXHRCallback(t.progressXHRCallback),s.readObject()}osg.log("can't parse scenegraph "+e)},osgDB.parseSceneGraph_deprecated=function(e){var t=function(e,t){var n=t[e];return n===undefined&&(n=t[e.toLowerCase()]),n},n=function(e,n){var r=t("Name",n);r&&e.setName!==undefined&&e.setName(r)},r=function(e,r){n(e,r),e.setAmbient(t("Ambient",r)),e.setDiffuse(t("Diffuse",r)),e.setEmission(t("Emission",r)),e.setSpecular(t("Specular",r)),e.setShininess(t("Shininess",r))},i=function(e,t){n(e,t),e.setSourceRGB(t.SourceRGB),e.setSourceAlpha(t.SourceAlpha),e.setDestinationRGB(t.DestinationRGB),e.setDestinationAlpha(t.DestinationAlpha)},s=function(e,n){var r=n.MagFilter||n.mag_filter||undefined;r&&e.setMagFilter(r);var i=n.MinFilter||n.min_filter||undefined;i&&e.setMinFilter(i);var s=n.WrapT||n.wrap_t||undefined;s&&e.setWrapT(s);var o=n.WrapS||n.wrap_s||undefined;o&&e.setWrapS(o);var u=t("File",n);osgDB.Promise.when(osgDB.readImage(u)).then(function(t){e.setImage(t)})},o=function(e,o){n(e,o);var u=t("Textures",o)||t("TextureAttributeList",o)||undefined;if(u)for(var a=0,f=u.length;a<f;a++){var l=t("File",u[a]);if(!l){osg.log("no texture on unit "+a+" skip it");continue}var c=new osg.Texture;s(c,u[a]),e.setTextureAttributeAndMode(a,c),e.addUniform(osg.Uniform.createInt1(a,"Texture"+a))}var h=t("BlendFunc",o);if(h){var p=new osg.BlendFunc;i(p,h),e.setAttributeAndMode(p)}var d=t("Material",o);if(d){var v=new osg.Material;r(v,d),e.setAttributeAndMode(v)}},u,a=e.children,f=e.primitives||e.Primitives||undefined,l=e.attributes||e.Attributes||undefined;if(f||l){u=new osg.Geometry,n(u,e),osg.extend(u,e),e=u,e.primitives=f,e.attributes=l;var c;for(var h=0,p=f.length;h<p;h++){var d=f[h].mode;if(f[h].indices){var v=f[h].indices;v=new osg.BufferArray(osg.BufferArray[v.type],v.elements,v.itemSize),d?d=osg.PrimitiveSet[d]:d=gl.TRIANGLES,f[h]=new osg.DrawElements(d,v)}else{d=gl[d];var m=f[h].first,g=f[h].count;f[h]=new osg.DrawArrays(d,m,g)}}for(var y in l)if(l.hasOwnProperty(y)){var b=l[y];l[y]=new osg.BufferArray(gl[b.type],b.elements,b.itemSize)}}var w=t("StateSet",e);if(w){var E=new osg.StateSet;o(E,w),e.stateset=E}var S=e.matrix||e.Matrix||undefined;S&&(u=new osg.MatrixTransform,n(u,e),osg.extend(u,e),u.setMatrix(osg.Matrix.copy(S)),e=u);var x=e.projection||e.Projection||undefined;x&&(u=new osg.Projection,n(u,e),osg.extend(u,e),u.setProjectionMatrix(osg.Matrix.copy(x)),e=u),e.objectType===undefined&&(u=new osg.Node,n(u,e),osg.extend(u,e),e=u);if(a){e.children=[];for(var T=0,N=a.length;T<N;T++)e.addChild(osgDB.parseSceneGraph_deprecated(a[T]))}return e},osgDB.Input=function(e,t){this._json=e;var n=t;n===undefined&&(n={}),this._identifierMap=n,this._objectRegistry={},this._progressXHRCallback=undefined},osgDB.Input.prototype={setProgressXHRCallback:function(e){this._progressXHRCallback=e},registerObject:function(e,t){this._objectRegistry[e]=t},getJSON:function(){return this._json},setJSON:function(e){return this._json=e,this},getObjectWrapper:function(e){if(this._objectRegistry[e]!==undefined)return new this._objectRegistry[e];var t=window,n=e.split(".");for(var r=0,i=n.length;r<i;r++){var s=t[n[r]];if(s===undefined)return undefined;t=s}return new t},readImageURL:function(e){var t=osgDB.Promise.defer(),n=new Image;return n.onerror=function(){osg.warn("warning use white texture as fallback instead of "+e),n.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII="},n.onload=function(){t.resolve(n)},n.src=e,t.promise},readImage:function(){var e=this.getJSON(),t=e.UniqueID;if(t!==undefined){img=this._identifierMap[t];if(img!==undefined)return img}var n=this,r=osgDB.Promise.defer(),i=e.Url;return osgDB.Promise.when(this.readImageURL(i)).then(function(e){t!==undefined&&(n._identifierMap[t]=e),r.resolve(e)}),r.promise},readBinaryArrayURL:function(e){if(this._identifierMap[e]!==undefined)return this._identifierMap[e];var t=osgDB.Promise.defer(),n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",this._progressXHRCallback&&n.addEventListener("progress",this._progressXHRCallback,!1),n.addEventListener("error",function(){t.reject()},!1);var r=this;return n.addEventListener("load",function(i){var s=n.response;s?(r._identifierMap[e]=s,t.resolve(s)):t.reject()},!1),n.send(null),this._identifierMap[e]=t.promise,t.promise},readBufferArray:function(){var e=this.getJSON(),t=e.UniqueID,n;if(t!==undefined){n=this._identifierMap[t];if(n!==undefined)return n}var r=function(e){return e.Elements===undefined&&e.Array===undefined||e.ItemSize===undefined||!e.Type?!1:!0};if(!r(e))return;var i,s;if(e.Elements!==undefined)i=new osg.BufferArray(osg.BufferArray[e.Type],e.Elements,e.ItemSize);else if(e.Array!==undefined){var u=new osg.BufferArray(osg.BufferArray[e.Type]);u.setItemSize(e.ItemSize);var a,f;e.Array.Float32Array!==undefined?(a=e.Array.Float32Array,f="Float32Array"):e.Array.Uint16Array!==undefined?(a=e.Array.Uint16Array,f="Uint16Array"):(osg.warn("Typed Array "+Object.keys(o.Array)[0]),f="Float32Array");if(a!==undefined)if(a.File!==undefined){var l=a.File;s=osgDB.Promise.defer(),osgDB.Promise.when(this.readBinaryArrayURL(l)).then(function(e){var t,n;(function(){var e=new Uint8Array([18,52]),t=new Uint16Array(e.buffer);n=t[0].toString(16)==="1234"})();var r=0;a.Offset!==undefined&&(r=a.Offset);var i=osg[f].BYTES_PER_ELEMENT,o=a.Size,l=u.getItemSize(),h=o*i*l;if(n){osg.log("big endian detected");var p=osg[f],d=new p(o*l),v=new DataView(e,r,h),m=0,g=d.length;if(f==="Uint16Array")for(;m<g;m++)tempArray[m]=v.getUint16(m*i,!0);else if(f==="Float32Array")for(;m<g;m++)tempArray[m]=v.getFloat32(m*i,!0);t=tempArray,v=null}else t=new osg[f](e,r,l*o);c=b=null,u.setElements(t),s.resolve(u)})}else if(a.Elements!==undefined){var c=new osg[f](a.Elements);u.setElements(c)}i=u}return t!==undefined&&(this._identifierMap[t]=i),s!==undefined?s.promise:i},readUserDataContainer:function(){var e=this.getJSON(),t,n=e.UniqueID;if(n!==undefined){t=this._identifierMap[n];if(t!==undefined)return t.Values}return this._identifierMap[n]=e,e.Values},readPrimitiveSet:function(){var e=this.getJSON(),t,n,r,i,s=e.DrawElementUShort||e.DrawElementUByte||e.DrawElementUInt||e.DrawElementsUShort||e.DrawElementsUByte||e.DrawElementsUInt||undefined;if(s){t=s.UniqueID;if(t!==undefined){n=this._identifierMap[t];if(n!==undefined)return n}i=osgDB.Promise.defer();var o=s.Indices,u=e;mode=s.Mode,mode?mode=osg.PrimitiveSet[mode]:mode=osg.PrimitiveSet.TRIANGLES,r=new osg.DrawElements(mode),this.setJSON(o),osgDB.Promise.when(this.readBufferArray()).then(function(e){r.setIndices(e),i.resolve(r)}),this.setJSON(u)}var a=e.DrawArray||e.DrawArrays;if(a){t=a.UniqueID;if(t!==undefined){n=this._identifierMap[t];if(n!==undefined)return n}mode=a.Mode||a.mode,first=a.First!==undefined?a.First:a.first,count=a.Count!==undefined?a.Count:a.count;var f=new osg.DrawArrays(osg.PrimitiveSet[mode],first,count);r=f}var l=e.DrawArrayLengths||undefined;if(l){t=l.UniqueID;if(t!==undefined){n=this._identifierMap[t];if(n!==undefined)return n}mode=l.Mode,first=l.First;var c=l.ArrayLengths,h=new osg.DrawArrayLengths(osg.PrimitiveSet[mode],first,c);r=h}return t!==undefined&&(this._identifierMap[t]=r),i?i.promise:r},readObject:function(){var e=this.getJSON(),t=Object.keys(e)[0];if(!t)return osg.warn("can't find property for object "+e),undefined;var n=e[t].UniqueID,r;if(n!==undefined){r=this._identifierMap[n];if(r!==undefined)return r}var i=this.getObjectWrapper(t);if(!i)return osg.warn("can't instanciate object "+t),undefined;var s=osgDB.ObjectWrapper.serializers,o=t.split(".");for(var u=0,a=o.length;u<a;u++){var f=s[o[u]];if(f===undefined)return osg.warn("can't find function to read object "+t+" - undefined"),undefined;s=f}var l=s(this.setJSON(e[t]),i);return n!==undefined&&(this._identifierMap[n]=i,i._uniqueID=n),l}},osgDB.Promise={},function(){var e=osgDB.Promise;(function(t){if(typeof define=="function")define(t);else if(typeof e=="object")t(void 0,e);else if(typeof ses!="undefined"){if(!ses.ok())return;ses.makeQ=function(){var e={};return t(void 0,e)}}else t(void 0,Q={})})(function(e,t){"use strict";function g(e){return m(e)==="[object StopIteration]"||e instanceof y}function b(e,t){var n=[];try{n.push(e.toString())}catch(r){try{n.push("<error: "+r+">")}catch(i){n.push("<error>")}}for(var s=0;s<t.length;s++){var o=t[s],u;if(typeof o=="string")n.push(o);else{try{u=w(o)}catch(r){try{u="<error: "+r+">"}catch(i){u="<error>"}}n.push("    at "+u)}}return n.join("\n")}function w(e){var t="";if(e.isNative())t="native";else if(e.isEval())t="eval at "+e.getEvalOrigin();else{var n=e.getFileName();if(n){t+=n;var r=e.getLineNumber();if(r!==null){t+=":"+r;var i=e.getColumnNumber();i&&(t+=":"+i)}}}t||(t="unknown source");var s="",o=e.getFunction().name,u=!0,a=e.isConstructor(),f=!e.isToplevel()&&!a;if(f){var l=e.getMethodName();s+=e.getTypeName()+".",o?(s+=o,l&&l!==o&&(s+=" [as "+l+"]")):s+=l||"<anonymous>"}else a?s+="new "+(o||"<anonymous>"):o?s+=o:(s+=t,u=!1);return u&&(s+=" ("+t+")"),s}function E(e){var t=Error.prepareStackTrace;Error.prepareStackTrace=function(e,t){return t.filter(function(e){var t=e.getFileName();return t!=="module.js"&&t!=="node.js"&&t!==S})};var n=e.stack;return Error.prepareStackTrace=t,n}function x(e,t,n){return function(){return typeof console!="undefined"&&typeof console.warn=="function"&&0,e.apply(e,arguments)}}function T(){function o(n){if(!e)return;return t=H(n),c(e,function(e,n){i(function(){t.promiseSend.apply(t,n)})},void 0),e=void 0,t}var e=[],t,n=d(T.prototype),s=d(C.prototype);return s.promiseSend=function(){var n=l(arguments);e?e.push(n):i(function(){t.promiseSend.apply(t,n)})},s.valueOf=function(){return e?s:t.valueOf()},Error.captureStackTrace&&Error.captureStackTrace(s,T),r(s),n.promise=s,n.resolve=o,n.reject=function(e){return o(P(e))},n}function N(e){var t=T();return Q(e,void 0,t.resolve,t.reject).fail(t.reject),t.promise}function C(e,t,n,i){t===void 0&&(t=function(e){return P(new Error("Promise does not support operation: "+e))});var s=d(C.prototype);return s.promiseSend=function(n,r){var i=l(arguments,2),o;try{e[n]?o=e[n].apply(s,i):o=t.apply(s,[n].concat(i))}catch(u){o=P(u)}r(o)},n&&(s.valueOf=n),i&&(s.exception=i),r(s),s}function k(e){return Object(e)!==e?e:e.valueOf()}function L(e){return e&&typeof e.promiseSend=="function"}function A(e){return O(e)||M(e)}function O(e){return!L(k(e))}function M(e){return e=k(e),L(e)&&"exception"in e}function P(e){e=e||new Error;var t=C({when:function(t){if(t){var n=h(_,this);n!==-1&&(D.splice(n,1),_.splice(n,1))}return t?t(e):P(e)}},function(n){return P(e)},function n(){return this},e);return _.push(t),D.push(e),t}function H(e){if(L(e))return e;if(e&&typeof e.then=="function"){var t=T();return e.then(t.resolve,t.reject),t.promise}return C({when:function(t){return e},get:function(t){return e[t]},put:function(t,n){return e[t]=n},del:function(t){return delete e[t]},post:function(t,n){return e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},fapply:function(t){return e.apply(void 0,t)},viewInfo:function(){function r(e){n[e]||(n[e]=typeof t[e])}var t=e,n={};while(t)Object.getOwnPropertyNames(t).forEach(r),t=Object.getPrototypeOf(t);return{type:typeof e,properties:n}},keys:function(){return v(e)}},void 0,function n(){return e})}function B(e){return C({isDef:function(){}},function(n){var r=l(arguments);return W.apply(void 0,[e].concat(r))},function(){return k(e)})}function j(e,t){return e=H(e),t?C({viewInfo:function(){return t}},function(n){var r=l(arguments);return W.apply(void 0,[e].concat(r))},function(){return k(e)}):W(e,"viewInfo")}function F(e){return j(e).when(function(t){var n;t.type==="function"?n=function(){return J(e,void 0,arguments)}:n={};var r=t.properties||{};return v(r).forEach(function(t){r[t]==="function"&&(n[t]=function(){return $(e,t,arguments)})}),H(n)})}function I(e,t,n){function o(e){try{return t?t(e):e}catch(n){return P(n)}}function u(e){try{return n?n(e):P(e)}catch(t){return P(t)}}var r=T(),s=!1;return i(function(){H(e).promiseSend("when",function(e){if(s)return;s=!0,H(e).promiseSend("when",function(e){r.resolve(o(e))},function(e){r.resolve(u(e))})},function(e){if(s)return;s=!0,r.resolve(u(e))})}),r.promise}function q(e,t,n){return I(e,function(e){return t.apply(void 0,e)},n)}function R(e){return function(){function t(e,t){var s;try{s=n[e](t)}catch(o){return g(o)?o.value:P(o)}return I(s,r,i)}var n=e.apply(this,arguments),r=t.bind(t,"send"),i=t.bind(t,"throw");return r()}}function U(e){throw new y(e)}function z(e){return function(t){var n=l(arguments,1);return W.apply(void 0,[t,e].concat(n))}}function W(e,t){var n=T(),r=l(arguments,2);return e=H(e),i(function(){e.promiseSend.apply(e,[t,n.resolve].concat(r))}),n.promise}function X(e,t,n){var r=T();return e=H(e),i(function(){e.promiseSend.apply(e,[t,r.resolve].concat(n))}),r.promise}function V(e){return function(t){var n=l(arguments,1);return X(t,e,n)}}function Q(e,t){var n=l(arguments,2);return J(e,t,n)}function G(e){var t=l(arguments,1);return K(e,t)}function Y(e,t){var n=l(arguments,2);return function(){var i=n.concat(l(arguments));return J(e,t,i)}}function Z(e){var t=l(arguments,1);return function(){var r=t.concat(l(arguments));return K(e,r)}}function et(e){return I(e,function(e){var t=e.length;if(t===0)return H(e);var n=T();return c(e,function(r,i,s){I(i,function(r){e[s]=r,--t===0&&n.resolve(e)}).fail(n.reject)},void 0),n.promise})}function tt(e){return I(e,function(e){return I(et(p(e,function(e){return I(e,n,n)})),function(){return p(e,H)})})}function nt(e,t){return I(e,void 0,t)}function rt(e,t){return I(e,function(e){return I(t(),function(){return e})},function(e){return I(t(),function(){return P(e)})})}function it(e){I(e,void 0,function(t){i(function(){if(Error.captureStackTrace&&"stack"in t){var n=E(t),r=E(e),i=n.concat("From previous event:",r);t.stack=b(t,i)}throw t})})}function st(e,t){var n=T(),r=setTimeout(function(){n.reject(new Error("Timed out after "+t+" ms"))},t);return I(e,function(e){clearTimeout(r),n.resolve(e)},n.reject),n.promise}function ot(e,t){t===void 0&&(t=e,e=void 0);var n=T();return setTimeout(function(){n.resolve(e)},t),n.promise}function ut(e,t,n){return ft(e,t).apply(void 0,n)}function at(e,t){var n=l(arguments,2);return ut(e,t,n)}function ft(e){if(arguments.length>1){var t=arguments[1],n=l(arguments,2),r=e;e=function(){var e=n.concat(l(arguments));return r.apply(t,e)}}return function(){var t=T(),n=l(arguments);return n.push(t.makeNodeResolver()),K(e,n).fail(t.reject),t.promise}}function lt(e,t,n){return ut(e[t],e,n)}function ct(e,t){var n=l(arguments,2);return ut(e[t],e,n)}var n=function(){},r=Object.freeze||n;typeof cajaVM!="undefined"&&(r=cajaVM.def);var i;if(typeof process!="undefined")i=process.nextTick;else if(typeof msSetImmediate=="function")i=msSetImmediate.bind(window);else if(typeof setImmediate=="function")i=setImmediate;else if(typeof MessageChannel!="undefined"){var s=new MessageChannel,o={},u=o;s.port1.onmessage=function(){o=o.next;var e=o.task;delete o.task,e()},i=function(e){u=u.next={task:e},s.port2.postMessage(0)}}else i=function(e){setTimeout(e,0)};var a;if(Function.prototype.bind){var f=Function.prototype.bind;a=f.bind(f.call)}else a=function(e){return function(t){return e.call.apply(e,arguments)}};var l=a(Array.prototype.slice),c=a(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(arguments.length===1)do{if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}while(1);for(;n<r;n++)n in this&&(t=e(t,this[n],n));return t}),h=a(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),p=a(Array.prototype.map||function(e,t){var n=this,r=[];return c(n,function(i,s,o){r.push(e.call(t,s,o,n))},void 0),r}),d=Object.create||function(e){function t(){}return t.prototype=e,new t},v=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},m=Object.prototype.toString,y;typeof ReturnValue!="undefined"?y=ReturnValue:y=function(e){this.value=e};var S;Error.captureStackTrace&&(S=function(){var e,t=Error.prepareStackTrace;return Error.prepareStackTrace=function(t,n){e=n[0].getFileName()},(new Error).stack,Error.prepareStackTrace=t,e}()),t.nextTick=i,t.defer=T,T.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(l(arguments,1)):e.resolve(n)}},T.prototype.node=x(T.prototype.makeNodeResolver,"node","makeNodeResolver"),t.promise=N,t.makePromise=C,C.prototype.then=function(e,t){return I(this,e,t)},c(["isResolved","isFulfilled","isRejected","when","spread","send","get","put","del","post","invoke","keys","apply","call","bind","fapply","fcall","fbind","all","allResolved","view","viewInfo","timeout","delay","catch","finally","fail","fin","end"],function(e,n){C.prototype[n]=function(){return t[n].apply(t,[this].concat(l(arguments)))}},void 0),C.prototype.toSource=function(){return this.toString()},C.prototype.toString=function(){return"[object Promise]"},r(C.prototype),t.nearer=k,t.isPromise=L,t.isResolved=A,t.isFulfilled=O,t.isRejected=M;var _=[],D=[];typeof window!="undefined"&&window.console&&0,t.reject=P,t.begin=H,t.resolve=H,t.ref=x(H,"ref","resolve"),t.master=B,t.viewInfo=j,t.view=F,t.when=I,t.spread=q,t.async=R,t["return"]=U,t.sender=x(z,"sender","dispatcher"),t.Method=x(z,"Method","dispatcher"),t.send=x(W,"send","dispatch"),t.dispatch=X,t.dispatcher=V,t.get=V("get"),t.put=V("put"),t["delete"]=t.del=V("del");var $=t.post=V("post");t.invoke=function(e,t){var n=l(arguments,2);return $(e,t,n)};var J=t.apply=x(V("apply"),"apply","fapply"),K=t.fapply=V("fapply");t.call=x(Q,"call","fcall"),t["try"]=G,t.fcall=G,t.bind=x(Y,"bind","fbind"),t.fbind=Z,t.keys=V("keys"),t.all=et,t.allResolved=tt,t["catch"]=t.fail=nt,t["finally"]=t.fin=rt,t.end=it,t.timeout=st,t.delay=ot,t.napply=ut,t.ncall=at,t.nbind=ft,t.npost=lt,t.ninvoke=ct,r(t)})}();var osgViewer={};WebGLUtils=function(){var e=function(e){return'<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+e+"</div>"},t='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',n='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>',r=function(r,s,o){function u(r){var i=document.getElementsByTagName("body")[0];if(i){var s=window.WebGLRenderingContext?n:t;r&&(s+="<br/><br/>Status: "+r),i.innerHTML=e(s)}}o=o||u,r.addEventListener&&r.addEventListener("webglcontextcreationerror",function(e){o(e.statusMessage)},!1);var a=i(r,s);return a||(window.WebGLRenderingContext?o(""):o("")),a},i=function(e,t){var n=["webgl","experimental-webgl","webkit-3d","moz-webgl"],r=null;for(var i=0;i<n.length;++i){try{r=e.getContext(n[i],t)}catch(s){}if(r)break}var o=r;if(!o)return;var u=["WEBKIT_","MOZ_"];osg.profile={},osg.profile.extensions={},osg.profile.textureFormat={};var a=o.getSupportedExtensions(),f,l,c,h,p,d="";for(c in a){p=a[c],osg.profile.extensions[p]=o.getExtension(p),h=p;for(l=0;l<u.length;l++)p.indexOf(u[l])!==-1&&(h=p.substr(u[l].length,p.length),osg.profile.extensions[h]=osg.profile.extensions[p],d+="("+u[l]+")");d+=h+" ",d+=" http://www.khronos.org/registry/webgl/extensions/"+h+" ";if(p.toLowerCase().indexOf("s3tc")!==-1){osg.profile.textureFormat=o.getParameter(o.COMPRESSED_TEXTURE_FORMATS),d+="\n	",d+="Texture Support: ( ";for(f in osg.profile.textureFormat)osg.profile.textureFormat[f]==osg.profile.extensions[p].COMPRESSED_RGBA_S3TC_DXT5_EXT&&(osg.profile.dxt5Supported=!0,d+="dxt5 "),osg.profile.textureFormat[f]==osg.profile.extensions[p].COMPRESSED_RGBA_S3TC_DXT3_EXT&&(osg.profile.dxt3Supported=!0,d+="dxt3 "),osg.profile.textureFormat[f]==osg.profile.extensions[p].COMPRESSED_RGBA_S3TC_DXT1_EXT&&(osg.profile.dxt1Supported=!0,d+="dxt1 ");d+=" )"}d+="\n"}return 0,r};return{create3DContext:i,setupWebGL:r}}(),window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),window.cancelRequestAnimFrame||(window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}()),Date.now||(Date.now=function(){return(new Date).getTime()}),window.performance=window.performance||{},performance.now=function(){return window.performance.now||window.performance.mozNow||window.performance.msNow||window.performance.oNow||window.performance.webkitNow||function(){return Date.now()}}(),WebGLDebugUtils=function(){function r(e){if(n===null){n={};for(var t in e)typeof e[t]=="number"&&(n[e[t]]=t)}}function i(){if(n===null)throw"WebGLDebugUtils.init(ctx) not called"}function s(e){return i(),n[e]!==undefined}function o(e){i();var t=n[e];return t!==undefined?t:"*UNKNOWN WebGL ENUM (0x"+e.toString(16)+")"}function u(e,n,r){var i=t[e];return i!==undefined&&i[n]?o(r):r.toString()}function a(e,t,n){e.__defineGetter__(n,function(){return t[n]}),e.__defineSetter__(n,function(e){t[n]=e})}function f(e,t){var n=e[t];return function(){var t=n.apply(e,arguments);return t}}function l(t,n){function s(e,t){return function(){var r=e[t].apply(e,arguments),s=e.getError();return s!==0&&(i[s]=!0,n(s,t,arguments)),r}}r(t),n=n||function(t,n,r){var i="";for(var s=0;s<r.length;++s)i+=(s===0?"":", ")+u(n,s,r[s]);e("WebGL error "+o(t)+" in "+n+"("+i+")")};var i={},f={};for(var l in t)typeof t[l]=="function"?f[l]=s(t,l):a(f,t,l);return f.getError=function(){for(var e in i)if(i[e])return i[e]=!1,e;return t.NO_ERROR},f}function c(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);var r;for(r=0;r<t;++r)e.disableVertexAttribArray(r),e.vertexAttribPointer(r,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(r,0);e.deleteBuffer(n);var i=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(r=0;r<i;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);while(e.getError());}function h(e){function m(e){return typeof e=="function"?e:function(t){e.handleEvent(t)}}function b(e){var t=e.addEventListener;e.addEventListener=function(n,r,i){switch(n){case"webglcontextlost":g(r);break;case"webglcontextrestored":y(r);break;default:t.apply(e,arguments)}}}function w(e){return e instanceof WebGLBuffer||e instanceof WebGLFramebuffer||e instanceof WebGLProgram||e instanceof WebGLRenderbuffer||e instanceof WebGLShader||e instanceof WebGLTexture}function E(e){for(var t=0;t<e.length;++t){var n=e[t];if(w(n))return n.__webglDebugContextLostId__==s}return!0}function S(){var e=Object.keys(v);for(var t=0;t<e.length;++t)delete v[e]}function x(){++h,o||l==h&&e.loseContext()}function T(e,t){var n=e[t];return function(){x();if(!o){var t=n.apply(e,arguments);return t}}}function N(){for(var e=0;e<f.length;++e){var n=f[e];n instanceof WebGLBuffer?t.deleteBuffer(n):n instanceof WebGLFramebuffer?t.deleteFramebuffer(n):n instanceof WebGLProgram?t.deleteProgram(n):n instanceof WebGLRenderbuffer?t.deleteRenderbuffer(n):n instanceof WebGLShader?t.deleteShader(n):n instanceof WebGLTexture&&t.deleteTexture(n)}}function C(e){return{statusMessage:e,preventDefault:function(){p=!0}}}function k(e){for(var n in e)typeof e[n]=="function"?i[n]=T(e,n):a(i,e,n);i.getError=function(){x();var e;if(!o)while(e=t.getError())v[e]=!0;for(e in v)if(v[e])return delete v[e],e;return i.NO_ERROR};var r=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],u,l;for(l=0;l<r.length;++l)u=r[l],i[u]=function(t){return function(){x();if(o)return null;var n=t.apply(e,arguments);return n.__webglDebugContextLostId__=s,f.push(n),n}}(e[u]);var c=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(l=0;l<c.length;++l)u=c[l],i[u]=function(t){return function(){return x(),o?null:t.apply(e,arguments)}}(i[u]);var h=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(l=0;l<h.length;++l)u=h[l],i[u]=function(t){return function(){return x(),o?!1:t.apply(e,arguments)}}(i[u]);return i.checkFramebufferStatus=function(t){return function(){return x(),o?i.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(i.checkFramebufferStatus),i.getAttribLocation=function(t){return function(){return x(),o?-1:t.apply(e,arguments)}}(i.getAttribLocation),i.getVertexAttribOffset=function(t){return function(){return x(),o?0:t.apply(e,arguments)}}(i.getVertexAttribOffset),i.isContextLost=function(){return o},i}var t,n=[],r=[],i={},s=1,o=!1,u=0,f=[],l=0,h=0,p=!1,d=0,v={};e.getContext=function(n){return function(){var r=n.apply(e,arguments);if(r instanceof WebGLRenderingContext){if(r!=t){if(t)throw"got different context";t=r,i=k(t)}return i}return r}}(e.getContext);var g=function(e){n.push(m(e))},y=function(e){r.push(m(e))};return b(e),e.loseContext=function(){if(!o){o=!0,l=0,++s;while(t.getError());S(),v[t.CONTEXT_LOST_WEBGL]=!0;var r=C("context lost"),i=n.slice();setTimeout(function(){for(var t=0;t<i.length;++t)i[t](r);d>=0&&setTimeout(function(){e.restoreContext()},d)},0)}},e.restoreContext=function(){o&&r.length&&setTimeout(function(){if(!p)throw"can not restore. webglcontestlost listener did not call event.preventDefault";N(),c(t),o=!1,h=0,p=!1;var e=r.slice(),n=C("context restored");for(var i=0;i<e.length;++i)e[i](n)},0)},e.loseContextInNCalls=function(e){if(o)throw"You can not ask a lost contet to be lost";l=h+e},e.getNumCalls=function(){return h},e.setRestoreTimeout=function(e){d=e},e}var e=function(e){window.console&&window.console.log&&window.console.log(e)},t={enable:{0:!0},disable:{0:!0},getParameter:{0:!0},drawArrays:{0:!0},drawElements:{0:!0,2:!0},createShader:{0:!0},getShaderParameter:{1:!0},getProgramParameter:{1:!0},getVertexAttrib:{1:!0},vertexAttribPointer:{2:!0},bindTexture:{0:!0},activeTexture:{0:!0},getTexParameter:{0:!0,1:!0},texParameterf:{0:!0,1:!0},texParameteri:{0:!0,1:!0,2:!0},texImage2D:{0:!0,2:!0,6:!0,7:!0},texSubImage2D:{0:!0,6:!0,7:!0},copyTexImage2D:{0:!0,2:!0},copyTexSubImage2D:{0:!0},generateMipmap:{0:!0},bindBuffer:{0:!0},bufferData:{0:!0,2:!0},bufferSubData:{0:!0},getBufferParameter:{0:!0,1:!0},pixelStorei:{0:!0,1:!0},readPixels:{4:!0,5:!0},bindRenderbuffer:{0:!0},bindFramebuffer:{0:!0},checkFramebufferStatus:{0:!0},framebufferRenderbuffer:{0:!0,1:!0,2:!0},framebufferTexture2D:{0:!0,1:!0,2:!0},getFramebufferAttachmentParameter:{0:!0,1:!0,2:!0},getRenderbufferParameter:{0:!0,1:!0},renderbufferStorage:{0:!0,1:!0},clear:{0:!0},depthFunc:{0:!0},blendFunc:{0:!0,1:!0},blendFuncSeparate:{0:!0,1:!0,2:!0,3:!0},blendEquation:{0:!0},blendEquationSeparate:{0:!0,1:!0},stencilFunc:{0:!0},stencilFuncSeparate:{0:!0,1:!0},stencilMaskSeparate:{0:!0},stencilOp:{0:!0,1:!0,2:!0},stencilOpSeparate:{0:!0,1:!0,2:!0,3:!0},cullFace:{0:!0},frontFace:{0:!0}},n=null;return{init:r,mightBeEnum:s,glEnumToString:o,glFunctionArgToString:u,makeDebugContext:l,makeLostContextSimulatingCanvas:h,resetToInitialState:c}}();var Stats={};Stats.Stats=function(e,t){this.layers=[],this.last_update=undefined,this.canvas=e,this.text_canvas=t,this.numberUpdate=0,this.deltaSum=0,this.deltas=[]},Stats.Stats.prototype={addLayer:function(e,t,n,r){e===undefined&&(e="rgb(255,255,255)"),this.layers.push({previous:0,color:e,getValue:n,getText:r,average:0,max:t,data:[]})},update:function(){var e,t,n,r,i,s,o,u,a,f,l=performance.now();this.last_update===undefined&&(this.last_update=l),this.numberUpdate++,o=this.canvas,t=.12,e=(l-this.last_update)*t;if(e>=1){l-=(e-Math.floor(e))/t,e=Math.floor(e),this.deltaSum+=e,this.deltas.push(e);for(t=0,r=this.layers.length;t<r;t++)i=this.layers[t],i.data.push(i.getValue(l))}if(this.deltaSum>o.width||this.numberUpdate%30===0){u=o.getContext("2d");var c=o.width-this.deltaSum;c>0?(f=u.getImageData(this.deltaSum,0,c,o.height),u.putImageData(f,0,0),u.clearRect(c,0,this.deltaSum,o.height)):(c=0,u.clearRect(0,0,o.width,o.height)),u.lineWidth=1;for(t=0,r=this.layers.length;t<r;t++){i=this.layers[t],i.average=i.data[0];var h=c;u.strokeStyle=i.color,u.beginPath(),u.moveTo(h,o.height-i.previous);for(n=1;n<i.data.length;n++)s=i.data[n],i.average+=s,s*=o.height/i.max,s>o.height&&(s=o.height),h+=this.deltas[n],u.lineTo(h,o.height-s);u.stroke(),i.previous=s}this.deltaSum=0,this.deltas=[0],o=this.text_canvas,u=o.getContext("2d"),u.font="14px Sans",a=17,e=a,u.clearRect(0,0,o.width,o.height);for(t=0,r=this.layers.length;t<r;t++)i=this.layers[t],s=i.getText(i.average/i.data.length),i.average=0,u.fillStyle=i.color,u.fillText(s,0,e),e+=a,i.data=[i.data[i.data.length-1]];this.numberUpdate=0}this.last_update=l}},osgViewer.View=function(){this._graphicContext=undefined,this._camera=new osg.Camera,this._scene=new osg.Node,this._sceneData=undefined,this._frameStamp=new osg.FrameStamp,this._lightingMode=undefined,this._manipulator=undefined,this.setLightingMode(osgViewer.View.LightingMode.HEADLIGHT),this._scene.getOrCreateStateSet().setAttributeAndMode(new osg.Material),this._scene.getOrCreateStateSet().setAttributeAndMode(new osg.Depth),this._scene.getOrCreateStateSet().setAttributeAndMode(new osg.BlendFunc),this._scene.getOrCreateStateSet().setAttributeAndMode(new osg.CullFace)},osgViewer.View.LightingMode={NO_LIGHT:0,HEADLIGHT:1,SKY_LIGHT:2},osgViewer.View.prototype={setGraphicContext:function(e){this._graphicContext=e},getGraphicContext:function(){return this._graphicContext},setUpView:function(e){var t=e.width/e.height;this._camera.setViewport(new osg.Viewport(0,0,e.width,e.height)),osg.Matrix.makeLookAt([0,0,-10],[0,0,0],[0,1,0],this._camera.getViewMatrix()),osg.Matrix.makePerspective(60,t,1,1e3,this._camera.getProjectionMatrix())},computeIntersections:function(e,t,n){n===undefined&&(n=-1);var r=new osgUtil.IntersectVisitor;return r.setTraversalMask(n),r.addLineSegment([e,t,0],[e,t,1]),r.pushCamera(this._camera),this._sceneData.accept(r),r.hits},setFrameStamp:function(e){this._frameStamp=e},getFrameStamp:function(){return this._frameStamp},setCamera:function(e){this._camera=e},getCamera:function(){return this._camera},setSceneData:function(e){this._scene.removeChildren(),this._scene.addChild(e),this._sceneData=e},getSceneData:function(){return this._sceneData},getScene:function(){return this._scene},getManipulator:function(){return this._manipulator},setManipulator:function(e){this._manipulator=e},getLight:function(){return this._light},setLight:function(e){this._light=e,this._lightingMode!==osgViewer.View.LightingMode.NO_LIGHT&&this._scene.getOrCreateStateSet().setAttributeAndMode(this._light)},getLightingMode:function(){return this._lightingMode},setLightingMode:function(e){this._lightingMode!==e&&(this._lightingMode=e,this._lightingMode!==osgViewer.View.LightingMode.NO_LIGHT?this._light||(this._light=new osg.Light,this._light.setAmbient([.2,.2,.2,1]),this._light.setDiffuse([.8,.8,.8,1]),this._light.setSpecular([.5,.5,.5,1])):this._light=undefined)}},osgViewer.Viewer=function(e,t,n){osgViewer.View.call(this),t===undefined&&(t={antialias:!0}),osg.SimulateWebGLLostContext&&(e=WebGLDebugUtils.makeLostContextSimulatingCanvas(e),e.loseContextInNCalls(osg.SimulateWebGLLostContext)),gl=WebGLUtils.setupWebGL(e,t,n);var r=this;e.addEventListener("webglcontextlost",function(e){r.contextLost(),e.preventDefault()},!1),e.addEventListener("webglcontextrestored",function(){r.contextRestored()},!1),osg.cacheState&&(gl=new WebGL_StateCache(gl));if(osg.reportWebGLError||t.reportWebGLError)gl=WebGLDebugUtils.makeDebugContext(gl);if(!gl)throw"No WebGL implementation found";this.setGraphicContext(gl),osg.init(),this._canvas=e,this._frameRate=60,osgUtil.UpdateVisitor=osg.UpdateVisitor,osgUtil.CullVisitor=osg.CullVisitor,this._urlOptions=!0,this._mouseWheelEventNode=e,this._mouseEventNode=e,this._keyboardEventNode=document,t&&(t.mouseWheelEventNode&&(this._mouseWheelEventNode=t.mouseWheelEventNode),t.mouseEventNode&&(this._mouseEventNode=t.mouseEventNode),t.keyboardEventNode&&(this._keyboardEventNode=t.keyboardEventNode)),this.setUpView(e)},osgViewer.Viewer.prototype=osg.objectInehrit(osgViewer.View.prototype,{contextLost:function(){osg.log("webgl context lost"),window.cancelRequestAnimFrame(this._requestID)},contextRestored:function(){osg.log("webgl context restored, but not supported - reload the page")},init:function(){this._done=!1,this._state=new osg.State;var e=this.getGraphicContext();this._state.setGraphicContext(e),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),this._updateVisitor=new osgUtil.UpdateVisitor,this._cullVisitor=new osgUtil.CullVisitor,this._renderStage=new osg.RenderStage,this._stateGraph=new osg.StateGraph,this._urlOptions&&this.parseOptions(),this.getCamera().setClearColor([0,0,0,0])},getState:function(){return this._state},parseOptions:function(){var e=function(){var e=[],t,n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var r=0;r<n.length;r++){t=n[r].split("=");var i=t[0].toLowerCase();e.push(i);var s=t[1];s===undefined&&(s="1"),e[i]=s.toLowerCase()}return e},t=e();t.stats==="1"&&this.initStats(t);var n=this.getGraphicContext();t.depth_test==="0"&&this.getGraphicContext().disable(n.DEPTH_TEST),t.blend==="0"&&this.getGraphicContext().disable(n.BLEND),t.cull_face==="0"&&this.getGraphicContext().disable(n.CULL_FACE),t.light==="0"&&this.setLightingMode(osgViewer.View.LightingMode.NO_LIGHT)},initStats:function(e){var t=35,n=5,r=14;e.statsMaxMS!==undefined&&(t=parseInt(e.statsMaxMS,10)),e.statsStepMS!==undefined&&(n=parseInt(e.statsStepMS,10));var i=function(e){var r=["<div id='StatsDiv' style='top: 0; position: absolute; width: 300px; height: 150px; z-index: 10;'>","<div id='StatsCanvasDiv' style='position: relative;'>","<canvas id='StatsCanvasGrid' width='300' height='150' style='z-index:-1; position: absolute; background: rgba(14,14,14,0.8); ' ></canvas>","<canvas id='StatsCanvas' width='300' height='150' style='z-index:8; position: absolute;' ></canvas>","<canvas id='StatsCanvasText' width='300' height='150' style='z-index:9; position: absolute;' ></canvas>","</div>","</div>"].join("\n"),i;e===undefined?i=document.body:i=document.getElementById(e);var s=document.createElement("div");s.innerHTML=r,i.appendChild(s);var o=document.getElementById("StatsCanvasGrid"),u=o.getContext("2d");u.clearRect(0,0,o.width,o.height);var a=Math.floor(t/n).toFixed(0),f=o.height/a;u.strokeStyle="rgb(70,70,70)";for(var l=0,c=a;l<c;l++)u.beginPath(),u.moveTo(0,l*f),u.lineTo(o.width,l*f),u.stroke();return{graph:document.getElementById("StatsCanvas"),text:document.getElementById("StatsCanvasText")}};if(this._canvasStats===undefined||this._canvasStats===null){var s=i();this._canvasStats=s.graph,this._canvasStatsText=s.text}this._stats=new Stats.Stats(this._canvasStats,this._canvasStatsText);var o=this;this._frameRate=1,this._frameTime=0,this._updateTime=0,this._cullTime=0,this._drawTime=0,this._stats.addLayer("#ff0fff",120,function(e){return 1e3/o._frameRate},function(e){return"FrameRate: "+e.toFixed(0)+" fps"}),this._stats.addLayer("#ffff00",t,function(e){return o._frameTime},function(e){return"FrameTime: "+e.toFixed(2)+" ms"}),this._stats.addLayer("#d07b1f",t,function(e){return o._updateTime},function(e){return"UpdateTime: "+e.toFixed(2)+" ms"}),this._stats.addLayer("#73e0ff",t,function(e){return o._cullTime},function(e){return"CullTime: "+e.toFixed(2)+" ms"}),this._stats.addLayer("#ff0000",t,function(e){return o._drawTime},function(e){return"DrawTime: "+e.toFixed(2)+" ms"}),window.performance&&window.performance.memory&&window.performance.memory.totalJSHeapSize&&this._stats.addLayer("#00ff00",window.performance.memory.totalJSHeapSize*2,function(e){return o._memSize},function(e){return"Memory : "+e.toFixed(0)+" b"})},update:function(){this.getScene().accept(this._updateVisitor)},cull:function(){this._stateGraph.clean(),this._renderStage.reset(),this._cullVisitor.reset(),this._cullVisitor.setStateGraph(this._stateGraph),this._cullVisitor.setRenderStage(this._renderStage);var e=this.getCamera();this._cullVisitor.pushStateSet(e.getStateSet()),this._cullVisitor.pushProjectionMatrix(e.getProjectionMatrix());var t=e.getBound(),n=osg.Matrix.makeIdentity([]);this._cullVisitor.pushModelviewMatrix(n),this._light&&this._cullVisitor.addPositionedAttribute(this._light),this._cullVisitor.pushModelviewMatrix(e.getViewMatrix()),this._cullVisitor.pushViewport(e.getViewport()),this._cullVisitor.setCullSettings(e),this._renderStage.setClearDepth(e.getClearDepth()),this._renderStage.setClearColor(e.getClearColor()),this._renderStage.setClearMask(e.getClearMask()),this._renderStage.setViewport(e.getViewport()),this.getScene().accept(this._cullVisitor),this._cullVisitor.popModelviewMatrix(),this._cullVisitor.popProjectionMatrix(),this._cullVisitor.popViewport(),this._cullVisitor.popStateSet(),this._renderStage.sort()},draw:function(){var e=this.getState();this._renderStage.draw(e),e.popAllStateSets(),e.applyWithoutProgram()},frame:function(){var e,t;e=performance.now(),this._lastFrameTime===undefined&&(this._lastFrameTime=0),this._frameRate=e-this._lastFrameTime,this._lastFrameTime=e,t=e;var n=this.getFrameStamp();n.getFrameNumber()===0&&(n.setReferenceTime(e/1e3),this._numberFrame=0),n.setSimulationTime(e/1e3-n.getReferenceTime()),this._updateVisitor.setFrameStamp(this.getFrameStamp()),this.getManipulator()&&(this.getManipulator().update(this._updateVisitor),osg.Matrix.copy(this.getManipulator().getInverseMatrix(),this.getCamera().getViewMatrix())),this._stats===undefined?(this.update(),this.cull(),this.draw(),n.setFrameNumber(n.getFrameNumber()+1),this._numberFrame++,this._frameTime=performance.now()-t):(this._updateTime=performance.now(),this.update(),this._updateTime=performance.now()-this._updateTime,this._cullTime=performance.now(),this.cull(),this._cullTime=performance.now()-this._cullTime,this._drawTime=performance.now(),this.draw(),this._drawTime=performance.now()-this._drawTime,n.setFrameNumber(n.getFrameNumber()+1),this._numberFrame++,this._frameTime=performance.now()-t,window.performance&&window.performance.memory&&window.performance.memory.usedJSHeapSize&&(this._memSize=window.performance.memory.usedJSHeapSize),this._stats.update())},setDone:function(e){this._done=e},done:function(){return this._done},run:function(){var e=this,t=function(){e.done()||(e._requestID=window.requestAnimationFrame(t,e.canvas),e.frame())};t()},setupManipulator:function(e,t){e===undefined&&(e=new osgGA.OrbitManipulator),e.setNode!==undefined?e.setNode(this.getSceneData()):e.view=this,this.setManipulator(e);var n=this,r=this,i=function(e){e.target||(e.target=e.srcElement||document),e.target.nodeType===3&&(e.target=e.target.parentNode),!e.relatedTarget&&e.fromElement&&(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement);if(e.pageX===null&&e.clientX!==null){var t=document.documentElement,n=document.body;e.pageX=e.clientX+(t&&t.scrollLeft||n&&n.scrollLeft||0)-(t&&t.clientLeft||n&&n.clientLeft||0),e.pageY=e.clientY+(t&&t.scrollTop||n&&n.scrollTop||0)-(t&&t.clientTop||n&&n.clientTop||0)}return!e.which&&(e.charCode||e.charCode===0?e.charCode:e.keyCode)&&(e.which=e.charCode||e.keyCode),!e.metaKey&&e.ctrlKey&&(e.metaKey=e.ctrlKey),!e.which&&e.button!==undefined&&(e.which=e.button&1?1:e.button&2?3:e.button&4?2:0),e};if(t===undefined||t===!1){var s=!1,o=function(e){return r.getManipulator().touchstart(e)},u=function(e){return r.getManipulator().touchend(e)},a=function(e){return r.getManipulator().touchmove(e)},f=function(e){return r.getManipulator().touchcancel(e)},l=function(e){return r.getManipulator().touchleave(e)},c=function(e){return r.getManipulator().gesturestart(e)},h=function(e){return r.getManipulator().gesturechange(e)},p=function(e){return r.getManipulator().gestureend(e)};this._canvas.addEventListener("touchstart",o,!1),this._canvas.addEventListener("touchend",u,!1),this._canvas.addEventListener("touchmove",a,!1),this._canvas.addEventListener("touchcancel",f,!1),this._canvas.addEventListener("touchleave",l,!1),this._canvas.addEventListener("gesturestart",c,!1),this._canvas.addEventListener("gesturechange",h,!1),this._canvas.addEventListener("gestureend",p,!1);var d=function(e){if(s===!1)return r.getManipulator().mousedown(e)},v=function(e){if(s===!1)return r.getManipulator().mouseup(e)},m=function(e){if(s===!1)return r.getManipulator().mousemove(e)},g=function(e){if(s===!1)return r.getManipulator().dblclick(e)},y=function(e){if(s===!1){var t=e||window.event,n=[].slice.call(arguments,1),i=0,o=!0,u=0,a=0;e.type="mousewheel",e.wheelDelta&&(i=e.wheelDelta/120),e.detail&&(i=-e.detail/3),a=i,t.axis!==undefined&&t.axis===t.HORIZONTAL_AXIS&&(a=0,u=-1*i),t.wheelDeltaY!==undefined&&(a=t.wheelDeltaY/120),t.wheelDeltaX!==undefined&&(u=-1*t.wheelDeltaX/120),n.unshift(e,i,u,a);var f=r.getManipulator();return f.mousewheel.apply(f,n)}};r.getManipulator().mousedown&&this._mouseEventNode.addEventListener("mousedown",d,!1),r.getManipulator().mouseup&&this._mouseEventNode.addEventListener("mouseup",v,!1),r.getManipulator().mousemove&&this._mouseEventNode.addEventListener("mousemove",m,!1),r.getManipulator().dblclick&&this._mouseEventNode.addEventListener("dblclick",g,!1),r.getManipulator().mousewheel&&(this._mouseWheelEventNode.addEventListener("DOMMouseScroll",y,!1),this._mouseWheelEventNode.addEventListener("mousewheel",y,!1));var b=function(e){return r.getManipulator().keydown(e)},w=function(e){return r.getManipulator().keyup(e)};r.getManipulator().keydown&&this._keyboardEventNode.addEventListener("keydown",b,!1),r.getManipulator().keyup&&this._keyboardEventNode.addEventListener("keyup",w,!1);var E=this,S=function(e){var t=window.innerWidth,n=window.innerHeight,r=E._canvas.width,i=E._canvas.height;E._canvas.width=t,E._canvas.height=n,E._canvas.style.width=t,E._canvas.style.height=n,osg.log("window resize "+r+"x"+i+" to "+t+"x"+n);var s=E.getCamera(),o=s.getViewport(),u=t/o.width(),a=n/o.height(),f=u/a;o.setViewport(o.x()*u,o.y()*a,o.width()*u,o.height()*a),f!==1&&osg.Matrix.postMult(osg.Matrix.makeScale(1,f,1,[]),s.getProjectionMatrix())};window.onresize=S}}}),osgGA={},osgGA.Manipulator=function(){this._touches=[],this._inverseMatrix=new Array(16),osg.Matrix.makeIdentity(this._inverseMatrix)},osgGA.Manipulator.prototype={getPositionRelativeToCanvas:function(e){var t=e.target,n,r;if(e.pageX||e.pageY)n=e.pageX,r=e.pageY;else if(e.clientX||e.clientY)n=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r=e.clientY+document.body.scrollTop+document.documentElement.scrollTop;var i=function(e){var t=0,n=0;t=e.offsetLeft,n=e.offsetTop;var r=document.getElementsByTagName("body")[0];while(e.offsetParent&&e!=r)t+=e.offsetParent.offsetLeft,n+=e.offsetParent.offsetTop,e=e.offsetParent;return[t,n]},s=i(t);return n-=s[0],r=t.height-(r-s[1]),[n,r]},keydown:function(e){},keyup:function(e){},mouseup:function(e){},mousedown:function(e){},mousemove:function(e){},dblclick:function(e){},touchstart:function(e){e.preventDefault();var t=e.changedTouches;for(var n=0,r=t.length;n<r;n++){var i=t[n],s=i.identifier;this._touches[s]=i;var o=this.getPositionRelativeToCanvas(i);osg.debug("touch "+s+" started at "+o[0]+" "+o[1])}},touchend:function(e){e.preventDefault();var t=e.changedTouches;for(var n=0,r=t.length;n<r;n++){var i=t[n],s=i.identifier;this._touches[s]=undefined;var o=this.getPositionRelativeToCanvas(i);osg.debug("touch "+s+" stoped at "+o[0]+" "+o[1])}},touchmove:function(e){e.preventDefault();var t=e.changedTouches;for(var n=0,r=t.length;n<r;n++){var i=t[n],s=i.identifier,o=this.getPositionRelativeToCanvas(i),u=this.getPositionRelativeToCanvas(this._touches[s]),a=o[0]-u[0],f=o[1]-u[1];this._touches[s]=i,osg.debug("touch "+s+" moved "+a+" "+f)}},touchleave:function(e){return this.touchend(e)},touchcancel:function(e){e.preventDefault();var t=e.changedTouches;for(var n=0,r=t.length;n<r;n++){var i=t[n],s=i.identifier;this._touches[s]=undefined;var o=this.getPositionRelativeToCanvas(i);osg.debug("touch "+s+" cancelled at "+o[0]+" "+o[1])}},gesturestart:function(e){e.preventDefault(),osg.debug("gesturestart  scale "+e.scale+" rotation "+e.rotation)},gestureend:function(e){e.preventDefault(),osg.debug("gestureend  scale "+e.scale+" rotation "+e.rotation)},gesturechange:function(e){e.preventDefault(),osg.debug("gesturechange scale "+e.scale+" rotation "+e.rotation)},mousewheel:function(e,t,n,r){e.preventDefault(),osg.debug("mousewheel "+t+" "+" "+n+" "+r)},update:function(e){},getInverseMatrix:function(){return this._inverseMatrix}},osgGA.OrbitManipulator=function(){osgGA.Manipulator.call(this),this.init()},osgGA.OrbitManipulator.Rotate=0,osgGA.OrbitManipulator.Pan=1,osgGA.OrbitManipulator.Zoom=2,osgGA.OrbitManipulator.Interpolator=function(e,t){this._current=new Array(e),this._target=new Array(e),this._delta=new Array(e),this._delay=t,this._delay===undefined&&(this._delay=.15),this._reset=!1,this.reset()},osgGA.OrbitManipulator.Interpolator.prototype={reset:function(){for(var e=0,t=this._current.length;e<t;e++)this._current[e]=this._target[e]=0;this._reset=!0},update:function(){for(var e=0,t=this._current.length;e<t;e++){var n=(this._target[e]-this._current[e])*this._delay;this._delta[e]=n,this._current[e]+=n}return this._delta},set:function(){for(var e=0,t=this._current.length;e<t;e++)this._current[e]=this._target[e]=arguments[e];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var e=0,t=this._target.length;e<t;e++)this._reset?this._target[e]=this._current[e]=arguments[e]:this._target[e]=arguments[e];this._reset=!1},getTarget:function(){return this._target},getDelta:function(){return this._delta}},osgGA.OrbitManipulator.prototype=osg.objectInehrit(osgGA.Manipulator.prototype,{init:function(){this._distance=25,this._target=new Array(3),osg.Vec3.init(this._target),this._rotation=osg.Matrix.mult(osg.Matrix.makeRotate(Math.PI,0,0,1,[]),osg.Matrix.makeRotate(-Math.PI/10,1,0,0,[]),[]),this._time=0,this._rotate=new osgGA.OrbitManipulator.Interpolator(2),this._pan=new osgGA.OrbitManipulator.Interpolator(2),this._zoom=new osgGA.OrbitManipulator.Interpolator(1),this._zoom.reset=function(){osgGA.OrbitManipulator.Interpolator.prototype.reset.call(this),this._start=0},this._buttonup=!0,this._scale=10,this._currentMode=undefined,this._maxDistance=0,this._minDistance=0,this._scaleMouseMotion=.1,this._node=undefined,this._moveTouch=undefined,this._inverseMatrix=new Array(16),this._rotateKey=65,this._zoomKey=83,this._panKey=68},reset:function(){this.init()},setNode:function(e){this._node=e},setTarget:function(e){osg.Vec3.copy(e,this._target);var t=new Array(3);this.getEyePosition(t),this._distance=osg.Vec3.distance(t,e)},setEyePosition:function(e){var t=this._rotation,n=this._target,r=[0,0,1],i=osg.Vec3.sub(e,n,[]);osg.Vec3.normalize(i,i);var s=osg.Vec3.cross(i,r,[]);osg.Vec3.normalize(s,s);var o=osg.Vec3.cross(s,i,[]);osg.Vec3.normalize(o,o),t[0]=s[0],t[1]=i[0],t[2]=o[0],t[3]=0,t[4]=s[1],t[5]=i[1],t[6]=o[1],t[7]=0,t[8]=s[2],t[9]=i[2],t[10]=o[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this._distance=osg.Vec3.distance(e,n)},computeHomePosition:function(){if(this._node!==undefined){var e=this._node.getBound();this.setDistance(e.radius()*1.5),this.setTarget(e.center())}},keydown:function(e){e.keyCode===32?this.computeHomePosition():e.keyCode===33?this.distanceIncrease():e.keyCode===34?this.distanceDecrease():e.keyCode===this._panKey&&this._currentMode!==osgGA.OrbitManipulator.Pan?(this._currentMode=osgGA.OrbitManipulator.Pan,this._pan.reset(),this.pushButton(),e.preventDefault()):e.keyCode===this._zoomKey&&this._currentMode!==osgGA.OrbitManipulator.Zoom?(this._currentMode=osgGA.OrbitManipulator.Zoom,this._zoom.reset(),this.pushButton(),e.preventDefault()):e.keyCode===this._rotateKey&&this._currentMode!==osgGA.OrbitManipulator.Rotate&&(this._currentMode=osgGA.OrbitManipulator.Rotate,this._rotate.reset(),this.pushButton(),e.preventDefault())},keyup:function(e){e.keyCode===this._panKey?this.mouseup(e):e.keyCode===this._rotateKey?this.mouseup(e):e.keyCode===this._rotateKey&&this.mouseup(e),this._currentMode=undefined},touchstart:function(e){this._currentMode===undefined&&(this._currentMode=osgGA.OrbitManipulator.Rotate);var t=e.changedTouches;this._moveTouch===undefined&&(this._moveTouch=new osgGA.OrbitManipulator.TouchEvent);if(this._moveTouch.id===undefined){var n=t[0],r=n.identifier,i=this.getPositionRelativeToCanvas(n);this._rotate.set(i[0],i[1]),this._moveTouch.init(r,i[0],i[1]),this.pushButton(n)}e.preventDefault()},touchend:function(e){e.preventDefault(),this._currentMode=undefined,this._moveTouch=undefined,this.releaseButton(e)},touchmove:function(e){e.preventDefault();var t=e.changedTouches;for(var n=0,r=t.length;n<r;n++){var i=t[n],s=i.identifier;if(s===this._moveTouch.id){var o=this.getPositionRelativeToCanvas(i);this._rotate.setTarget(o[0],o[1]),this._moveTouch.init(s,o[0],o[1])}}},touchleave:function(e){return this.touchend(e)},touchcancel:function(e){this.touchend(e)},gesturestart:function(e){e.preventDefault(),this._moveTouch&&(this._moveTouch.id=undefined),this._moveTouch.init(undefined,0,0,e.scale,e.rotation),this._zoom.reset()},gestureend:function(e){e.preventDefault(),this._moveTouch.init(undefined,0,0,e.scale,e.rotation),this._currentMode=undefined},gesturechange:function(e){e.preventDefault();var t=(e.scale-this._moveTouch.scale)*5;this._moveTouch.init(undefined,0,0,e.scale,e.rotation),this._zoom.setTarget(this._zoom.getTarget()[0]-t)},mouseup:function(e){this.releaseButton(e),this._currentMode=undefined},mousedown:function(e){this._currentMode===undefined&&(e.button===0?e.shiftKey?this._currentMode=osgGA.OrbitManipulator.Pan:e.ctrlKey?this._currentMode=osgGA.OrbitManipulator.Zoom:this._currentMode=osgGA.OrbitManipulator.Rotate:this._currentMode=osgGA.OrbitManipulator.Pan),this.pushButton(e);var t=this.getPositionRelativeToCanvas(e);this._currentMode===osgGA.OrbitManipulator.Rotate?(this._rotate.reset(t[0],t[1]),this._rotate.set(t[0],t[1])):this._currentMode===osgGA.OrbitManipulator.Pan?(this._pan.reset(t[0],t[1]),this._pan.set(t[0],t[1])):this._currentMode===osgGA.OrbitManipulator.Zoom&&(this._zoom._start=t[1],this._zoom.set(0)),e.preventDefault()},mousemove:function(e){if(this._buttonup===!0)return;var t=this.getPositionRelativeToCanvas(e);if(isNaN(t[0])===!1&&isNaN(t[1])===!1)if(this._currentMode===osgGA.OrbitManipulator.Rotate)this._rotate.setTarget(t[0],t[1]);else if(this._currentMode===osgGA.OrbitManipulator.Pan)this._pan.setTarget(t[0],t[1]);else if(this._currentMode===osgGA.OrbitManipulator.Zoom){this._zoom.isReset()&&(this._zoom._start=t[1],this._zoom.set(0));var n=t[1]-this._zoom._start;this._zoom._start=t[1];var r=this._zoom.getTarget()[0];this._zoom.setTarget(r-n/20)}e.preventDefault(),e.preventDefault()},setMaxDistance:function(e){this._maxDistance=e},setMinDistance:function(e){this._minDistance=e},setDistance:function(e){this._distance=e},getDistance:function(){return this._distance},computePan:function(e,t){t*=this._distance,e*=this._distance;var n=new Array(16),r=new Array(3),i=new Array(3);osg.Matrix.inverse(this._rotation,n),r[0]=osg.Matrix.get(n,0,0),r[1]=osg.Matrix.get(n,0,1),r[2]=osg.Matrix.get(n,0,2),osg.Vec3.normalize(r,r),i[0]=osg.Matrix.get(n,2,0),i[1]=osg.Matrix.get(n,2,1),i[2]=osg.Matrix.get(n,2,2),osg.Vec3.normalize(i,i),osg.Vec3.mult(r,-e,r),osg.Vec3.mult(i,t,i),osg.Vec3.add(this._target,r,this._target),osg.Vec3.add(this._target,i,this._target)},computeRotation:function(e,t){var n=osg.Matrix.makeRotate(e/10,0,0,1,[]),r=osg.Matrix.mult(this._rotation,n,[]);n=osg.Matrix.makeRotate(t/10,1,0,0,[]);var i=osg.Matrix.mult(n,r,[]),s=[];osg.Matrix.inverse(i,s);var o=osg.Matrix.transformVec3(s,[0,this._distance,0],new Array(3)),u=osg.Vec3.neg(o,[]);osg.Vec3.normalize(u,u);var a=osg.Vec3.dot(u,[0,0,1]);if(Math.abs(a)>.95){this._rotation=r;return}this._rotation=i},releaseButton:function(){this._buttonup=!0},mousewheel:function(e,t,n,r){e.preventDefault(),this._zoom.setTarget(this._zoom.getTarget()[0]-t)},computeZoom:function(e){this.zoom(e)},zoom:function(e){var t=this._distance*e;this._minDistance>0&&t<this._minDistance&&(t=this._minDistance),this._maxDistance>0&&t>this._maxDistance&&(t=this._maxDistance),this._distance=t},pushButton:function(){this._buttonup=!1},getTarget:function(e){osg.Vec3.copy(this._target,e)},getEyePosition:function(e){var t=new Array(16);osg.Matrix.inverse(this._rotation,t),osg.Matrix.transformVec3(t,[0,this._distance,0],e),osg.Vec3.add(this._target,e,e)},update:function(e){var t=e.getFrameStamp().getSimulationTime();this._lastUpdate===undefined&&(this._lastUpdate=t);var n=t-this._lastUpdate;this._lastUpdate=t;var r,i=.1;r=this._rotate.update(),this.computeRotation(-r[0]*i,-r[1]*i);var s=.002;r=this._pan.update(),this.computePan(-r[0]*s,-r[1]*s),r=this._zoom.update(),this.computeZoom(1+r[0]/10);var o=this._target,u=this._distance,a=new Array(3);osg.Matrix.inverse(this._rotation,this._inverseMatrix),osg.Matrix.transformVec3(this._inverseMatrix,[0,u,0],a),osg.Matrix.makeLookAt(osg.Vec3.add(o,a,a),o,[0,0,1],this._inverseMatrix)},getInverseMatrix:function(){return this._inverseMatrix}}),osgGA.OrbitManipulator.TouchEvent=function(){this.x=0,this.y=0,this.scale=1,this.rotation=0,this.id=undefined},osgGA.OrbitManipulator.TouchEvent.prototype={init:function(e,t,n,r,i){this.id=e,this.x=t,this.y=n,r!==undefined&&(this.scale=r),i!==undefined&&(this.rotation=i)}},osgGA.FirstPersonManipulator=function(){osgGA.Manipulator.call(this),this.init()},osgGA.FirstPersonManipulator.prototype=osg.objectInehrit(osgGA.Manipulator.prototype,{setNode:function(e){this._node=e,this.computeHomePosition()},computeHomePosition:function(){if(this._node!==undefined){var e=this._node.getBound();this._radius=e.radius(),this._eye=[0,-e.radius()*1.5,0],this._angleVertical=0,this._angleHorizontal=0}},init:function(){this._direction=[0,1,0],this._angleVertical=0,this._angleHorizontal=0,this._eye=[0,25,10],this._up=[0,0,1],this._buttonup=!0,this._radius=1,this._forward=new osgGA.OrbitManipulator.Interpolator(1),this._side=new osgGA.OrbitManipulator.Interpolator(1),this._lookPosition=new osgGA.OrbitManipulator.Interpolator(2),this._stepFactor=1,this._target=new Array(3),osg.Vec3.init(this._target)},reset:function(){this.init()},getEyePosition:function(e){return e[0]=this._eye[0],e[1]=this._eye[1],e[2]=this._eye[2],e},setEyePosition:function(e){this._eye[0]=e[0],this._eye[1]=e[1],this._eye[2]=e[2]},getTarget:function(e,t){t===undefined&&(t=25);var n=osg.Vec3.mult(this._direction,t,new Array(3));osg.Vec3.add(this._eye,n,e)},setTarget:function(e){this._target[0]=e[0],this._target[1]=e[1],this._target[2]=e[2];var t=new Array(3);osg.Vec3.sub(e,this._eye,t),t[2]=0,osg.Vec3.normalize(t,t),this._angleHorizontal=Math.acos(t[1]),t[0]<0&&(this._angleHorizontal=-this._angleHorizontal),osg.Vec3.sub(e,this._eye,t),osg.Vec3.normalize(t,t),this._angleVertical=-Math.asin(t[2]),osg.Vec3.copy(t,this._direction)},mousedown:function(e){var t=this.getPositionRelativeToCanvas(e);this._lookPosition.set(t[0],t[1]),this._buttonup=!1},mouseup:function(e){this._buttonup=!0},mousemove:function(e){if(this._buttonup===!0)return;var t,n,r,i,s=this.getPositionRelativeToCanvas(e);this._lookPosition.setTarget(s[0],s[1])},computeRotation:function(e,t){this._angleVertical+=t*.01,this._angleHorizontal-=e*.01;var n=[],r=[],i=[];osg.Matrix.makeRotate(this._angleVertical,1,0,0,n),osg.Matrix.makeRotate(this._angleHorizontal,0,0,1,r),osg.Matrix.mult(r,n,i),this._direction=osg.Matrix.transformVec3(i,[0,1,0],[]),osg.Vec3.normalize(this._direction,this._direction),this._up=osg.Matrix.transformVec3(i,[0,0,1],[])},mousewheel:function(e,t,n,r){e.preventDefault(),this._stepFactor=Math.min(Math.max(.001,this._stepFactor+t*.01),4)},update:function(e){var t=e.getFrameStamp().getSimulationTime();this._lastUpdate===undefined&&(this._lastUpdate=t);var n=t-this._lastUpdate;this._lastUpdate=t,this._forward.update(),this._side.update();var r=this._lookPosition.update();this.computeRotation(-r[0]*.5,-r[1]*.5);var i=new Array(2);i[0]=this._forward.getCurrent()[0],i[1]=this._side.getCurrent()[0],osg.Vec2.length(i)>1&&osg.Vec2.normalize(i,i);var s=this._radius;this._radius<.001&&(s=1),this.moveForward(i[0]*s*this._stepFactor*n),this.strafe(i[1]*s*this._stepFactor*n);var o=osg.Vec3.add(this._eye,this._direction,[]);this._target=o,osg.Matrix.makeLookAt(this._eye,o,this._up,this._inverseMatrix)},getInverseMatrix:function(){return this._inverseMatrix},moveForward:function(e){var t=osg.Vec3.mult(osg.Vec3.normalize(this._direction,[]),e,[]);this._eye=osg.Vec3.add(this._eye,t,[])},strafe:function(e){var t=osg.Vec3.cross(this._direction,this._up,[]),n=osg.Vec3.mult(osg.Vec3.normalize(t,t),e,[]);this._eye=osg.Vec3.add(this._eye,n,[])},keydown:function(e){if(e.keyCode===32)this.computeHomePosition();else{if(e.keyCode===87||e.keyCode===90||e.keyCode===38)return this._forward.setTarget(1),!1;if(e.keyCode===83||e.keyCode===40)return this._forward.setTarget(-1),!1;if(e.keyCode===68||e.keyCode===39)return this._side.setTarget(1),!1;if(e.keyCode===65||e.keyCode===81||e.keyCode===37)return this._side.setTarget(-1),!1}},keyup:function(e){if(e.keyCode===87||e.keyCode===90||e.keyCode===38)return this._forward.setTarget(0),!1;if(e.keyCode==83||e.keyCode===40)return this._forward.setTarget(0),!1;if(e.keyCode==68||e.keyCode===39)return this._side.setTarget(0),!1;if(e.keyCode===65||e.keyCode===81||e.keyCode===37)return this._side.setTarget(0),!1}}),osgGA.SwitchManipulator=function(){osgGA.Manipulator.call(this),this._manipulatorList=[],this._currentManipulator=undefined},osgGA.SwitchManipulator.prototype=osg.objectInehrit(osgGA.Manipulator.prototype,{update:function(e){var t=this.getCurrentManipulator();if(t!==undefined)return t.update(e)},setNode:function(e){var t=this.getCurrentManipulator();if(t.setNode===undefined){osg.log("manipulator has not setNode method");return}t.setNode(e)},getNumManipulator:function(){return this._manipulatorList.length},addManipulator:function(e){this._manipulatorList.push(e),this._currentManipulator===undefined&&(this._currentManipulator=0)},getManipulatorList:function(){return this._manipulatorList},setManipulatorIndex:function(e){this._currentManipulator=e},getCurrentManipulatorIndex:function(){return this._currentManipulator},getCurrentManipulator:function(){var e=this._manipulatorList[this._currentManipulator];return e},reset:function(){this.getCurrentManipulator().reset()},computeHomePosition:function(){var e=this.getCurrentManipulator();e!==undefined&&e.computeHomePosition()},keydown:function(e){var t=this.getCurrentManipulator();if(t!==undefined)return t.keydown(e)},keyup:function(e){var t=this.getCurrentManipulator();if(t!==undefined)return t.keyup(e)},mouseup:function(e){var t=this.getCurrentManipulator();if(t!==undefined)return t.mouseup(e)},mousedown:function(e){var t=this.getCurrentManipulator();if(t!==undefined)return t.mousedown(e)},mousemove:function(e){var t=this.getCurrentManipulator();if(t!==undefined)return t.mousemove(e)},dblclick:function(e){var t=this.getCurrentManipulator();if(t!==undefined)return t.dblclick(e)},touchstart:function(e){var t=this.getCurrentManipulator();if(t!==undefined)return t.touchstart(e)},touchend:function(e){var t=this.getCurrentManipulator();if(t!==undefined)return t.touchend(e)},touchmove:function(e){var t=this.getCurrentManipulator();if(t!==undefined)return t.touchmove(e)},touchleave:function(e){var t=this.getCurrentManipulator();if(t!==undefined)return t.touchleave(e)},touchcancel:function(e){var t=this.getCurrentManipulator();if(t!==undefined)return t.touchcancel(e)},gesturestart:function(e){var t=this.getCurrentManipulator();if(t!==undefined)return t.gesturestart(e)},gestureend:function(e){var t=this.getCurrentManipulator();if(t!==undefined)return t.gestureend(e)},gesturechange:function(e){var t=this.getCurrentManipulator();if(t!==undefined)return t.gesturechange(e)},mousewheel:function(e,t,n,r){var i=this.getCurrentManipulator();if(i!==undefined)return i.mousewheel(e,t,n,r)},getInverseMatrix:function(){var e=this.getCurrentManipulator();if(e!==undefined)return e.getInverseMatrix()}}),osgDB.ObjectWrapper.serializers.osg={},osgDB.ObjectWrapper.serializers.osg.Object=function(e,t){var n=e.getJSON(),r=function(e){return!0};if(!r(n))return;n.Name&&t.setName(n.Name);if(n.UserDataContainer){var i=e.setJSON(n.UserDataContainer).readUserDataContainer();i!==undefined&&t.setUserData(i)}return t},osgDB.ObjectWrapper.serializers.osg.Node=function(e,t){var n=e.getJSON(),r=function(e){return!0};if(!r(n))return;osgDB.ObjectWrapper.serializers.osg.Object(e,t);var i=[],s=function(n){var r=e.setJSON(n).readObject(),s=osgDB.Promise.defer();i.push(s.promise),osgDB.Promise.when(r).then(function(e){e&&t.addUpdateCallback(e),s.resolve()})};if(n.UpdateCallbacks)for(var o=0,u=n.UpdateCallbacks.length;o<u;o++)s(n.UpdateCallbacks[o]);if(n.StateSet){var a=e.setJSON(n.StateSet).readObject(),f=osgDB.Promise.defer();i.push(f.promise),osgDB.Promise.when(a).then(function(e){t.setStateSet(e),f.resolve()})}var l=function(n){var r=e.setJSON(n).readObject(),s=osgDB.Promise.defer();i.push(s.promise),osgDB.Promise.when(r).then(function(e){e&&t.addChild(e),s.resolve(e)})};if(n.Children)for(var c=0,h=n.Children.length;c<h;c++)l(n.Children[c]);var p=osgDB.Promise.defer();return osgDB.Promise.all(i).then(function(){p.resolve(t)}),p.promise},osgDB.ObjectWrapper.serializers.osg.StateSet=function(e,t){var n=e.getJSON(),r=function(e){return!0};if(!r(n))return;osgDB.ObjectWrapper.serializers.osg.Object(e,t),n.RenderingHint!==undefined&&t.setRenderingHint(n.RenderingHint);var i=function(n){var r=e.setJSON(n).readObject(),i=osgDB.Promise.defer();s.push(i.promise),osgDB.Promise.when(r).then(function(e){e!==undefined&&t.setAttributeAndMode(e),i.resolve()})},s=[];if(n.AttributeList!==undefined)for(var o=0,u=n.AttributeList.length;o<u;o++)i(n.AttributeList[o]);var a=function(n,r){var i=e.setJSON(r).readObject(),o=osgDB.Promise.defer();s.push(o.promise),osgDB.Promise.when(i).then(function(e){e&&t.setTextureAttributeAndMode(n,e),o.resolve()})};if(n.TextureAttributeList){var f=n.TextureAttributeList;for(var l=0,c=f.length;l<c;l++){var h=f[l];for(var p=0,d=h.length;p<d;p++)a(l,h[p])}}var v=osgDB.Promise.defer();return osgDB.Promise.all(s).then(function(){v.resolve(t)}),v.promise},osgDB.ObjectWrapper.serializers.osg.Material=function(e,t){var n=e.getJSON(),r=function(e){return e.Diffuse!==undefined&&e.Emission!==undefined&&e.Specular!==undefined&&e.Shininess!==undefined?!0:!1};if(!r(n))return;return osgDB.ObjectWrapper.serializers.osg.Object(e,t),t.setAmbient(n.Ambient),t.setDiffuse(n.Diffuse),t.setEmission(n.Emission),t.setSpecular(n.Specular),t.setShininess(n.Shininess),t},osgDB.ObjectWrapper.serializers.osg.BlendFunc=function(e,t){var n=e.getJSON(),r=function(e){return e.SourceRGB&&e.SourceAlpha&&e.DestinationRGB&&e.DestinationAlpha?!0:!1};if(!r(n))return;return osgDB.ObjectWrapper.serializers.osg.Object(e,t),t.setSourceRGB(n.SourceRGB),t.setSourceAlpha(n.SourceAlpha),t.setDestinationRGB(n.DestinationRGB),t.setDestinationAlpha(n.DestinationAlpha),t},osgDB.ObjectWrapper.serializers.osg.CullFace=function(e,t){var n=e.getJSON(),r=function(e){return e.Mode!==undefined?!0:!1};if(!r(n))return;return osgDB.ObjectWrapper.serializers.osg.Object(e,t),t.setMode(n.Mode),t},osgDB.ObjectWrapper.serializers.osg.BlendColor=function(e,t){var n=e.getJSON(),r=function(e){return e.ConstantColor!==undefined?!0:!1};if(!r(n))return;return osgDB.ObjectWrapper.serializers.osg.Object(e,t),t.setConstantColor(n.ConstantColor),t},osgDB.ObjectWrapper.serializers.osg.Light=function(e,t){var n=e.getJSON(),r=function(e){return e.LightNum!==undefined&&e.Ambient!==undefined&&e.Diffuse!==undefined&&e.Direction!==undefined&&e.Position!==undefined&&e.Specular!==undefined&&e.SpotCutoff!==undefined&&e.LinearAttenuation!==undefined&&e.ConstantAttenuation!==undefined&&e.QuadraticAttenuation!==undefined?!0:!1};if(!r(n))return;return osgDB.ObjectWrapper.serializers.osg.Object(e,t),t.setAmbient(n.Ambient),t.setConstantAttenuation(n.ConstantAttenuation),t.setDiffuse(n.Diffuse),t.setDirection(n.Direction),t.setLightNumber(n.LightNum),t.setLinearAttenuation(n.LinearAttenuation),t.setPosition(n.Position),t.setQuadraticAttenuation(n.QuadraticAttenuation),t.setSpecular(n.Specular),t.setSpotCutoff(n.SpotCutoff),t.setSpotBlend(.01),n.SpotExponent!==undefined&&t.setSpotBlend(n.SpotExponent/128),t},osgDB.ObjectWrapper.serializers.osg.Texture=function(e,t){var n=e.getJSON(),r=function(e){return!0};if(!r(n))return;osgDB.ObjectWrapper.serializers.osg.Object(e,t),n.MinFilter!==undefined&&t.setMinFilter(n.MinFilter),n.MagFilter!==undefined&&t.setMagFilter(n.MagFilter),n.WrapT!==undefined&&t.setWrapT(n.WrapT),n.WrapS!==undefined&&t.setWrapS(n.WrapS);var i=osgDB.Promise.defer();return n.File!==undefined&&osgDB.Promise.when(e.readImageURL(n.File)).then(function(e){t.setImage(e),i.resolve(t)}),i.promise},osgDB.ObjectWrapper.serializers.osg.Projection=function(e,t){var n=e.getJSON(),r=function(e){return e.Matrix!==undefined?!0:!1};if(!r(n))return;var i=osgDB.ObjectWrapper.serializers.osg.Node(e,t);return n.Matrix!==undefined&&t.setMatrix(n.Matrix),i},osgDB.ObjectWrapper.serializers.osg.MatrixTransform=function(e,t){var n=e.getJSON(),r=function(e){return e.Matrix?!0:!1};if(!r(n))return;var i=osgDB.ObjectWrapper.serializers.osg.Node(e,t);return n.Matrix!==undefined&&t.setMatrix(n.Matrix),i},osgDB.ObjectWrapper.serializers.osg.LightSource=function(e,t){var n=e.getJSON(),r=function(e){return e.Light!==undefined?!0:!1};if(!r(n))return;var i=osgDB.Promise.defer(),s=osgDB.ObjectWrapper.serializers.osg.Node(e,t);return osgDB.Promise.all([e.setJSON(n.Light).readObject(),s]).then(function(e){var n=e[0],r=e[1];t.setLight(n),i.resolve(t)}),i.promise},osgDB.ObjectWrapper.serializers.osg.Geometry=function(e,t){var n=e.getJSON(),r=function(e){return e.PrimitiveSetList!==undefined&&e.VertexAttributeList!==undefined?!0:!1};if(!r(n))return;var i=[];i.push(osgDB.ObjectWrapper.serializers.osg.Node(e,t));var s=function(n){var r=osgDB.Promise.defer();i.push(r.promise);var s=e.setJSON(n).readPrimitiveSet();osgDB.Promise.when(s).then(function(e){e!==undefined&&t.getPrimitives().push(e),r.resolve(e)})};for(var o=0,u=n.PrimitiveSetList.length;o<u;o++){var a=n.PrimitiveSetList[o];s(a)}var f=function(n,r){var s=osgDB.Promise.defer();i.push(s.promise);var o=e.setJSON(r).readBufferArray();osgDB.Promise.when(o).then(function(e){e!==undefined&&(t.getVertexAttributeList()[n]=e),s.resolve(e)})};for(var l in n.VertexAttributeList)n.VertexAttributeList.hasOwnProperty(l)&&f(l,n.VertexAttributeList[l]);var c=osgDB.Promise.defer();return osgDB.Promise.all(i).then(function(){c.resolve(t)}),c.promise},osgDB.ObjectWrapper.serializers.osgAnimation={},osgDB.ObjectWrapper.serializers.osgAnimation.Animation=function(e,t){var n=e.getJSON(),r=function(e){return e.Name&&e.Channels&&e.Channels.length>0?!0:e.Name?!1:(osg.log("animation has field Name, error"),!1)};if(!r(n))return;if(!osgDB.ObjectWrapper.serializers.osg.Object(e,t))return;for(var i=0,s=n.Channels.length;i<s;i++)osgDB.Promise.when(e.setJSON(n.Channels[i]).readObject()).then(function(e){e&&t.getChannels().push(e)});return t},osgDB.ObjectWrapper.serializers.osgAnimation.Vec3LerpChannel=function(e,t){var n=e.getJSON(),r=function(e){return e.KeyFrames&&e.TargetName&&e.Name?!0:!1};if(!r(n))return;if(!osgDB.ObjectWrapper.serializers.osg.Object(e,t))return;t.setTargetName(n.TargetName);var i=t.getSampler().getKeyframes();for(var s=0,o=n.KeyFrames.length;s<o;s++){var u=n.KeyFrames[s],a=u.slice(1);a.t=u[0],i.push(a)}return t},osgDB.ObjectWrapper.serializers.osgAnimation.QuatLerpChannel=function(e,t){return osgDB.ObjectWrapper.serializers.osgAnimation.Vec3LerpChannel(e,t)},osgDB.ObjectWrapper.serializers.osgAnimation.QuatSlerpChannel=function(e,t){return osgDB.ObjectWrapper.serializers.osgAnimation.Vec3LerpChannel(e,t)},osgDB.ObjectWrapper.serializers.osgAnimation.FloatLerpChannel=function(e,t){var n=e.getJSON(),r=function(e){return e.KeyFrames&&e.TargetName&&e.Name?!0:!1};if(!r(n))return;if(!osgDB.ObjectWrapper.serializers.osg.Object(e,t))return;t.setTargetName(n.TargetName);var i=t.getSampler().getKeyframes();for(var s=0,o=n.KeyFrames.length;s<o;s++){var u=n.KeyFrames[s],a=u.slice(1);a.t=u[0],i.push(a)}return t},osgDB.ObjectWrapper.serializers.osgAnimation.BasicAnimationManager=function(e,t){var n=e.getJSON(),r=function(e){return e.Animations?!0:!1};if(!r(n))return;for(var i=0,s=n.Animations.length;i<s;i++){var o=n.Animations[i],u=e.setJSON(o).readObject();u&&t.registerAnimation(u)}return t},osgDB.ObjectWrapper.serializers.osgAnimation.UpdateMatrixTransform=function(e,t){var n=e.getJSON(),r=function(e){return e.Name&&e.StackedTransforms?!0:!1};if(!r(n))return;if(osgDB.ObjectWrapper.serializers.osg.Object(e,t)===undefined)return;for(var i=0,s=n.StackedTransforms.length;i<s;i++){var o=n.StackedTransforms[i],u=e.setJSON(o).readObject();u&&t.getStackedTransforms().push(u)}return t},osgDB.ObjectWrapper.serializers.osgAnimation.StackedTranslate=function(e,t){var n=e.getJSON(),r=function(e){return e.Name?!0:!1};if(!r(n))return;if(!osgDB.ObjectWrapper.serializers.osg.Object(e,t))return;return n.Translate&&t.setTranslate(n.Translate),t},osgDB.ObjectWrapper.serializers.osgAnimation.StackedQuaternion=function(e,t){var n=e.getJSON(),r=function(e){return e.Name?!0:!1};if(!r(n))return;if(!osgDB.ObjectWrapper.serializers.osg.Object(e,t))return;return n.Quaternion&&t.setQuaternion(n.Quaternion),t},osgDB.ObjectWrapper.serializers.osgAnimation.StackedRotateAxis=function(e,t){var n=e.getJSON(),r=function(e){return e.Axis?!0:!1};if(!r(n))return;if(!osgDB.ObjectWrapper.serializers.osg.Object(e,t))return;return n.Angle&&t.setAngle(n.Angle),t.setAxis(n.Axis),t};